<!DOCTYPE html>
<html data-html-server-rendered="true" lang="ja" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22ja%22%7D%7D">
  <head>
    <title>AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する | Serverless Operations</title><meta name="gridsome:hash" content="e5bf1eed04e22915fe60df772657de15feda3786"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="og:locale" property="og:locale" content="ja_JP"><meta data-vue-tag="ssr" data-key="og:site_name" property="og:site_name" content="Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://serverless.co.jp/ogp.png"><meta data-vue-tag="ssr" data-key="og:type" property="og:type" content="article"><meta data-vue-tag="ssr" data-key="og:url" property="og:url" content="https://serverless.co.jp/blog/532/"><meta data-vue-tag="ssr" data-key="og:image" property="og:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2020/05/so-release.png"><meta data-vue-tag="ssr" data-key="og:title" property="og:title" content="AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する | Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2020/05/so-release.png"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css"><link data-vue-tag="ssr" data-key="canonical" rel="canonical" href="https://serverless.co.jp/blog/532/"><link rel="preload" href="/assets/css/0.styles.adfe40b8.css" as="style"><link rel="preload" href="/assets/js/app.7f894eb2.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--word-press-blog-vue.fdf3ed1a.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.84e8aa18.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.094252a3.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-archives-vue.771d12fd.js"><link rel="prefetch" href="/assets/js/page--src--pages--contact-vue.c49312ad.js"><link rel="prefetch" href="/assets/js/page--src--pages--download-vue.e2fb64ed.js"><link rel="prefetch" href="/assets/js/page--src--pages--event-archives-vue.dc6c64cc.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.ae1cb6c3.js"><link rel="prefetch" href="/assets/js/page--src--pages--news-archives-vue.2871bf8d.js"><link rel="prefetch" href="/assets/js/page--src--pages--our-products-vue.d569f152.js"><link rel="prefetch" href="/assets/js/page--src--pages--privacy-policy-vue.9015b9cf.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue.548b9c96.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue~page--src--pages--services--iot-serverless-vue.bada637e.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--index-vue.605da173.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--iot-serverless-vue.1324af58.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-consulting-vue.bf933f33.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-development-vue.d8c60529.js"><link rel="prefetch" href="/assets/js/page--src--pages--test-form-vue.37425afa.js"><link rel="prefetch" href="/assets/js/page--src--pages--works-archives-vue.b641ea0a.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-category-vue.7424850d.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-tag-vue.a058c92f.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-vue.8fb7ceee.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-works-vue.dc66c364.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--contact-vue~page--src--pages--download-vue.7a23cb3f.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--our-products-vue.8e9052c2.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-blog-vue.16b09ab1.js"><link rel="stylesheet" href="/assets/css/0.styles.adfe40b8.css"><script data-vue-tag="ssr">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MLP4448');</script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="v-application v-application--is-ltr theme--dark" data-v-7de3dd27><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MLP4448" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="v-application--wrap"><header class="header-nav" data-v-5f4f5539><div class="header-nav__logo-block" data-v-5f4f5539><a href="/" class="header-nav__logo-link active" data-v-5f4f5539><img src="/assets/img/header-logo.a93f880b.svg" alt="Severless Operations ロゴ" class="header-nav__logo" data-v-5f4f5539></a></div><nav data-v-5f4f5539><ul data-v-5f4f5539><li data-v-5f4f5539><a href="/about" data-v-5f4f5539>私たちについて</a></li><li data-v-5f4f5539><a href="/services" data-v-5f4f5539>サービス</a></li><li data-v-5f4f5539><a href="/works-archives" data-v-5f4f5539>実績紹介</a></li><li data-v-5f4f5539><a href="/blog-archives" data-v-5f4f5539>ブログ</a></li><li data-v-5f4f5539><a href="/news-archives" data-v-5f4f5539>お知らせ</a></li><li data-v-5f4f5539><a href="/download" data-v-5f4f5539>会社資料ダウンロード</a></li><li data-v-5f4f5539><a href="/contact" data-v-5f4f5539>お問い合わせ</a></li></ul></nav><div id="app" class="header-nav__toggler-block d-block d-md-none" data-v-5f4f5539><button id="btn" type="button" class="header-nav__toggler-button btn" data-v-5f4f5539><div tabindex="-1" class="btn__content" data-v-5f4f5539><span class="header-nav__toggler-top" data-v-5f4f5539></span><span class="header-nav__toggler-middle" data-v-5f4f5539></span><span class="header-nav__toggler-bottom" data-v-5f4f5539></span></div></button></div><!----></header><main class="v-content"><div class="v-content" data-v-7de3dd27><div class="v-content__wrap" data-v-7de3dd27><div class="container" data-v-7de3dd27><p class="category-title" data-v-7de3dd27>
          Blog
        </p></div><header class="post-header" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="col-md-10 col-11" data-v-7de3dd27><h1 class="post-title" data-v-7de3dd27>AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する</h1><div class="post-tag-container" data-v-7de3dd27><time datetime="2022.12.21" class="post-date" data-v-7de3dd27> 
                  2022.12.21
                  
                </time><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Amplify</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Appsync</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>DynamoDB</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>GraphQL</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Serverless</span></div></div></div></div></div></header><article class="post-container" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="post-article-container col-md-10 col-11" data-v-7de3dd27><div class="post-article" data-v-7de3dd27>
<p>この記事は <a href="https://qiita.com/advent-calendar/2022/amplify" data-type="URL" data-id="https://qiita.com/advent-calendar/2022/amplify" target="_blank" rel="noreferrer noopener">AWS AmplifyとAWS×フロントエンド Advent Calendar 2022</a> 22日目の記事です。</p>



<p>AWS Amplify は主にプロトタイプやMVPを開発する際、作りたいと思ったものをクイックに実装できる便利なサービスです。フロントエンドはAmplify Hostingを利用することでホスティング作業が非常に簡単になりました。また、<a rel="noreferrer noopener" href="https://github.com/aws-amplify/amplify-js" data-type="URL" data-id="https://github.com/aws-amplify/amplify-js" target="_blank">amplify-jsライブラリ</a>を利用すれば、AWS SDKのみを利用するよりも、効率よくAWSの各サービスに連携することが可能になっています。Figmaとの連携など、Amplify Studioを活用する場面もあるかと思います。</p>



<p>一方、バックエンドについても、GraphQLモードの場合、AppSyncとDynamoDBを利用したオススメの構成を自動生成してくれます。上手く使えばとても役立ちますが、従来まではデータモデリングを含め実現方法のコツを試行錯誤しながら覚える必要がありました。</p>



<p>そんな中、昨年末GraphQL Transformer V2が発表され、特にデータモデル間のリレーション定義が簡潔に書けるようになりました。基本的な部分さえ押さえれば、実践的に活用または応用することが以前よりやりやすくなりました。</p>



<p>この記事では、新しいデータモデリングのリレーション定義にフォーカスして、<a rel="noreferrer noopener" href="https://docs.amplify.aws/cli/graphql/data-modeling" data-type="URL" data-id="https://docs.amplify.aws/cli/graphql/data-modeling" target="_blank">公式ドキュメント</a>に基づき新しく追加された４つのディレクティブ（ <code>@hasOne</code>, <code>@hasMany</code>, <code>@belongsTo</code>, <code>@manyToMany</code> ）の基本的な使い方について解説します。合わせて、自動生成される仕組みのイメージができるように、DynamoDBの使われ方についても紹介していきます。</p>



<h2 class="wp-block-heading"><code>@hasOne</code> &#8211; 2つのモデル間に一方向の 1:1 リレーションを作成</h2>



<p>まず、あるプロジェクトとそのプロジェクトを推進するチームがあるとします。また、プロジェクトの担当チームを取得するクエリーを書きたいと想定します。ここで、例えば「各プロジェクトを担当するチームは１つのみ」という仕様がある場合、以下のようにスキーマを定義します。</p>



<pre class="wp-block-code language-graphql"><code>type Project @model {
  id: ID!
  name: String
  team: Team @hasOne
}

type Team @model {
  id: ID!
  name: String!
}</code></pre>



<p>amplify push でデプロイしてレコードを登録してみると、以下のようにDynamoDBがセットされます。</p>



<h4 class="wp-block-heading">Project テーブル</h4>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="118" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/1_sec1_Project_Table-1-1024x118.png" alt="" class="wp-image-534" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/1_sec1_Project_Table-1-1024x118.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/1_sec1_Project_Table-1-300x34.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/1_sec1_Project_Table-1-768x88.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/1_sec1_Project_Table-1.png 1036w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p><code>@hasOne</code> ディレクティブは、Teamのレコードを引くための ID （ <code>proejctTeamId</code> ） がスキーマに自動追加されます。この項目に担当TeamのID（ <code>team_1</code> ）を登録することで、ProjectからTeamのレコードが取得できるようになります。</p>



<h4 class="wp-block-heading">Team テーブル</h4>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="862" height="113" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/2_sec1_Team_Table.png" alt="" class="wp-image-535" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/2_sec1_Team_Table.png 862w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/2_sec1_Team_Table-300x39.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/2_sec1_Team_Table-768x101.png 768w" sizes="(max-width: 862px) 100vw, 862px" /></figure>



<h4 class="wp-block-heading">「プロジェクトの担当チームを取得する」クエリーのサンプル</h4>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="574" height="301" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/3_sec1_Query_Sample-3.png" alt="" class="wp-image-552" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/3_sec1_Query_Sample-3.png 574w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/3_sec1_Query_Sample-3-300x157.png 300w" sizes="(max-width: 574px) 100vw, 574px" /></figure>



<p>このように、 <code>@hasOne</code> ディレクティブは 1:1 の関係にあるレコードのリレーションを定義し、解決するリゾルバーを生成してくれます。</p>



<h2 class="wp-block-heading"><code>@hasMany</code> &#8211; ２つのモデル間に、一方向の 1:N リレーションを作成</h2>



<p>ここでは、ブログの記事（ <code>Post</code> ）と、その記事についているコメント欄（ <code>Comment</code> ）があるとします。また、記事とその記事に投稿されているコメント一覧を一気に取得するクエリーを書くと想定します。「一つの記事」に対して「複数のコメント」がある構成を表現する場合、以下のようにスキーマを定義します。</p>



<pre class="wp-block-code language-graphql"><code>type Post @model {
  id: ID!
  title: String!
  comments: &#91;Comment] @hasMany
}

type Comment @model {
  id: ID!
  content: String!
}</code></pre>



<p>amplify push でデプロイしてレコードを登録してみると、以下のようにDynamoDBがセットされます。</p>



<h4 class="wp-block-heading">Post テーブル</h4>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="873" height="119" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/4_sec2_Post_Table-1.png" alt="" class="wp-image-540" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/4_sec2_Post_Table-1.png 873w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/4_sec2_Post_Table-1-300x41.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/4_sec2_Post_Table-1-768x105.png 768w" sizes="(max-width: 873px) 100vw, 873px" /></figure>



<h4 class="wp-block-heading">Comment テーブル</h4>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="166" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/5_sec2_Comment_Table-1024x166.png" alt="" class="wp-image-541" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/5_sec2_Comment_Table-1024x166.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/5_sec2_Comment_Table-300x49.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/5_sec2_Comment_Table-768x125.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/5_sec2_Comment_Table.png 1047w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p><code>@hasMany</code> の場合、Many（多）になる側（＝Commentテーブル）にマッピング項目が追加され、以下のようにGSI-PKインデックスが自動生成された状態になります。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="194" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/6_sec2_Comment_Table_GSI-1024x194.png" alt="" class="wp-image-542" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/6_sec2_Comment_Table_GSI-1024x194.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/6_sec2_Comment_Table_GSI-300x57.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/6_sec2_Comment_Table_GSI-768x146.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/6_sec2_Comment_Table_GSI.png 1113w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>これにより、以下のようなクエリーを書くことができるようになります。<code>postCommentsId</code> に指定されているPostのIDがGSI-PKとして使われます。</p>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="623" height="487" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/7_sec2_Query_sample_1-2.png" alt="" class="wp-image-553" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/7_sec2_Query_sample_1-2.png 623w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/7_sec2_Query_sample_1-2-300x235.png 300w" sizes="(max-width: 623px) 100vw, 623px" /></figure>



<h2 class="wp-block-heading"><code>belongsTo</code> &#8211; 2つのモデルの間に、双方向で 1:1 または 1:N のリレーションを作成</h2>



<p>簡単にいうと <code>@hasOne</code> または <code>@hasMany</code> で指定したモデルを、逆方向でも取得できるようにするものです。</p>



<p>例えば、<code>@hasOne</code> で指定したProjectとTeamの関係では、「Project」を指定して「Team」を取得する形でした。もし「Team」から「Project」を取得するクエリーを書きたくなった場合、以下のようにスキーマを定義します。</p>



<pre class="wp-block-code language-graphql"><code>type Project @model {
  id: ID!
  name: String
  team: Team @hasOne
}

type Team @model {
  id: ID!
  name: String!
  # project フィールドを追加、@belongsTo を指定することでTeamからもProjectを引けるようになる
  project: Project @belongsTo
}</code></pre>



<p>amplify push でデプロイしてTeamのレコードにProjectを登録してみます。</p>



<h4 class="wp-block-heading">Team テーブル</h4>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="120" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/9_sec3_Team_Table-1024x120.png" alt="" class="wp-image-545" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/9_sec3_Team_Table-1024x120.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/9_sec3_Team_Table-300x35.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/9_sec3_Team_Table-768x90.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/9_sec3_Team_Table.png 1032w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p><code>teamProjectId</code> という項目がスキーマに自動追加されますので、ここにProjectのIDを指定することで、<code>@hasOne</code> パターンとは逆の方向からProjectを取得できるようになります。</p>



<p>以下、クエリーのサンプルです。</p>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="582" height="307" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/10_sec3_Team_Query_Sample-1.png" alt="" class="wp-image-554" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/10_sec3_Team_Query_Sample-1.png 582w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/10_sec3_Team_Query_Sample-1-300x158.png 300w" sizes="(max-width: 582px) 100vw, 582px" /></figure>



<p>このように、Teamから紐付いているProjectのレコードを引けるようになります。</p>



<p>※マッピング用の項目名（ &#8220;projectTeamId&#8221; など）が紛らわしくて気になる方は、<a rel="noreferrer noopener" href="https://docs.amplify.aws/cli/graphql/data-modeling/#belongs-to-relationship" data-type="URL" data-id="https://docs.amplify.aws/cli/graphql/data-modeling/#belongs-to-relationship" target="_blank">公式ドキュメント</a>にて任意のキー名を指定する方法がありますので是非ご参照ください。</p>



<p>続いて、<code>@hasMany</code> の場合、PostからComment一覧を取得する形でした。もし、Commentを指定してそのコメントが紐付いているPostを見つけたくなった場合、以下のようにスキーマを定義します。</p>



<pre class="wp-block-code language-graphql"><code>type Post @model {
  id: ID!
  title: String!
  comments: &#91;Comment] @hasMany
}

type Comment @model {
  id: ID!
  content: String!
  # project フィールドを追加、@belongsTo を指定することでCommentからもPostを引けるようになる
  post: Post @belongsTo
}</code></pre>



<p>これを amplify push でデプロイすると、以下のようにpostが引けるようになります。スキーマとリゾルバが自動追加され、DynamoDBの構成には変更ありません。</p>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="582" height="300" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/11_sec3_Comment_Query_After-1.png" alt="" class="wp-image-555" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/11_sec3_Comment_Query_After-1.png 582w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/11_sec3_Comment_Query_After-1-300x155.png 300w" sizes="(max-width: 582px) 100vw, 582px" /></figure>



<h2 class="wp-block-heading"><code>@manyToMany</code> &#8211; ２つのモデルの N:N リレーションを作成</h2>



<p>２つのモデルを Joint する対応が必要になるケースです。例えば、記事（ <code>Post</code> ）にタグ付け（ <code>Tag</code> ）を行うとし、以下のような状態を考えてみます。</p>



<ul><li>タグは「タグA」「タグB」「タグC 」の３種類がある</li></ul>



<ul><li>「記事A」には「タグA」と「タグB」が指定されている</li></ul>



<ul><li>「記事B」には「タグB」と「タグC」が指定されている</li></ul>



<p>この状態で、以下２つのユースケースがあると想定します。</p>



<ul><li>「記事A」に指定されているタグの一覧を取得する</li><li>「タグB」が指定されている記事の一覧を取得する</li></ul>



<p>これらを実現するためのスキーマは以下のように定義します。</p>



<pre class="wp-block-code language-graphql"><code>type Post @model {
  id: ID!
  title: String!
  comments: &#91;Comment] @hasMany
  # tags フィールドを追加、relationNameを指定（Jointテーブルの名前になります）
  tags: &#91;Tag] @manyToMany(relationName: "PostTags")
}

type Tag @model {
  id: ID!
  label: String!
  # tags フィールドを作成、relationNameを指定（Jointテーブルの名前になります）
  posts: &#91;Post] @manyToMany(relationName: "PostTags")
}</code></pre>



<p>amplify push でデプロイすると、以下のように Joint に対応するための中間テーブルが作成され、PostとTagのマッピングを登録します。GraphQL Transformer V1ではこの中間テーブルを自前で定義する必要がありましたが、V2では中間テーブルを自動作成してくれるようになりました。</p>



<h4 class="wp-block-heading">PostTags テーブル</h4>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="1006" height="269" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.29.43.png" alt="" class="wp-image-549" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.29.43.png 1006w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.29.43-300x80.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.29.43-768x205.png 768w" sizes="(max-width: 1006px) 100vw, 1006px" /></figure>



<p>PostとTagの両方からマッピングの一覧を取得できるようにするために、それぞれのGSIが自動作成されます。</p>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="987" height="254" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.29.14.png" alt="" class="wp-image-548" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.29.14.png 987w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.29.14-300x77.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.29.14-768x198.png 768w" sizes="(max-width: 987px) 100vw, 987px" /></figure>



<p>Postに紐付いているタグの一覧を取得する場合、以下のようにクエリーを書くことができます。</p>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="735" height="517" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.25.03-1.png" alt="" class="wp-image-556" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.25.03-1.png 735w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.25.03-1-300x211.png 300w" sizes="(max-width: 735px) 100vw, 735px" /></figure>



<p>同じく、Tagに紐付いているPostの一覧を取得する場合、以下のようにクエリーを書くことができます。</p>



<figure class="wp-block-image size-full"><img decoding="async" loading="lazy" width="648" height="521" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.28.31-2.png" alt="" class="wp-image-558" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.28.31-2.png 648w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/12/Screen-Shot-2022-12-21-at-22.28.31-2-300x241.png 300w" sizes="(max-width: 648px) 100vw, 648px" /></figure>



<p>注意点としては、中間テーブルに独自の項目を追加することはできないので、もし付帯情報の追加など中間テーブルをカスタマイズしたくなった場合は <code>@hasMany</code> &lt;&gt; <code>@belongsTo</code> パターンを利用して「PostTags」テーブルを自前で定義する必要があります。</p>



<pre class="wp-block-code language-graphql"><code>type Post @model {
  id: ID!
  title: String!
  content: String
  tags: &#91;PostTags] @hasMany
}

type Tag @model {
  id: ID!
  label: String!
  posts: &#91;PostTags] @hasMany
}

type PostTags @model {
  id: ID!
  post: Post @belongsTo
  tag: Tag @belongsTo
  # ...
}</code></pre>



<h2 class="wp-block-heading">まとめ</h2>



<ul><li>AWS Amplify バックエンド（GraphQL）のデータモデリングは、大きく４つのリレーションタイプ（ <code>@hasOne</code>, <code>@hasMany</code>, <code>@belongsTo</code>, <code>@manyToMany</code> ）を指定することができる</li><li>各タイプに応じてAppSyncのスキーマ・リゾルバー・DynamoDBのテーブルが自動生成される</li><li>効率よく開発を行うためには、アクセスパターンやユースケースに応じてスキーマ定義を行う</li></ul>



<p>いかがだったでしょうか。以前に比べればやりやすくなったものの、まだまだ覚えることが多いと感じられたかもしれません。ですが、基本的な仕組みをある程度理解しておくことで、結果的にゼロベースで設定または設計を行うよりも手間の削減につながることがあるのではないでしょうか。</p>



<p><a href="https://aws.amazon.com/jp/blogs/news/export-amplify-backends-to-cdk-and-use-with-existing-deployment-pipelines/" data-type="URL" data-id="https://aws.amazon.com/jp/blogs/news/export-amplify-backends-to-cdk-and-use-with-existing-deployment-pipelines/">Amplifyで構築したリソースをCDKへエクスポート</a>するといったことも可能になりましたので、是非一度Amplifyを活用してみてください！</p>
</div><section class="l-share-button" data-v-629ec8b5 data-v-7de3dd27><aside class="p-share-button" data-v-629ec8b5><div class="p-share-button__header" data-v-629ec8b5>SHARE</div><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fserverless.co.jp%2Fblog%2F532%2F" target="_blank" title="Facebookでシェア" class="p-share-button__link--facebook " data-v-629ec8b5><i class="mdi mdi-facebook" data-v-629ec8b5></i></a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fserverless.co.jp%2Fblog%2F532%2F&amp;text=AWS%20Amplify%20GraphQL%20Transformer%20v2%20%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%A2%E3%83%87%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%A8%E3%83%AA%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF%E3%82%92%E8%A7%A3%E8%AA%AC%E3%81%99%E3%82%8B" target="_blank" title="Twitterでシェア" class="p-share-button__link--twitter" data-v-629ec8b5><i class="mdi mdi-twitter" data-v-629ec8b5></i></a></aside></section><div class="post-author-container" data-v-7de3dd27><h5 class="post-author-title" data-v-7de3dd27>Written by</h5><div class="post-author-text" data-v-7de3dd27><p data-v-7de3dd27><span class="role" data-v-7de3dd27>
                      COO
                    </span><span class="name-jp" data-v-7de3dd27>
                      金 仙優
                    </span><span class="name-en" data-v-7de3dd27>
                      Sonu Kim
                    </span></p><p class="author-desc" data-v-7de3dd27>
                    
                  </p><ul class="author-sns" data-v-7de3dd27><li data-v-7de3dd27><!----></li><li data-v-7de3dd27><!----></li><li data-v-7de3dd27><!----></li></ul></div></div></div></div></div><div class="p-news-bg" data-v-7de3dd27></div></article><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><a href="/blog-archives" class="post-archives-link" data-v-7de3dd27><span class="post-archives-link-text" data-v-7de3dd27>BACK TO LIST</span><span data-v-7de3dd27><img src="/assets/img/icon-back-to-list.3add3700.svg" alt="BACK TO LIST アイコン" data-v-7de3dd27></span></a></div></div></div></div></main><footer class="v-footer footer v-sheet v-sheet--tile theme--dark" data-v-a49f4c2c><div class="container" data-v-a49f4c2c data-v-a49f4c2c><div class="row" data-v-a49f4c2c data-v-a49f4c2c><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/works-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Works</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>実績紹介</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-b68eaa08 data-v-a49f4c2c><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/501/" class="c-footer-list__link" data-v-b68eaa08>
      戸田建設株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/396/" class="c-footer-list__link" data-v-b68eaa08>
      北海道テレビ放送株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/358/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社Geolonia
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/24/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社LIXIL
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/185/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社TOKION
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Services</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>サービス紹介</div></a></div><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスオペレーションズの<br data-v-a49f4c2c>サービスと強み</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/iot-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              IoT × サーバーレス / コンテナ開発<br data-v-a49f4c2c>導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/aws-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              AWSコアサーバーレスサービスの開発導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-consulting" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスコンサルティング</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-development" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスディべロプメント</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/our-products" class="c-footer-list__link" data-v-a49f4c2c>
              自社開発プロダクト
            </a></li></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/blog-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Blog</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>開発ブログ</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-39434060 data-v-a49f4c2c><li class="c-footer-list__item" data-v-39434060><a href="/blog/640/" class="c-footer-list__link" data-v-39434060>
      AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/532/" class="c-footer-list__link active--exact active" data-v-39434060>
      AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/512/" class="c-footer-list__link" data-v-39434060>
      AWS Lambda + Nuxt3で実現する「サーバーレスなSSR」とその構成
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/25/" class="c-footer-list__link" data-v-39434060>
      Serverless Frameworkの使い方まとめ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/450/" class="c-footer-list__link" data-v-39434060>
      軽量で簡単に使えるキャッシュSaaS、MomentoをAWS Lambdaから使ってみる
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/429/" class="c-footer-list__link" data-v-39434060>
      Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>About</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>会社案内</div></a><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c>
              会社案内
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/news-archives/" class="c-footer-list__link" data-v-a49f4c2c>
              おしらせ
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/privacy-policy/" class="c-footer-list__link" data-v-a49f4c2c>
              プライバシーポリシー
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/download" class="c-footer-list__link" data-v-a49f4c2c>
              会社資料ダウンロード
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/contact" class="c-footer-list__link" data-v-a49f4c2c>
              お問い合わせ
            </a></li></ul></div></div><div class="row mt-8 mt-md-12" data-v-a49f4c2c data-v-a49f4c2c><div class="col-md-2 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/" class="active" data-v-a49f4c2c><img src="/assets/img/footer-severless-operations-logo.e1e6687a.svg" alt="Severless Operations ロゴ" data-v-a49f4c2c></a></div></div><div class="col-md-10 col-12" data-v-a49f4c2c data-v-a49f4c2c><div class="sns-link text-md-right" data-v-a49f4c2c><a href="https://github.com/serverless-operations" target="_blank" class="sns-link__github" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" data-v-a49f4c2c></i></a><a href="https://twitter.com/slsopsinc" target="_blank" class="sns-link__twitter" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-twitter theme--light" data-v-a49f4c2c></i></a></div></div><div class="footer-copyright" data-v-a49f4c2c>
        © Serverless Operations, inc
      </div></div></div></footer></div></div>
    <script>window.__INITIAL_STATE__={"data":{"wordPressBlog":{"title":"AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する","content":"\n\u003Cp\u003Eこの記事は \u003Ca href=\"https:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2022\u002Famplify\" data-type=\"URL\" data-id=\"https:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2022\u002Famplify\" target=\"_blank\" rel=\"noreferrer noopener\"\u003EAWS AmplifyとAWS×フロントエンド Advent Calendar 2022\u003C\u002Fa\u003E 22日目の記事です。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EAWS Amplify は主にプロトタイプやMVPを開発する際、作りたいと思ったものをクイックに実装できる便利なサービスです。フロントエンドはAmplify Hostingを利用することでホスティング作業が非常に簡単になりました。また、\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fgithub.com\u002Faws-amplify\u002Famplify-js\" data-type=\"URL\" data-id=\"https:\u002F\u002Fgithub.com\u002Faws-amplify\u002Famplify-js\" target=\"_blank\"\u003Eamplify-jsライブラリ\u003C\u002Fa\u003Eを利用すれば、AWS SDKのみを利用するよりも、効率よくAWSの各サービスに連携することが可能になっています。Figmaとの連携など、Amplify Studioを活用する場面もあるかと思います。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E一方、バックエンドについても、GraphQLモードの場合、AppSyncとDynamoDBを利用したオススメの構成を自動生成してくれます。上手く使えばとても役立ちますが、従来まではデータモデリングを含め実現方法のコツを試行錯誤しながら覚える必要がありました。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eそんな中、昨年末GraphQL Transformer V2が発表され、特にデータモデル間のリレーション定義が簡潔に書けるようになりました。基本的な部分さえ押さえれば、実践的に活用または応用することが以前よりやりやすくなりました。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eこの記事では、新しいデータモデリングのリレーション定義にフォーカスして、\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fdocs.amplify.aws\u002Fcli\u002Fgraphql\u002Fdata-modeling\" data-type=\"URL\" data-id=\"https:\u002F\u002Fdocs.amplify.aws\u002Fcli\u002Fgraphql\u002Fdata-modeling\" target=\"_blank\"\u003E公式ドキュメント\u003C\u002Fa\u003Eに基づき新しく追加された４つのディレクティブ（ \u003Ccode\u003E@hasOne\u003C\u002Fcode\u003E, \u003Ccode\u003E@hasMany\u003C\u002Fcode\u003E, \u003Ccode\u003E@belongsTo\u003C\u002Fcode\u003E, \u003Ccode\u003E@manyToMany\u003C\u002Fcode\u003E ）の基本的な使い方について解説します。合わせて、自動生成される仕組みのイメージができるように、DynamoDBの使われ方についても紹介していきます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E\u003Ccode\u003E@hasOne\u003C\u002Fcode\u003E &#8211; 2つのモデル間に一方向の 1:1 リレーションを作成\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eまず、あるプロジェクトとそのプロジェクトを推進するチームがあるとします。また、プロジェクトの担当チームを取得するクエリーを書きたいと想定します。ここで、例えば「各プロジェクトを担当するチームは１つのみ」という仕様がある場合、以下のようにスキーマを定義します。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-graphql\"\u003E\u003Ccode\u003Etype Project @model {\n  id: ID!\n  name: String\n  team: Team @hasOne\n}\n\ntype Team @model {\n  id: ID!\n  name: String!\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eamplify push でデプロイしてレコードを登録してみると、以下のようにDynamoDBがセットされます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003EProject テーブル\u003C\u002Fh4\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"118\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F1_sec1_Project_Table-1-1024x118.png\" alt=\"\" class=\"wp-image-534\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F1_sec1_Project_Table-1-1024x118.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F1_sec1_Project_Table-1-300x34.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F1_sec1_Project_Table-1-768x88.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F1_sec1_Project_Table-1.png 1036w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003E@hasOne\u003C\u002Fcode\u003E ディレクティブは、Teamのレコードを引くための ID （ \u003Ccode\u003EproejctTeamId\u003C\u002Fcode\u003E ） がスキーマに自動追加されます。この項目に担当TeamのID（ \u003Ccode\u003Eteam_1\u003C\u002Fcode\u003E ）を登録することで、ProjectからTeamのレコードが取得できるようになります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003ETeam テーブル\u003C\u002Fh4\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"862\" height=\"113\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F2_sec1_Team_Table.png\" alt=\"\" class=\"wp-image-535\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F2_sec1_Team_Table.png 862w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F2_sec1_Team_Table-300x39.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F2_sec1_Team_Table-768x101.png 768w\" sizes=\"(max-width: 862px) 100vw, 862px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003E「プロジェクトの担当チームを取得する」クエリーのサンプル\u003C\u002Fh4\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"574\" height=\"301\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F3_sec1_Query_Sample-3.png\" alt=\"\" class=\"wp-image-552\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F3_sec1_Query_Sample-3.png 574w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F3_sec1_Query_Sample-3-300x157.png 300w\" sizes=\"(max-width: 574px) 100vw, 574px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003Eこのように、 \u003Ccode\u003E@hasOne\u003C\u002Fcode\u003E ディレクティブは 1:1 の関係にあるレコードのリレーションを定義し、解決するリゾルバーを生成してくれます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E\u003Ccode\u003E@hasMany\u003C\u002Fcode\u003E &#8211; ２つのモデル間に、一方向の 1:N リレーションを作成\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eここでは、ブログの記事（ \u003Ccode\u003EPost\u003C\u002Fcode\u003E ）と、その記事についているコメント欄（ \u003Ccode\u003EComment\u003C\u002Fcode\u003E ）があるとします。また、記事とその記事に投稿されているコメント一覧を一気に取得するクエリーを書くと想定します。「一つの記事」に対して「複数のコメント」がある構成を表現する場合、以下のようにスキーマを定義します。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-graphql\"\u003E\u003Ccode\u003Etype Post @model {\n  id: ID!\n  title: String!\n  comments: &#91;Comment] @hasMany\n}\n\ntype Comment @model {\n  id: ID!\n  content: String!\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eamplify push でデプロイしてレコードを登録してみると、以下のようにDynamoDBがセットされます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003EPost テーブル\u003C\u002Fh4\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"873\" height=\"119\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F4_sec2_Post_Table-1.png\" alt=\"\" class=\"wp-image-540\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F4_sec2_Post_Table-1.png 873w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F4_sec2_Post_Table-1-300x41.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F4_sec2_Post_Table-1-768x105.png 768w\" sizes=\"(max-width: 873px) 100vw, 873px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003EComment テーブル\u003C\u002Fh4\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"166\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F5_sec2_Comment_Table-1024x166.png\" alt=\"\" class=\"wp-image-541\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F5_sec2_Comment_Table-1024x166.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F5_sec2_Comment_Table-300x49.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F5_sec2_Comment_Table-768x125.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F5_sec2_Comment_Table.png 1047w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003E@hasMany\u003C\u002Fcode\u003E の場合、Many（多）になる側（＝Commentテーブル）にマッピング項目が追加され、以下のようにGSI-PKインデックスが自動生成された状態になります。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"194\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F6_sec2_Comment_Table_GSI-1024x194.png\" alt=\"\" class=\"wp-image-542\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F6_sec2_Comment_Table_GSI-1024x194.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F6_sec2_Comment_Table_GSI-300x57.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F6_sec2_Comment_Table_GSI-768x146.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F6_sec2_Comment_Table_GSI.png 1113w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003Eこれにより、以下のようなクエリーを書くことができるようになります。\u003Ccode\u003EpostCommentsId\u003C\u002Fcode\u003E に指定されているPostのIDがGSI-PKとして使われます。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"623\" height=\"487\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F7_sec2_Query_sample_1-2.png\" alt=\"\" class=\"wp-image-553\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F7_sec2_Query_sample_1-2.png 623w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F7_sec2_Query_sample_1-2-300x235.png 300w\" sizes=\"(max-width: 623px) 100vw, 623px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E\u003Ccode\u003EbelongsTo\u003C\u002Fcode\u003E &#8211; 2つのモデルの間に、双方向で 1:1 または 1:N のリレーションを作成\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E簡単にいうと \u003Ccode\u003E@hasOne\u003C\u002Fcode\u003E または \u003Ccode\u003E@hasMany\u003C\u002Fcode\u003E で指定したモデルを、逆方向でも取得できるようにするものです。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E例えば、\u003Ccode\u003E@hasOne\u003C\u002Fcode\u003E で指定したProjectとTeamの関係では、「Project」を指定して「Team」を取得する形でした。もし「Team」から「Project」を取得するクエリーを書きたくなった場合、以下のようにスキーマを定義します。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-graphql\"\u003E\u003Ccode\u003Etype Project @model {\n  id: ID!\n  name: String\n  team: Team @hasOne\n}\n\ntype Team @model {\n  id: ID!\n  name: String!\n  # project フィールドを追加、@belongsTo を指定することでTeamからもProjectを引けるようになる\n  project: Project @belongsTo\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eamplify push でデプロイしてTeamのレコードにProjectを登録してみます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003ETeam テーブル\u003C\u002Fh4\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"120\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F9_sec3_Team_Table-1024x120.png\" alt=\"\" class=\"wp-image-545\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F9_sec3_Team_Table-1024x120.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F9_sec3_Team_Table-300x35.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F9_sec3_Team_Table-768x90.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F9_sec3_Team_Table.png 1032w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003EteamProjectId\u003C\u002Fcode\u003E という項目がスキーマに自動追加されますので、ここにProjectのIDを指定することで、\u003Ccode\u003E@hasOne\u003C\u002Fcode\u003E パターンとは逆の方向からProjectを取得できるようになります。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E以下、クエリーのサンプルです。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"582\" height=\"307\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F10_sec3_Team_Query_Sample-1.png\" alt=\"\" class=\"wp-image-554\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F10_sec3_Team_Query_Sample-1.png 582w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F10_sec3_Team_Query_Sample-1-300x158.png 300w\" sizes=\"(max-width: 582px) 100vw, 582px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003Eこのように、Teamから紐付いているProjectのレコードを引けるようになります。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E※マッピング用の項目名（ &#8220;projectTeamId&#8221; など）が紛らわしくて気になる方は、\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fdocs.amplify.aws\u002Fcli\u002Fgraphql\u002Fdata-modeling\u002F#belongs-to-relationship\" data-type=\"URL\" data-id=\"https:\u002F\u002Fdocs.amplify.aws\u002Fcli\u002Fgraphql\u002Fdata-modeling\u002F#belongs-to-relationship\" target=\"_blank\"\u003E公式ドキュメント\u003C\u002Fa\u003Eにて任意のキー名を指定する方法がありますので是非ご参照ください。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E続いて、\u003Ccode\u003E@hasMany\u003C\u002Fcode\u003E の場合、PostからComment一覧を取得する形でした。もし、Commentを指定してそのコメントが紐付いているPostを見つけたくなった場合、以下のようにスキーマを定義します。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-graphql\"\u003E\u003Ccode\u003Etype Post @model {\n  id: ID!\n  title: String!\n  comments: &#91;Comment] @hasMany\n}\n\ntype Comment @model {\n  id: ID!\n  content: String!\n  # project フィールドを追加、@belongsTo を指定することでCommentからもPostを引けるようになる\n  post: Post @belongsTo\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eこれを amplify push でデプロイすると、以下のようにpostが引けるようになります。スキーマとリゾルバが自動追加され、DynamoDBの構成には変更ありません。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"582\" height=\"300\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F11_sec3_Comment_Query_After-1.png\" alt=\"\" class=\"wp-image-555\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F11_sec3_Comment_Query_After-1.png 582w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002F11_sec3_Comment_Query_After-1-300x155.png 300w\" sizes=\"(max-width: 582px) 100vw, 582px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E\u003Ccode\u003E@manyToMany\u003C\u002Fcode\u003E &#8211; ２つのモデルの N:N リレーションを作成\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E２つのモデルを Joint する対応が必要になるケースです。例えば、記事（ \u003Ccode\u003EPost\u003C\u002Fcode\u003E ）にタグ付け（ \u003Ccode\u003ETag\u003C\u002Fcode\u003E ）を行うとし、以下のような状態を考えてみます。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003Eタグは「タグA」「タグB」「タグC 」の３種類がある\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E「記事A」には「タグA」と「タグB」が指定されている\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E「記事B」には「タグB」と「タグC」が指定されている\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003Eこの状態で、以下２つのユースケースがあると想定します。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E「記事A」に指定されているタグの一覧を取得する\u003C\u002Fli\u003E\u003Cli\u003E「タグB」が指定されている記事の一覧を取得する\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003Eこれらを実現するためのスキーマは以下のように定義します。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-graphql\"\u003E\u003Ccode\u003Etype Post @model {\n  id: ID!\n  title: String!\n  comments: &#91;Comment] @hasMany\n  # tags フィールドを追加、relationNameを指定（Jointテーブルの名前になります）\n  tags: &#91;Tag] @manyToMany(relationName: \"PostTags\")\n}\n\ntype Tag @model {\n  id: ID!\n  label: String!\n  # tags フィールドを作成、relationNameを指定（Jointテーブルの名前になります）\n  posts: &#91;Post] @manyToMany(relationName: \"PostTags\")\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eamplify push でデプロイすると、以下のように Joint に対応するための中間テーブルが作成され、PostとTagのマッピングを登録します。GraphQL Transformer V1ではこの中間テーブルを自前で定義する必要がありましたが、V2では中間テーブルを自動作成してくれるようになりました。\u003C\u002Fp\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003EPostTags テーブル\u003C\u002Fh4\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1006\" height=\"269\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.29.43.png\" alt=\"\" class=\"wp-image-549\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.29.43.png 1006w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.29.43-300x80.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.29.43-768x205.png 768w\" sizes=\"(max-width: 1006px) 100vw, 1006px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003EPostとTagの両方からマッピングの一覧を取得できるようにするために、それぞれのGSIが自動作成されます。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"987\" height=\"254\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.29.14.png\" alt=\"\" class=\"wp-image-548\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.29.14.png 987w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.29.14-300x77.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.29.14-768x198.png 768w\" sizes=\"(max-width: 987px) 100vw, 987px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003EPostに紐付いているタグの一覧を取得する場合、以下のようにクエリーを書くことができます。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"735\" height=\"517\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.25.03-1.png\" alt=\"\" class=\"wp-image-556\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.25.03-1.png 735w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.25.03-1-300x211.png 300w\" sizes=\"(max-width: 735px) 100vw, 735px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003E同じく、Tagに紐付いているPostの一覧を取得する場合、以下のようにクエリーを書くことができます。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"648\" height=\"521\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.28.31-2.png\" alt=\"\" class=\"wp-image-558\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.28.31-2.png 648w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F12\u002FScreen-Shot-2022-12-21-at-22.28.31-2-300x241.png 300w\" sizes=\"(max-width: 648px) 100vw, 648px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003E注意点としては、中間テーブルに独自の項目を追加することはできないので、もし付帯情報の追加など中間テーブルをカスタマイズしたくなった場合は \u003Ccode\u003E@hasMany\u003C\u002Fcode\u003E &lt;&gt; \u003Ccode\u003E@belongsTo\u003C\u002Fcode\u003E パターンを利用して「PostTags」テーブルを自前で定義する必要があります。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-graphql\"\u003E\u003Ccode\u003Etype Post @model {\n  id: ID!\n  title: String!\n  content: String\n  tags: &#91;PostTags] @hasMany\n}\n\ntype Tag @model {\n  id: ID!\n  label: String!\n  posts: &#91;PostTags] @hasMany\n}\n\ntype PostTags @model {\n  id: ID!\n  post: Post @belongsTo\n  tag: Tag @belongsTo\n  # ...\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eまとめ\u003C\u002Fh2\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003EAWS Amplify バックエンド（GraphQL）のデータモデリングは、大きく４つのリレーションタイプ（ \u003Ccode\u003E@hasOne\u003C\u002Fcode\u003E, \u003Ccode\u003E@hasMany\u003C\u002Fcode\u003E, \u003Ccode\u003E@belongsTo\u003C\u002Fcode\u003E, \u003Ccode\u003E@manyToMany\u003C\u002Fcode\u003E ）を指定することができる\u003C\u002Fli\u003E\u003Cli\u003E各タイプに応じてAppSyncのスキーマ・リゾルバー・DynamoDBのテーブルが自動生成される\u003C\u002Fli\u003E\u003Cli\u003E効率よく開発を行うためには、アクセスパターンやユースケースに応じてスキーマ定義を行う\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003Eいかがだったでしょうか。以前に比べればやりやすくなったものの、まだまだ覚えることが多いと感じられたかもしれません。ですが、基本的な仕組みをある程度理解しておくことで、結果的にゼロベースで設定または設計を行うよりも手間の削減につながることがあるのではないでしょうか。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Faws.amazon.com\u002Fjp\u002Fblogs\u002Fnews\u002Fexport-amplify-backends-to-cdk-and-use-with-existing-deployment-pipelines\u002F\" data-type=\"URL\" data-id=\"https:\u002F\u002Faws.amazon.com\u002Fjp\u002Fblogs\u002Fnews\u002Fexport-amplify-backends-to-cdk-and-use-with-existing-deployment-pipelines\u002F\"\u003EAmplifyで構築したリソースをCDKへエクスポート\u003C\u002Fa\u003Eするといったことも可能になりましたので、是非一度Amplifyを活用してみてください！\u003C\u002Fp\u003E\n","author":{"name":"Sonu Kim","description":"","avatars":{"avatar96":"https:\u002F\u002Fsecure.gravatar.com\u002Favatar\u002F5b527696e38c84c34048954d767b1537?s=96&d=mm&r=g"},"acf":{"userJpName":"金 仙優","userRole":"COO","facebook":"","twitter":"","github":""}},"date":"2022.12.21","path":"\u002Fblog\u002F532\u002F","featuredMedia":{"sourceUrl":"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2020\u002F05\u002Fso-release.png","altText":"so-release-image","mediaDetails":{"width":1200}},"categories":[{"id":"7","title":"Blog","path":"\u002Fcategory\u002Fblog\u002F"}],"tags":[{"id":"53","title":"Amplify","path":"\u002Ftag\u002Famplify\u002F"},{"id":"19","title":"Appsync","path":"\u002Ftag\u002Fappsync\u002F"},{"id":"14","title":"DynamoDB","path":"\u002Ftag\u002Fdynamodb\u002F"},{"id":"54","title":"GraphQL","path":"\u002Ftag\u002Fgraphql\u002F"},{"id":"2","title":"Serverless","path":"\u002Ftag\u002Fserverless\u002F"}]},"metadata":{"siteName":"Serverless Operations","siteDescription":"Serverless Operationsは、これまでグローバルの第一線で培ってきたクラウド技術（AWS − アマゾンウェブサービス）の豊富な実績と知見を活かし、お客さまのサーバーレスによる開発や運用の支援、コンサルティングまで一貫してサポート。サーバーレスに関するさまざまな課題を解決いたします。","siteUrl":"https:\u002F\u002Fserverless.co.jp","siteOgImage":"https:\u002F\u002Fserverless.co.jp\u002Fogp.png"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.7f894eb2.js" defer></script><script src="/assets/js/page--src--templates--word-press-blog-vue.fdf3ed1a.js" defer></script><script data-vue-tag="ssr" src="https://webfont.fontplus.jp/accessor/script/fontplus.js?LuMx0zy9taw%3D&box=ME4Rs88c3-0%3D&aa=1&ab=2" data-body="true"></script>
  </body>
</html>
