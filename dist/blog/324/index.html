<!DOCTYPE html>
<html data-html-server-rendered="true" lang="ja" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22ja%22%7D%7D">
  <head>
    <title>AWSにおけるAPI開発にてGraphQL(AppSync)とREST API(API Gateway) を選定する際のメリットとデメリット | Serverless Operations</title><meta name="gridsome:hash" content="899a7dadc9c3ff481284dbd8cf731b9f93beffd5"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="og:locale" property="og:locale" content="ja_JP"><meta data-vue-tag="ssr" data-key="og:site_name" property="og:site_name" content="Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://serverless.co.jp/ogp.png"><meta data-vue-tag="ssr" data-key="og:type" property="og:type" content="article"><meta data-vue-tag="ssr" data-key="og:url" property="og:url" content="https://serverless.co.jp/blog/324/"><meta data-vue-tag="ssr" data-key="og:image" property="og:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2020/05/so-release.png"><meta data-vue-tag="ssr" data-key="og:title" property="og:title" content="AWSにおけるAPI開発にてGraphQL(AppSync)とREST API(API Gateway) を選定する際のメリットとデメリット | Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2020/05/so-release.png"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css"><link data-vue-tag="ssr" data-key="canonical" rel="canonical" href="https://serverless.co.jp/blog/324/"><link rel="preload" href="/assets/css/0.styles.adfe40b8.css" as="style"><link rel="preload" href="/assets/js/app.f355efd1.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--word-press-blog-vue.fdf3ed1a.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.84e8aa18.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.094252a3.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-archives-vue.771d12fd.js"><link rel="prefetch" href="/assets/js/page--src--pages--contact-vue.c49312ad.js"><link rel="prefetch" href="/assets/js/page--src--pages--download-vue.e2fb64ed.js"><link rel="prefetch" href="/assets/js/page--src--pages--event-archives-vue.dc6c64cc.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.8d1729b1.js"><link rel="prefetch" href="/assets/js/page--src--pages--news-archives-vue.2871bf8d.js"><link rel="prefetch" href="/assets/js/page--src--pages--our-products-vue.d569f152.js"><link rel="prefetch" href="/assets/js/page--src--pages--privacy-policy-vue.9015b9cf.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue.548b9c96.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue~page--src--pages--services--iot-serverless-vue.bada637e.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--index-vue.605da173.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--iot-serverless-vue.1324af58.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-consulting-vue.bf933f33.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-development-vue.d8c60529.js"><link rel="prefetch" href="/assets/js/page--src--pages--test-form-vue.37425afa.js"><link rel="prefetch" href="/assets/js/page--src--pages--works-archives-vue.b641ea0a.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-category-vue.7424850d.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-tag-vue.a058c92f.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-vue.8fb7ceee.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-works-vue.dc66c364.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--contact-vue~page--src--pages--download-vue.7a23cb3f.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--our-products-vue.8e9052c2.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-blog-vue.16b09ab1.js"><link rel="stylesheet" href="/assets/css/0.styles.adfe40b8.css"><script data-vue-tag="ssr">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MLP4448');</script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="v-application v-application--is-ltr theme--dark" data-v-7de3dd27><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MLP4448" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="v-application--wrap"><header class="header-nav" data-v-5f4f5539><div class="header-nav__logo-block" data-v-5f4f5539><a href="/" class="header-nav__logo-link active" data-v-5f4f5539><img src="/assets/img/header-logo.a93f880b.svg" alt="Severless Operations ロゴ" class="header-nav__logo" data-v-5f4f5539></a></div><nav data-v-5f4f5539><ul data-v-5f4f5539><li data-v-5f4f5539><a href="/about" data-v-5f4f5539>私たちについて</a></li><li data-v-5f4f5539><a href="/services" data-v-5f4f5539>サービス</a></li><li data-v-5f4f5539><a href="/works-archives" data-v-5f4f5539>実績紹介</a></li><li data-v-5f4f5539><a href="/blog-archives" data-v-5f4f5539>ブログ</a></li><li data-v-5f4f5539><a href="/news-archives" data-v-5f4f5539>お知らせ</a></li><li data-v-5f4f5539><a href="/download" data-v-5f4f5539>会社資料ダウンロード</a></li><li data-v-5f4f5539><a href="/contact" data-v-5f4f5539>お問い合わせ</a></li></ul></nav><div id="app" class="header-nav__toggler-block d-block d-md-none" data-v-5f4f5539><button id="btn" type="button" class="header-nav__toggler-button btn" data-v-5f4f5539><div tabindex="-1" class="btn__content" data-v-5f4f5539><span class="header-nav__toggler-top" data-v-5f4f5539></span><span class="header-nav__toggler-middle" data-v-5f4f5539></span><span class="header-nav__toggler-bottom" data-v-5f4f5539></span></div></button></div><!----></header><main class="v-content"><div class="v-content" data-v-7de3dd27><div class="v-content__wrap" data-v-7de3dd27><div class="container" data-v-7de3dd27><p class="category-title" data-v-7de3dd27>
          Blog
        </p></div><header class="post-header" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="col-md-10 col-11" data-v-7de3dd27><h1 class="post-title" data-v-7de3dd27>AWSにおけるAPI開発にてGraphQL(AppSync)とREST API(API Gateway) を選定する際のメリットとデメリット</h1><div class="post-tag-container" data-v-7de3dd27><time datetime="2021.01.12" class="post-date" data-v-7de3dd27> 
                  2021.01.12
                  
                </time><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>API Gateway</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Appsync</span></div></div></div></div></div></header><article class="post-container" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="post-article-container col-md-10 col-11" data-v-7de3dd27><div class="post-article" data-v-7de3dd27>
<p>最近何かと話題になってきた GraphQL ですが、AWS では AppSync という GraphQL サービスがあります。2018年リリースされて以来、サーバーレスコミュニティの中でも年々関心が高まっており、実例も増えてきています。GraphQL は、主流となった REST と比べるとまだ新しい技術と言えますが、この度 Costless の開発で実際に採用してみて、どのような利点と大変さがあったか、整理しておきたいと思います。</p>



<h2 class="wp-block-heading">おさらい</h2>



<p>本題に入る前に、冒頭で触れている REST, GrapgQL, また AWS の GraphQL サービスである AppSync について簡単に触れておきます。</p>



<h3 class="wp-block-heading">REST API</h3>



<p>Web API を定義するためのアーキテクチャスタイルで、データの送受信はステートレスになること、対象のリソースを URI として一位に識別できるように表現すること、HTTP メソッドを利用してそのリソースに対する操作を定義することが原則となります。これにより、API定義の一貫性が保たれ、クライアントとのステートレスなデータの送受信、統合的なインタフェースを作りやすくなるといったメリットがあります。</p>



<h3 class="wp-block-heading">GraphQL</h3>



<p>従来の Web API より効率的かつフレキシブルなアプローチができることで知られているクエリー言語です。すべての操作が一つのエンドポイントを通して実現でき、予め送受信するデータのスキーマを定義しておく必要があります。これにより、クライアントサイドから柔軟にクエリができるようになります。また、一般的なデータの取得と更新に加えて、リアルタイムに通知のやり取りができる仕様 Subscription が含まれています。</p>



<h3 class="wp-block-heading">AppSync</h3>



<p>2018年にリリースされた、AWS のサーバーレスな GraphQL サービスです。 GraphQL スキーマを定義し、Lambda や DynamoDB といった AWS サービスをデータソースとするシームレスな連携ができたり、AWS Amplify と組み合わせてオンライン／オフラインのデータ同期ができるといった特徴があります。</p>



<h2 class="wp-block-heading">Costless で AppSync / GraphQL を選定した背景</h2>



<p>弊社ではサーバーレスに特化したコスト管理サービス「Costless」をリリースしました。この Costless を開発するにあたって、Costless 自体も AWS サーバーレスアーキテクチャで構成されていますが、弊社開発チームではそれに加え以下のような理由でバックエンドに AppSync を全面的に採用することにしました。</p>



<ul><li>顧客の AWS アカウントと Costless を連携する際に CloudFormation Custom Resources を使う必要があり、CloudFormation の展開が完了したことをリアルタイムでフロントエンドへ通知する必要があった</li><li>通知を受けたいのは自分がセットしたものだけで、複数ユーザー間や双方向のやり取りは不要（API Gateway の Websocket ではオーバースペック）</li><li>AppSync/GraphQL が話題になることが増えていることも鑑み、新しい技術を使うチャンスと捉える</li></ul>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="949" height="1024" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/01/Costless_AWS_Architecture-949x1024.png" alt="" class="wp-image-325" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/01/Costless_AWS_Architecture-949x1024.png 949w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/01/Costless_AWS_Architecture-278x300.png 278w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/01/Costless_AWS_Architecture-768x829.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/01/Costless_AWS_Architecture.png 1001w" sizes="(max-width: 949px) 100vw, 949px" /></figure>



<h2 class="wp-block-heading">AppSync を使ってみて、REST で作る場合と比べてみる</h2>



<p>それでは、実際 Costless のバックエンドを AppSync/GraphQL メインで実装してみて分かったところについて、慣れ親しんだ REST と比較して良かったところ・大変だったところを紹介します。</p>



<h3 class="wp-block-heading">良かったところ</h3>



<h4 class="wp-block-heading">① GraphQL スキーマ定義によるバリデーション</h4>



<p>文字列や数字といった基本的なデータ型のバリデーションについては、GraphQL スキーマで定義した通りのデータ型によりチェックされるため、個別に行う必要はありません。</p>



<p>REST の場合は仕様ドキュメントレベルで各データ項目の型を定義し、実装に反映する必要があります。また、そういった定義を書くための Open API といった仕組みは充実してきていますが、実装とドキュメントが分離している状況に変わりはなく、大規模になっていくに連れて双方の整合性を維持・管理することがペインポイントとなることもあります。</p>



<pre class="wp-block-code language-graphql"><code>type User {
  id: ID!
  name: String!
  email: AWSEmail!
  version: Int!
}
input UpdateUserInput {
  name: String!
  email: AWSEmail!
  version: Int!
}</code></pre>



<p>※スキーマに合っていないデータが送受信される場合はエラーになる</p>



<h4 class="wp-block-heading">② Subscription を使ったリアルタイム通知の手軽さ</h4>



<p>リアルタイム通知に関しては API Gateway の Websocket で実装することも可能ですが、そういった手間を書けることなくシンプルに実現できる手軽さがあります。</p>



<pre class="wp-block-code language-graphql"><code>type Subscription {
  onCreateProject(id: ID!): CreateProjectResult @aws_subscribe(mutations: &#91;"createProject"])
}
type Mutation {
  createProject(input: CreateProjectInput!): CreateProjectResult!
}
type CreateProjectByCfnResult {
  id: ID!
  name: String!
  version: Int!
}</code></pre>



<pre class="wp-block-preformatted"></pre>



<p>※プロジェクト作成が完了したら呼び出し元（フロントエンド）へ通知が出される</p>



<h4 class="wp-block-heading">③ AppSync からの DynamoDB CRUD操作が便利</h4>



<p>AppSync で受けたリクエストは、Lambda を介さずとも、VTL（Apache Velocity Template Language）というテンプレート言語を使ってシームレスに DynamoDB などの他のサービスと連携することが可能です。ただ、これについては仕様が複雑になるについて最も辛くなるところでもありますので悩ましい部分もあります。</p>



<pre class="wp-block-code language-velocity"><code>#set($userId = "user#$context.identity.sub")
{
  "version": "2018-05-29",
  "operation": "GetItem",
  "key": {
    "id": $util.dynamodb.toDynamoDBJson($userId)
  }
}</code></pre>



<pre class="wp-block-preformatted"></pre>



<h3 class="wp-block-heading">大変だったところ</h3>



<p>AppSync では、GraphQL スキーマで定義した項目の値を解決するためのリゾルバーの設定に、前述の VTL というテンプレート言語を書く必要があります。DynamoDB へのCRUD操作といった簡単なケースでは問題にならないですが、例えばデータにアクセスするための権限チェックや条件分岐が発生するようなケースでは、テンプレート言語であるがゆえに複雑でテストがしづらくなります。</p>



<pre class="wp-block-code language-velocity"><code>## Note: this logic exists in aaa.response.vtl...
## Check all files when the logic is modified.
#set($project = $context.result)
#if($project.status == "STATUS-1")
  #set($status = "STATUS-1")
#elseif($project.status == "STATUS-2")
  #set($status = "STATUS-2")
  #set($now = $util.time.nowEpochMilliSeconds())
  #if($now &lt; $project.date)
    #set($status = "STATUS-3")
  #end
#elseif($project.status == "STATUS-4")
  #set($status = "STATUS-4")
#end</code></pre>



<pre class="wp-block-preformatted"></pre>



<p>こうした背景から頑張って VTL を書く代わりに AWS CDK や Direct Lambda Resolver を採用するといった方法はありますが、Costless チームではなるべく AppSync を使い倒す意図である程度 VTL と向き合って開発を進めてきました。これに関しては、定番の API Gateway + Lambda + DynamoDB 構成の REST にしていたら、きちんと仕様を詰めてさえいれば特に問題とならないでしょう。</p>



<h2 class="wp-block-heading">まとめ</h2>



<ul><li>「Costless」のバックエンド開発に AppSync/GraphQLを採用</li><li>AppSync/GraphQLを使うと、GraphQLのスキーマ定義によりAPI定義と入力チェックが一元管理でき、Subscriptionを使って通知機能を手軽に管理できるといったメリットがある</li><li>一方、AppSync でリゾルバーを設定するにはVTLを書かなければならず、仕様が複雑になっていくに連れてペインポイントとなりやすい</li></ul>
</div><section class="l-share-button" data-v-629ec8b5 data-v-7de3dd27><aside class="p-share-button" data-v-629ec8b5><div class="p-share-button__header" data-v-629ec8b5>SHARE</div><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fserverless.co.jp%2Fblog%2F324%2F" target="_blank" title="Facebookでシェア" class="p-share-button__link--facebook " data-v-629ec8b5><i class="mdi mdi-facebook" data-v-629ec8b5></i></a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fserverless.co.jp%2Fblog%2F324%2F&amp;text=AWS%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8BAPI%E9%96%8B%E7%99%BA%E3%81%AB%E3%81%A6GraphQL(AppSync)%E3%81%A8REST%20API(API%20Gateway)%C2%A0%E3%82%92%E9%81%B8%E5%AE%9A%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%A8%E3%83%87%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88" target="_blank" title="Twitterでシェア" class="p-share-button__link--twitter" data-v-629ec8b5><i class="mdi mdi-twitter" data-v-629ec8b5></i></a></aside></section><div class="post-author-container" data-v-7de3dd27><h5 class="post-author-title" data-v-7de3dd27>Written by</h5><div class="post-author-text" data-v-7de3dd27><p data-v-7de3dd27><span class="role" data-v-7de3dd27>
                      COO
                    </span><span class="name-jp" data-v-7de3dd27>
                      金 仙優
                    </span><span class="name-en" data-v-7de3dd27>
                      Sonu Kim
                    </span></p><p class="author-desc" data-v-7de3dd27>
                    
                  </p><ul class="author-sns" data-v-7de3dd27><li data-v-7de3dd27><!----></li><li data-v-7de3dd27><!----></li><li data-v-7de3dd27><!----></li></ul></div></div></div></div></div><div class="p-news-bg" data-v-7de3dd27></div></article><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><a href="/blog-archives" class="post-archives-link" data-v-7de3dd27><span class="post-archives-link-text" data-v-7de3dd27>BACK TO LIST</span><span data-v-7de3dd27><img src="/assets/img/icon-back-to-list.3add3700.svg" alt="BACK TO LIST アイコン" data-v-7de3dd27></span></a></div></div></div></div></main><footer class="v-footer footer v-sheet v-sheet--tile theme--dark" data-v-a49f4c2c><div class="container" data-v-a49f4c2c data-v-a49f4c2c><div class="row" data-v-a49f4c2c data-v-a49f4c2c><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/works-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Works</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>実績紹介</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-b68eaa08 data-v-a49f4c2c><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/666/" class="c-footer-list__link" data-v-b68eaa08>
      A社（企業名非公開）
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/501/" class="c-footer-list__link" data-v-b68eaa08>
      戸田建設株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/396/" class="c-footer-list__link" data-v-b68eaa08>
      北海道テレビ放送株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/358/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社Geolonia
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/24/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社LIXIL
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/185/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社TOKION
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Services</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>サービス紹介</div></a></div><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスオペレーションズの<br data-v-a49f4c2c>サービスと強み</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/iot-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              IoT × サーバーレス / コンテナ開発<br data-v-a49f4c2c>導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/aws-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              AWSコアサーバーレスサービスの開発導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-consulting" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスコンサルティング</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-development" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスディべロプメント</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/our-products" class="c-footer-list__link" data-v-a49f4c2c>
              自社開発プロダクト
            </a></li></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/blog-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Blog</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>開発ブログ</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-39434060 data-v-a49f4c2c><li class="c-footer-list__item" data-v-39434060><a href="/blog/640/" class="c-footer-list__link" data-v-39434060>
      AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/532/" class="c-footer-list__link" data-v-39434060>
      AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/512/" class="c-footer-list__link" data-v-39434060>
      AWS Lambda + Nuxt3で実現する「サーバーレスなSSR」とその構成
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/25/" class="c-footer-list__link" data-v-39434060>
      Serverless Frameworkの使い方まとめ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/450/" class="c-footer-list__link" data-v-39434060>
      軽量で簡単に使えるキャッシュSaaS、MomentoをAWS Lambdaから使ってみる
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/429/" class="c-footer-list__link" data-v-39434060>
      Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>About</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>会社案内</div></a><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c>
              会社案内
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/news-archives/" class="c-footer-list__link" data-v-a49f4c2c>
              おしらせ
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/privacy-policy/" class="c-footer-list__link" data-v-a49f4c2c>
              プライバシーポリシー
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/download" class="c-footer-list__link" data-v-a49f4c2c>
              会社資料ダウンロード
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/contact" class="c-footer-list__link" data-v-a49f4c2c>
              お問い合わせ
            </a></li></ul></div></div><div class="row mt-8 mt-md-12" data-v-a49f4c2c data-v-a49f4c2c><div class="col-md-2 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/" class="active" data-v-a49f4c2c><img src="/assets/img/footer-severless-operations-logo.e1e6687a.svg" alt="Severless Operations ロゴ" data-v-a49f4c2c></a></div></div><div class="col-md-10 col-12" data-v-a49f4c2c data-v-a49f4c2c><div class="sns-link text-md-right" data-v-a49f4c2c><a href="https://github.com/serverless-operations" target="_blank" class="sns-link__github" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" data-v-a49f4c2c></i></a><a href="https://twitter.com/slsopsinc" target="_blank" class="sns-link__twitter" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-twitter theme--light" data-v-a49f4c2c></i></a></div></div><div class="footer-copyright" data-v-a49f4c2c>
        © Serverless Operations, inc
      </div></div></div></footer></div></div>
    <script>window.__INITIAL_STATE__={"data":{"wordPressBlog":{"title":"AWSにおけるAPI開発にてGraphQL(AppSync)とREST API(API Gateway) を選定する際のメリットとデメリット","content":"\n\u003Cp\u003E最近何かと話題になってきた GraphQL ですが、AWS では AppSync という GraphQL サービスがあります。2018年リリースされて以来、サーバーレスコミュニティの中でも年々関心が高まっており、実例も増えてきています。GraphQL は、主流となった REST と比べるとまだ新しい技術と言えますが、この度 Costless の開発で実際に採用してみて、どのような利点と大変さがあったか、整理しておきたいと思います。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eおさらい\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E本題に入る前に、冒頭で触れている REST, GrapgQL, また AWS の GraphQL サービスである AppSync について簡単に触れておきます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003EREST API\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003EWeb API を定義するためのアーキテクチャスタイルで、データの送受信はステートレスになること、対象のリソースを URI として一位に識別できるように表現すること、HTTP メソッドを利用してそのリソースに対する操作を定義することが原則となります。これにより、API定義の一貫性が保たれ、クライアントとのステートレスなデータの送受信、統合的なインタフェースを作りやすくなるといったメリットがあります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003EGraphQL\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003E従来の Web API より効率的かつフレキシブルなアプローチができることで知られているクエリー言語です。すべての操作が一つのエンドポイントを通して実現でき、予め送受信するデータのスキーマを定義しておく必要があります。これにより、クライアントサイドから柔軟にクエリができるようになります。また、一般的なデータの取得と更新に加えて、リアルタイムに通知のやり取りができる仕様 Subscription が含まれています。\u003C\u002Fp\u003E\n\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003EAppSync\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003E2018年にリリースされた、AWS のサーバーレスな GraphQL サービスです。 GraphQL スキーマを定義し、Lambda や DynamoDB といった AWS サービスをデータソースとするシームレスな連携ができたり、AWS Amplify と組み合わせてオンライン／オフラインのデータ同期ができるといった特徴があります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003ECostless で AppSync \u002F GraphQL を選定した背景\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E弊社ではサーバーレスに特化したコスト管理サービス「Costless」をリリースしました。この Costless を開発するにあたって、Costless 自体も AWS サーバーレスアーキテクチャで構成されていますが、弊社開発チームではそれに加え以下のような理由でバックエンドに AppSync を全面的に採用することにしました。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E顧客の AWS アカウントと Costless を連携する際に CloudFormation Custom Resources を使う必要があり、CloudFormation の展開が完了したことをリアルタイムでフロントエンドへ通知する必要があった\u003C\u002Fli\u003E\u003Cli\u003E通知を受けたいのは自分がセットしたものだけで、複数ユーザー間や双方向のやり取りは不要（API Gateway の Websocket ではオーバースペック）\u003C\u002Fli\u003E\u003Cli\u003EAppSync\u002FGraphQL が話題になることが増えていることも鑑み、新しい技術を使うチャンスと捉える\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"949\" height=\"1024\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F01\u002FCostless_AWS_Architecture-949x1024.png\" alt=\"\" class=\"wp-image-325\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F01\u002FCostless_AWS_Architecture-949x1024.png 949w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F01\u002FCostless_AWS_Architecture-278x300.png 278w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F01\u002FCostless_AWS_Architecture-768x829.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F01\u002FCostless_AWS_Architecture.png 1001w\" sizes=\"(max-width: 949px) 100vw, 949px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003EAppSync を使ってみて、REST で作る場合と比べてみる\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eそれでは、実際 Costless のバックエンドを AppSync\u002FGraphQL メインで実装してみて分かったところについて、慣れ親しんだ REST と比較して良かったところ・大変だったところを紹介します。\u003C\u002Fp\u003E\n\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003E良かったところ\u003C\u002Fh3\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003E① GraphQL スキーマ定義によるバリデーション\u003C\u002Fh4\u003E\n\n\n\n\u003Cp\u003E文字列や数字といった基本的なデータ型のバリデーションについては、GraphQL スキーマで定義した通りのデータ型によりチェックされるため、個別に行う必要はありません。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EREST の場合は仕様ドキュメントレベルで各データ項目の型を定義し、実装に反映する必要があります。また、そういった定義を書くための Open API といった仕組みは充実してきていますが、実装とドキュメントが分離している状況に変わりはなく、大規模になっていくに連れて双方の整合性を維持・管理することがペインポイントとなることもあります。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-graphql\"\u003E\u003Ccode\u003Etype User {\n  id: ID!\n  name: String!\n  email: AWSEmail!\n  version: Int!\n}\ninput UpdateUserInput {\n  name: String!\n  email: AWSEmail!\n  version: Int!\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E※スキーマに合っていないデータが送受信される場合はエラーになる\u003C\u002Fp\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003E② Subscription を使ったリアルタイム通知の手軽さ\u003C\u002Fh4\u003E\n\n\n\n\u003Cp\u003Eリアルタイム通知に関しては API Gateway の Websocket で実装することも可能ですが、そういった手間を書けることなくシンプルに実現できる手軽さがあります。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-graphql\"\u003E\u003Ccode\u003Etype Subscription {\n  onCreateProject(id: ID!): CreateProjectResult @aws_subscribe(mutations: &#91;\"createProject\"])\n}\ntype Mutation {\n  createProject(input: CreateProjectInput!): CreateProjectResult!\n}\ntype CreateProjectByCfnResult {\n  id: ID!\n  name: String!\n  version: Int!\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E※プロジェクト作成が完了したら呼び出し元（フロントエンド）へ通知が出される\u003C\u002Fp\u003E\n\n\n\n\u003Ch4 class=\"wp-block-heading\"\u003E③ AppSync からの DynamoDB CRUD操作が便利\u003C\u002Fh4\u003E\n\n\n\n\u003Cp\u003EAppSync で受けたリクエストは、Lambda を介さずとも、VTL（Apache Velocity Template Language）というテンプレート言語を使ってシームレスに DynamoDB などの他のサービスと連携することが可能です。ただ、これについては仕様が複雑になるについて最も辛くなるところでもありますので悩ましい部分もあります。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-velocity\"\u003E\u003Ccode\u003E#set($userId = \"user#$context.identity.sub\")\n{\n  \"version\": \"2018-05-29\",\n  \"operation\": \"GetItem\",\n  \"key\": {\n    \"id\": $util.dynamodb.toDynamoDBJson($userId)\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003E大変だったところ\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003EAppSync では、GraphQL スキーマで定義した項目の値を解決するためのリゾルバーの設定に、前述の VTL というテンプレート言語を書く必要があります。DynamoDB へのCRUD操作といった簡単なケースでは問題にならないですが、例えばデータにアクセスするための権限チェックや条件分岐が発生するようなケースでは、テンプレート言語であるがゆえに複雑でテストがしづらくなります。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-velocity\"\u003E\u003Ccode\u003E## Note: this logic exists in aaa.response.vtl...\n## Check all files when the logic is modified.\n#set($project = $context.result)\n#if($project.status == \"STATUS-1\")\n  #set($status = \"STATUS-1\")\n#elseif($project.status == \"STATUS-2\")\n  #set($status = \"STATUS-2\")\n  #set($now = $util.time.nowEpochMilliSeconds())\n  #if($now &lt; $project.date)\n    #set($status = \"STATUS-3\")\n  #end\n#elseif($project.status == \"STATUS-4\")\n  #set($status = \"STATUS-4\")\n#end\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eこうした背景から頑張って VTL を書く代わりに AWS CDK や Direct Lambda Resolver を採用するといった方法はありますが、Costless チームではなるべく AppSync を使い倒す意図である程度 VTL と向き合って開発を進めてきました。これに関しては、定番の API Gateway + Lambda + DynamoDB 構成の REST にしていたら、きちんと仕様を詰めてさえいれば特に問題とならないでしょう。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eまとめ\u003C\u002Fh2\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E「Costless」のバックエンド開発に AppSync\u002FGraphQLを採用\u003C\u002Fli\u003E\u003Cli\u003EAppSync\u002FGraphQLを使うと、GraphQLのスキーマ定義によりAPI定義と入力チェックが一元管理でき、Subscriptionを使って通知機能を手軽に管理できるといったメリットがある\u003C\u002Fli\u003E\u003Cli\u003E一方、AppSync でリゾルバーを設定するにはVTLを書かなければならず、仕様が複雑になっていくに連れてペインポイントとなりやすい\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n","author":{"name":"Sonu Kim","description":"","avatars":{"avatar96":"https:\u002F\u002Fsecure.gravatar.com\u002Favatar\u002F5b527696e38c84c34048954d767b1537?s=96&d=mm&r=g"},"acf":{"userJpName":"金 仙優","userRole":"COO","facebook":"","twitter":"","github":""}},"date":"2021.01.12","path":"\u002Fblog\u002F324\u002F","featuredMedia":{"sourceUrl":"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2020\u002F05\u002Fso-release.png","altText":"so-release-image","mediaDetails":{"width":1200}},"categories":[{"id":"7","title":"Blog","path":"\u002Fcategory\u002Fblog\u002F"}],"tags":[{"id":"9","title":"API Gateway","path":"\u002Ftag\u002Fapi-gateway\u002F"},{"id":"19","title":"Appsync","path":"\u002Ftag\u002Fappsync\u002F"}]},"metadata":{"siteName":"Serverless Operations","siteDescription":"Serverless Operationsは、これまでグローバルの第一線で培ってきたクラウド技術（AWS − アマゾンウェブサービス）の豊富な実績と知見を活かし、お客さまのサーバーレスによる開発や運用の支援、コンサルティングまで一貫してサポート。サーバーレスに関するさまざまな課題を解決いたします。","siteUrl":"https:\u002F\u002Fserverless.co.jp","siteOgImage":"https:\u002F\u002Fserverless.co.jp\u002Fogp.png"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.f355efd1.js" defer></script><script src="/assets/js/page--src--templates--word-press-blog-vue.fdf3ed1a.js" defer></script><script data-vue-tag="ssr" src="https://webfont.fontplus.jp/accessor/script/fontplus.js?LuMx0zy9taw%3D&box=ME4Rs88c3-0%3D&aa=1&ab=2" data-body="true"></script>
  </body>
</html>
