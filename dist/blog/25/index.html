<!DOCTYPE html>
<html data-html-server-rendered="true" lang="ja" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22ja%22%7D%7D">
  <head>
    <title>Serverless Frameworkの使い方まとめ | Serverless Operations</title><meta name="gridsome:hash" content="e5bf1eed04e22915fe60df772657de15feda3786"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="og:locale" property="og:locale" content="ja_JP"><meta data-vue-tag="ssr" data-key="og:site_name" property="og:site_name" content="Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://serverless.co.jp/ogp.png"><meta data-vue-tag="ssr" data-key="og:type" property="og:type" content="article"><meta data-vue-tag="ssr" data-key="og:url" property="og:url" content="https://serverless.co.jp/blog/25/"><meta data-vue-tag="ssr" data-key="og:image" property="og:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2020/07/https___camo.githubusercontent.jpeg"><meta data-vue-tag="ssr" data-key="og:title" property="og:title" content="Serverless Frameworkの使い方まとめ | Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2020/07/https___camo.githubusercontent.jpeg"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css"><link data-vue-tag="ssr" data-key="canonical" rel="canonical" href="https://serverless.co.jp/blog/25/"><link rel="preload" href="/assets/css/0.styles.adfe40b8.css" as="style"><link rel="preload" href="/assets/js/app.7f894eb2.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--word-press-blog-vue.fdf3ed1a.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.84e8aa18.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.094252a3.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-archives-vue.771d12fd.js"><link rel="prefetch" href="/assets/js/page--src--pages--contact-vue.c49312ad.js"><link rel="prefetch" href="/assets/js/page--src--pages--download-vue.e2fb64ed.js"><link rel="prefetch" href="/assets/js/page--src--pages--event-archives-vue.dc6c64cc.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.ae1cb6c3.js"><link rel="prefetch" href="/assets/js/page--src--pages--news-archives-vue.2871bf8d.js"><link rel="prefetch" href="/assets/js/page--src--pages--our-products-vue.d569f152.js"><link rel="prefetch" href="/assets/js/page--src--pages--privacy-policy-vue.9015b9cf.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue.548b9c96.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue~page--src--pages--services--iot-serverless-vue.bada637e.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--index-vue.605da173.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--iot-serverless-vue.1324af58.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-consulting-vue.bf933f33.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-development-vue.d8c60529.js"><link rel="prefetch" href="/assets/js/page--src--pages--test-form-vue.37425afa.js"><link rel="prefetch" href="/assets/js/page--src--pages--works-archives-vue.b641ea0a.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-category-vue.7424850d.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-tag-vue.a058c92f.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-vue.8fb7ceee.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-works-vue.dc66c364.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--contact-vue~page--src--pages--download-vue.7a23cb3f.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--our-products-vue.8e9052c2.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-blog-vue.16b09ab1.js"><link rel="stylesheet" href="/assets/css/0.styles.adfe40b8.css"><script data-vue-tag="ssr">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MLP4448');</script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="v-application v-application--is-ltr theme--dark" data-v-7de3dd27><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MLP4448" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="v-application--wrap"><header class="header-nav" data-v-5f4f5539><div class="header-nav__logo-block" data-v-5f4f5539><a href="/" class="header-nav__logo-link active" data-v-5f4f5539><img src="/assets/img/header-logo.a93f880b.svg" alt="Severless Operations ロゴ" class="header-nav__logo" data-v-5f4f5539></a></div><nav data-v-5f4f5539><ul data-v-5f4f5539><li data-v-5f4f5539><a href="/about" data-v-5f4f5539>私たちについて</a></li><li data-v-5f4f5539><a href="/services" data-v-5f4f5539>サービス</a></li><li data-v-5f4f5539><a href="/works-archives" data-v-5f4f5539>実績紹介</a></li><li data-v-5f4f5539><a href="/blog-archives" data-v-5f4f5539>ブログ</a></li><li data-v-5f4f5539><a href="/news-archives" data-v-5f4f5539>お知らせ</a></li><li data-v-5f4f5539><a href="/download" data-v-5f4f5539>会社資料ダウンロード</a></li><li data-v-5f4f5539><a href="/contact" data-v-5f4f5539>お問い合わせ</a></li></ul></nav><div id="app" class="header-nav__toggler-block d-block d-md-none" data-v-5f4f5539><button id="btn" type="button" class="header-nav__toggler-button btn" data-v-5f4f5539><div tabindex="-1" class="btn__content" data-v-5f4f5539><span class="header-nav__toggler-top" data-v-5f4f5539></span><span class="header-nav__toggler-middle" data-v-5f4f5539></span><span class="header-nav__toggler-bottom" data-v-5f4f5539></span></div></button></div><!----></header><main class="v-content"><div class="v-content" data-v-7de3dd27><div class="v-content__wrap" data-v-7de3dd27><div class="container" data-v-7de3dd27><p class="category-title" data-v-7de3dd27>
          Blog
        </p></div><header class="post-header" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="col-md-10 col-11" data-v-7de3dd27><h1 class="post-title" data-v-7de3dd27>Serverless Frameworkの使い方まとめ</h1><div class="post-tag-container" data-v-7de3dd27><time datetime="2022.04.18" class="post-date" data-v-7de3dd27> 
                  2022.04.18
                  
                </time><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Serverless Framework</span></div></div></div></div></div></header><article class="post-container" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="post-article-container col-md-10 col-11" data-v-7de3dd27><div class="post-article" data-v-7de3dd27>
<h1 class="wp-block-heading">概要</h1>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="455" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/04/serverless_main-1024x455.gif" alt="" class="wp-image-463" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/04/serverless_main-1024x455.gif 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/04/serverless_main-300x133.gif 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/04/serverless_main-768x341.gif 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2022/04/serverless_main-1536x683.gif 1536w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p><a rel="noreferrer noopener" href="https://serverless.com/" target="_blank">Serverless Framework</a>&nbsp;はServerless Applicationを構成管理デプロイするためのツールです。この記事ではその使い方をまとめています。</p>



<p>※ 2022.4.17 &#8211; Serverless Framework v3 の変更内容を反映しました。</p>



<h1 class="wp-block-heading">インストール</h1>



<h2 class="wp-block-heading">Node.jsのインストール</h2>



<p>ServerlessはNode.jsで作られたCLIツールです。<br>なので、あなたのマシンにNode.jsをインストールする必要があります。<a rel="noreferrer noopener" href="https://nodejs.org/ja/" target="_blank">Node.jsの公式サイト</a>からあなたのPCにNode.jsをインストールしましょう。ServerlessはNode.jsのv12以上が必要となります。</p>



<h2 class="wp-block-heading">Serverlessのインストール</h2>



<p>Serverlessは<a href="https://www.npmjs.com/" rel="noreferrer noopener" target="_blank">npm</a>のパッケージとして公開されています。ターミナルを開いて、<code>npm install -g serverless</code>でインストールが完了します。</p>



<p>正しくインストールされているかは、<code>serverless --version</code>にて確認しましょう。以下のようにバージョンが表示されれば正しくインストールされています。</p>



<div class="wp-block-group is-layout-flow"><div class="wp-block-group__inner-container">
<div class="wp-block-group language-php is-layout-flow"><div class="wp-block-group__inner-container">
<div class="wp-block-group is-layout-flow"><div class="wp-block-group__inner-container">
<div class="wp-block-group is-layout-flow"><div class="wp-block-group__inner-container">
<pre class="wp-block-code language-ssh"><code>$ serverless --version
Framework Core: 3.14.0
Plugin: 6.2.1
SDK: 4.3.2</code></pre>
</div></div>
</div></div>
</div></div>
</div></div>



<h2 class="wp-block-heading">プロバイダーアカウントのセットアップ</h2>



<p>プロバイダーのアカウントをセットアップします。プロバイダーとは、要はどのクラウドサービスを使用してServerlessを動かすかということです。AWS, GCP, Azure, IBM Cloudなど様々なクラウドプロバイダーに対応しています。<br>ここではAWSにスポットを当てて解説します。</p>



<p><a href="https://serverless.com/framework/docs/providers/aws/setup/" rel="noreferrer noopener" target="_blank">AWS account Setup</a><br>ここにAWSアカウントのセットアップ方法が書いていますが、要は以下を実施すればOKです。</p>



<ul><li>Serverless用のIAMユーザを発行</li><li>IAMユーザに<code>AdministratorAccess</code>の管理ポリシーを与える</li></ul>



<p>基本的にはこのアカウントを使って、ServerlessのデプロイやLambdaファンクションのローカルからの実行を行います。<br>また、IAMロールを制限したい場合は、<a href="https://github.com/puresec/serverless-puresec-cli" rel="noreferrer noopener" target="_blank">serverless-puresec-cli</a>や<a href="https://github.com/serverless/serverless/issues/1439" rel="noreferrer noopener" target="_blank">Narrowing the Serverless IAM Deployment Policy</a>を参考に独自でセットアップしましょう。</p>



<h1 class="wp-block-heading">サービスの作成</h1>



<p>Serverlessは<code>サービス</code>という単位で実行環境を作っていきます。<br>まずはサービスを開設してみましょう。</p>



<p>AWSをプロバイダーとしてNode.jsでサービスを開設する場合は以下の手順になります。</p>



<pre class="wp-block-code language-shell"><code>$ serverless create --template aws-nodejs --name my-special-service --path my-special-service</code></pre>



<p>すると、my-special-serviceのディレクトリが作られ、その配下に以下のファイルが出来ているはずです。<br>これでサービスの作成は完了です。</p>



<ul><li>serverless.yml</li><li>handler.js</li></ul>



<p>また、サービス用のテンプレートですが、以下の言語用のテンプレートが用意されています。</p>



<ul><li>aws-nodejs</li><li>aws-nodejs-typescript</li><li>aws-nodejs-ecma-script</li><li>aws-python</li><li>aws-python3</li><li>aws-kotlin-jvm-maven</li><li>aws-kotlin-jvm-gradle</li><li>aws-kotlin-nodejs-gradle</li><li>aws-groovy-gradle</li><li>aws-java-maven</li><li>aws-java-gradle</li><li>aws-scala-sbt</li><li>aws-csharp</li><li>aws-fsharp</li></ul>



<p>どの言語でLambdaを動かしたいかによってテンプレートを変更してあげましょう</p>



<h2 class="wp-block-heading">serverless.yml</h2>



<p>serverless.ymlは各サービス全体の設定を行うためのファイルです。<br>AWSでは、以下のような設定が可能です。</p>



<ul><li>サービス内のLambdaファンクション群の設定</li><li>Lambdaに設定されるIAMロールの設定</li><li>デプロイ時にどのファイル/ディレクトリを含めるか/含めないかの設定</li><li>使用するプラグインの定義</li><li>Lambdaファンクションごとのトリガーとなるイベントの定義</li><li>Lambdaファンクションが他のAWSリソースを連携する場合は、そのIAMを含めた定義</li></ul>



<p>まずは、serverless.ymlの設定をしてあげましょう。もろもろサービスを実行するために必要な設定はすべてこのファイルで行います。</p>



<h2 class="wp-block-heading">handler.js</h2>



<p>これはファンクションを定義するためのスケルトンとして生成されるファイルです。これを参考に実際のファンクションのプログラムを作っていきます。</p>



<h2 class="wp-block-heading">event.json</h2>



<p>ServerlessのCLIでファンクションを実行する際に入力値となるデータを定義するファイルです。Lambdaファンクション内で<code>event</code>変数に展開されます。</p>



<p>※2022年4月時点ではテンプレートに event.json が含まれないので、後述しますがサンプルで event.json を利用する場合別途作成しておく必要があります。</p>



<h2 class="wp-block-heading">Githubに上がった既存のサービスをインポートする場合</h2>



<p>既にGithubに上がっている既存サービスの開発を行う場合は、そのままローカルにインポートしてServerlessをセットアップしたいと思います。その際は<code>serverless install -u [GITHUB URL OF SERVICE]</code>でインポート可能です。</p>



<h1 class="wp-block-heading">サービスのデプロイ</h1>



<p>次に作ったサービスをプロバイダー上へデプロイしましょう。</p>



<p><code>serverless deploy -v</code>でデプロイは開始されます。-vオプションを付けると<code>verbose</code>というモードでデプロイが実施され、途中経過がターミナル上で確認できます。</p>



<p>また、Serverlessのデプロイには<code>stage</code>という概念が導入されています。いわゆる本番環境とテスト環境といった環境をstageという単位で切り分けています。</p>



<p>Serverlessはデフォルトで、<code>dev</code>というステージかつ<code>us-east-1</code>リージョンにデプロイされるようになっています。<br>もしこれを変更したければ　<code>serverless.yml</code>に以下のように設定します。</p>



<pre class="wp-block-code language-shell"><code>serverless.yml 

service: service-name
provider:
  name: aws
  stage: beta
  region: us-west-2</code></pre>



<p>これで<code>beta</code>ステージの<code>us-west-2</code>リージョンにデプロイされるようになります。</p>



<h2 class="wp-block-heading">serverless.ymlで定義したものと異なるサービス及びリージョンへのデプロイ</h2>



<p>また、<code>deploy</code>コマンドはデプロイするstageやregionを引数で指定することも出来ます。</p>



<p><code>production</code>ステージの<code>ap-northeast-1</code>リージョンに上げたければ、<code>serverless deploy --stage production --region ap-northeast-1</code>とすれば、引数通りの指定でデプロイが実施されます。</p>



<h2 class="wp-block-heading">ファンクション単位のデプロイ</h2>



<p><code>serverless deploy -v</code>はサービス全体のデプロイを行います。ファンクションの一部を修正したなどのケースで、サービス全体がデプロイされるのは大変です。<br>Serverlessはファンクション単位でのデプロイも<code>serverless deploy function -f &lt;yourfunction&gt;</code>にて可能です。</p>



<h1 class="wp-block-heading">ファンクションの実行</h1>



<p>デプロイしたファンクションを実行してみましょう。</p>



<h2 class="wp-block-heading">event.json の作成</h2>



<p>ServerlessのCLIでファンクションを実行する際に入力値となるデータを定義したファイルを作成します。Lambdaファンクション内で<code>event</code>変数に展開されます。</p>



<pre class="wp-block-code language-json"><code>{
  "key1": "value1",
  "key2": "value2",
  "key3": "value3"
}</code></pre>



<h2 class="wp-block-heading">helloファンクションの実行</h2>



<p>サービス作成時にhandler.jsとして作成されるhelloファンクションを実行する場合を考えてみましょう。<code>serverless invoke --function hello -p event.json</code>で実行できます。</p>



<h2 class="wp-block-heading">実行時にログを表示させる</h2>



<p>ファンクションの実行時にログを見たいを思います。Lambdaの実行時にCloudwatchのログが同時に見れれば便利ですよね？ Serverlessはそれにも対応しています。<code>serverless invoke --function Yourfunction -p event.json --log</code>でlogオプションを付与するとこで以下の通りログが確認できます。</p>



<pre class="wp-block-code language-shell"><code>$ serverless invoke --function hello -p event.json --log
{
    "statusCode": 200,
    "body": "{\n  \"message\": \"Go Serverless v1.0! Your function executed successfully!\",\n  \"input\": {\n    \"key1\": \"value1\",\n    \"key2\": \"value2\",\n    \"key3\": \"value3\"\n  }\n}"
}
--------------------------------------------------------------------
START
END RequestId: 4767edc0-b1cc-4dcb-9128-2474967ec40a
END Duration: 2.09 ms Memory Used: 56 MB</code></pre>



<p class="language-javascript">body の中身をパースすると event.json の内容が含まれた以下のオブジェクトに展開されます。</p>



<pre class="wp-block-code"><code>{
  message: 'Go Serverless v1.0! Your function executed successfully!',
  input: {
    key1: 'value1',
    key2: 'value2',
    key3: 'value3'
  }
}</code></pre>



<h2 class="wp-block-heading">各ファンクションのログの履歴を確認する</h2>



<p>後からファンクション毎のログを確認する場合は<code>serverless logs --function Yourfunction</code>というコマンドを実行します。</p>



<p>すると以下の通りログがリストで表示されます。 </p>



<pre class="wp-block-code language-shell"><code>$ serverless logs --function hello
START
END Duration: 2.47 ms (init: 167.55 ms) Memory Used: 55 MB
START
2022-04-16 02:16:58.039	{ key1: 'value1', key2: 'value2', key3: 'value3' }
END Duration: 4.56 ms (init: 155.54 ms) Memory Used: 55 MB</code></pre>



<p>※確認のため handler.js 関数内で <code>console.log(event)</code> のようにログ出力を追加しています。</p>



<h2 class="wp-block-heading">他のAWSリソースにIAMでポリシーを設定する</h2>



<p>実行時に他のAWSリソースを参照する場合は、serverless.yml内の<code>provider.iam</code>を使用して必要なポリシーを設定します。</p>



<p>DynamoDBのexampleテーブルに対する全権限を付与する場合は以下のような設定をします。</p>



<pre class="wp-block-code language-yaml"><code># serverless.yml 
provider: 
  iam:
    role:
      statements:
        - Effect: "Allow"
          Action:
            - "dynamodb:*"
          Resource:
            - arn:aws:dynamodb:us-east-1:*:table/example</code></pre>



<h1 class="wp-block-heading">イベントトリガーの設定</h1>



<p>Serverless Frameworkはファンクションにイベントを設定することでイベント駆動のアーキテクチャを実現することをサポートしています。</p>



<p>イベントにはHTTPリクエスト(AWSではAPI Gateway)やS3 bucket、スケジュールイベントなど、設定を行うことが出来ます。</p>



<p>今回は、AWS Gatewayを使用したhttpイベントの設定を例にあげます。</p>



<h2 class="wp-block-heading">HTTP eventを追加する</h2>



<p><code>greet</code>というパスでhttpリクエストを受けた場合に<code>hello</code>ファンクションを実行させたい場合は以下のようにserverless.ymlを設定します。</p>



<pre class="wp-block-code language-shell"><code># serverless.yml
functions:
  hello:
    handler: handler.hello
    events:
      # HTTP API endpoint (API Gateway v2)
      - httpApi:
          path: /greet
          method: GET
      # REST API endpoint (API Gateway v1)
      - http:
          path: /greet
          method: GET</code></pre>



<p>この設定を行い、<code>serverless deploy</code>を実行してデプロイに成功すれば以下のようなEndpointがターミナル上に表示されるはずです。 上が REST API、下が HTTP API のエンドポイントです。</p>



<pre class="wp-block-code language-shell"><code>endpoints:
  GET - https://xxx.execute-api.us-east-1.amazonaws.com/dev/greet
  GET - https://yyy.execute-api.us-east-1.amazonaws.com/greet</code></pre>



<p>これに対して実際にリクエストを送ってみるとLambdaで定義した返り値が返ってくるはずです。 </p>



<pre class="wp-block-code language-shell"><code>$ curl https://xxx.execute-api.us-east-1.amazonaws.com/dev/greet
$ curl https://yyy.execute-api.us-east-1.amazonaws.com/greet</code></pre>



<p><a href="https://serverless.com/framework/docs/providers/aws/events/apigateway/" rel="noreferrer noopener" target="_blank">https://serverless.com/framework/docs/providers/aws/events/apigateway/</a><br>API Gatewayを使ったhttpイベントは様々なパラメータを設定することが可能です。詳しくは公式のドキュメントを確認してみてください。個人的にはlambda-proxyの機能が、手軽にLambdaからステータスコードの設定が出来て便利だと感じています。</p>



<p>また、現段階でAWSをプロバイダーとして以下のイベントが設定可能です。</p>



<ul><li>API Gatewayを使用したhttpイベント</li><li>S3の操作をトリガーとしたイベント</li><li>Lambdaのスケジュールイベント</li><li>SNSの通知をトリガーとしたイベント</li><li>DynamoDB / Kinesis Streamsイベント</li><li>Allexa Skill / Alexa Smart Homeイベント</li><li>AWS IoTイベント</li><li>CloudWatch　Event</li><li>CloudWatch　Log</li><li>Cognito User Poolのトリガーファンクション</li><li>SQS</li></ul>



<p><a href="https://serverless.com/framework/docs/providers/aws/events/">https://serverless.com/framework/docs/providers/aws/events/</a></p>



<h1 class="wp-block-heading">Serverlessで使用できる変数</h1>



<p>Serverless Frameworkは<code>serverless.yml</code>内で変数を定義することで柔軟なサービス設定が可能となっています。</p>



<h2 class="wp-block-heading">環境変数を参照する</h2>



<p>環境変数を参照する場合は<code>${env:SOME_VAR}</code>というシンタックスをserverless.ymlに記述します。以下がその例です。serverless.yml </p>



<pre class="wp-block-code language-shell"><code>service: new-service
provider: aws
functions:
  hello:
      name: ${env:FUNC_PREFIX}-hello
      handler: handler.hello
  world:
      name: ${env:FUNC_PREFIX}-world
      handler: handler.world</code></pre>



<p>この例ではあなたのPC内の<code>FUNC_PREFIX</code>という環境変数を参照するようになりました。</p>



<h2 class="wp-block-heading">CLIオプションを参照する</h2>



<p>serverlessコマンド実行時のオプションを参照させたい場合は<code>${opt:SOME_VAR}</code>というシンタックスをserverless.ymlに記述します。以下がその例です。</p>



<pre class="wp-block-code language-shell"><code>serverless.yml

service: new-service
provider: aws
functions:
  hello:
      name: ${opt:stage}-hello
      handler: handler.hello
  world:
      name: ${opt:stage}-world
      handler: handler.world</code></pre>



<p><code>serverless deploy --stage dev</code>とした場合は、<code>${opt:stage}</code>はdevが返ります。また、<code>serverless deploy --stage production</code>とした場合は、productionが返ります。</p>



<h2 class="wp-block-heading">自身で定義した変数を参照する</h2>



<p>serverless.yml内で自身で定義した変数を参照させることも出来ます。<code>${self:someProperty}</code>というシンタックスで定義可能です。以下がその例です。</p>



<pre class="wp-block-code language-shell"><code>serverless.yml 

service: new-service
provider: aws
custom:
  globalSchedule: rate(10 minutes)

functions:
  hello:
      handler: handler.hello
      events:
        - schedule: ${self:custom.globalSchedule}
  world:
      handler: handler.world
      events:
        - schedule: ${self:custom.globalSchedule}</code></pre>



<h2 class="wp-block-heading">他のファイルで定義した変数を参照する</h2>



<p>serverless.ymlとは別で定義したファイルを読み込んで、その変数を参照することも出来ます。<code>${file(../myFile.yml):someProperty}</code>というシンタックスでserverless.ymlに定義してください。以下がその例になります。</p>



<pre class="wp-block-code language-shell"><code>myCustomFile.yml 

globalSchedule: rate(10 minutes)</code></pre>



<pre class="wp-block-code language-shell"><code>serverless.yml 

service: new-service
provider: aws
custom: ${file(../myCustomFile.yml)} # You can reference the entire file
functions:
  hello:
      handler: handler.hello
      events:
        - schedule: ${file(../myCustomFile.yml):globalSchedule} # Or you can reference a specific property
  world:
      handler: handler.world
      events:
        - schedule: ${self:custom.globalSchedule} # This would also work in this case</code></pre>



<h2 class="wp-block-heading">変数のネスト</h2>



<p>以下のように変数をネストさせることも可能です。</p>



<pre class="wp-block-code language-shell"><code>serverless.yml 

service: new-service
provider: aws
custom:
  myFlexibleArn: ${env:${opt:stage}_arn}

functions:
  hello:
      handler: handler.hello</code></pre>



<h2 class="wp-block-heading">変数の上書き</h2>



<p>以下のような記述を例にあげます。</p>



<pre class="wp-block-code language-shell"><code>serverless.yml

service: new-service
provider:
  name: aws
  stage: dev
custom:
  myStage: ${opt:stage, self:provider.stage}

functions:
  hello:
      handler: handler.hello</code></pre>



<p>この場合に<code>serverless deploy</code>を発行したとします。この時、<code>opt:stage</code>は定義されていないため、<code>self:provider.stage</code>に定義されているdevが参照されます。</p>



<p><code>serverless deploy --stage production</code>が指定されている場合は、<code>opt:stage</code>が定義されているため<code>opt:stage</code>が優先して参照されます。</p>



<h2 class="wp-block-heading">サービスの削除</h2>



<p>あなたのつくったサービス内で、<code>serverless remove</code>を実行してください。これでサービスがプロバイダー上から削除されます。</p>



<h1 class="wp-block-heading">Tips</h1>



<h3 class="wp-block-heading">アクセスキーなど見せたくない情報をserverless.ymlで扱う</h3>



<p>SSM秘匿パラメータの機能を使いましょう<br><a rel="noreferrer noopener" href="https://serverless.com/framework/docs/providers/aws/guide/variables/#reference-variables-using-the-ssm-parameter-store" target="_blank">https://serverless.com/framework/docs/providers/aws/guide/variables/#reference-variables-using-the-ssm-parameter-store</a></p>
</div><section class="l-share-button" data-v-629ec8b5 data-v-7de3dd27><aside class="p-share-button" data-v-629ec8b5><div class="p-share-button__header" data-v-629ec8b5>SHARE</div><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fserverless.co.jp%2Fblog%2F25%2F" target="_blank" title="Facebookでシェア" class="p-share-button__link--facebook " data-v-629ec8b5><i class="mdi mdi-facebook" data-v-629ec8b5></i></a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fserverless.co.jp%2Fblog%2F25%2F&amp;text=Serverless%20Framework%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9%E3%81%BE%E3%81%A8%E3%82%81" target="_blank" title="Twitterでシェア" class="p-share-button__link--twitter" data-v-629ec8b5><i class="mdi mdi-twitter" data-v-629ec8b5></i></a></aside></section><div class="post-author-container" data-v-7de3dd27><h5 class="post-author-title" data-v-7de3dd27>Written by</h5><div class="post-author-text" data-v-7de3dd27><p data-v-7de3dd27><span class="role" data-v-7de3dd27>
                      CEO
                    </span><span class="name-jp" data-v-7de3dd27>
                      堀家 隆宏
                    </span><span class="name-en" data-v-7de3dd27>
                      Takahiro Horike
                    </span></p><p class="author-desc" data-v-7de3dd27>
                    Co-founder and CEO of Serverless Operations, Inc
                  </p><ul class="author-sns" data-v-7de3dd27><li data-v-7de3dd27><a href="https://github.com/horike37" target="_blank" class="github" data-v-7de3dd27><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" data-v-7de3dd27></i></a></li><li data-v-7de3dd27><a href="https://www.facebook.com/horike.takahiro" target="_blank" class="facebook" data-v-7de3dd27><i aria-hidden="true" class="v-icon notranslate mdi mdi-facebook theme--light" data-v-7de3dd27></i></a></li><li data-v-7de3dd27><a href="https://twitter.com/horike37" target="_blank" class="twitter" data-v-7de3dd27><i aria-hidden="true" class="v-icon notranslate mdi mdi-twitter theme--light" data-v-7de3dd27></i></a></li></ul></div></div></div></div></div><div class="p-news-bg" data-v-7de3dd27></div></article><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><a href="/blog-archives" class="post-archives-link" data-v-7de3dd27><span class="post-archives-link-text" data-v-7de3dd27>BACK TO LIST</span><span data-v-7de3dd27><img src="/assets/img/icon-back-to-list.3add3700.svg" alt="BACK TO LIST アイコン" data-v-7de3dd27></span></a></div></div></div></div></main><footer class="v-footer footer v-sheet v-sheet--tile theme--dark" data-v-a49f4c2c><div class="container" data-v-a49f4c2c data-v-a49f4c2c><div class="row" data-v-a49f4c2c data-v-a49f4c2c><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/works-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Works</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>実績紹介</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-b68eaa08 data-v-a49f4c2c><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/501/" class="c-footer-list__link" data-v-b68eaa08>
      戸田建設株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/396/" class="c-footer-list__link" data-v-b68eaa08>
      北海道テレビ放送株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/358/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社Geolonia
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/24/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社LIXIL
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/185/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社TOKION
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Services</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>サービス紹介</div></a></div><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスオペレーションズの<br data-v-a49f4c2c>サービスと強み</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/iot-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              IoT × サーバーレス / コンテナ開発<br data-v-a49f4c2c>導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/aws-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              AWSコアサーバーレスサービスの開発導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-consulting" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスコンサルティング</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-development" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスディべロプメント</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/our-products" class="c-footer-list__link" data-v-a49f4c2c>
              自社開発プロダクト
            </a></li></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/blog-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Blog</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>開発ブログ</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-39434060 data-v-a49f4c2c><li class="c-footer-list__item" data-v-39434060><a href="/blog/640/" class="c-footer-list__link" data-v-39434060>
      AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/532/" class="c-footer-list__link" data-v-39434060>
      AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/512/" class="c-footer-list__link" data-v-39434060>
      AWS Lambda + Nuxt3で実現する「サーバーレスなSSR」とその構成
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/25/" class="c-footer-list__link active--exact active" data-v-39434060>
      Serverless Frameworkの使い方まとめ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/450/" class="c-footer-list__link" data-v-39434060>
      軽量で簡単に使えるキャッシュSaaS、MomentoをAWS Lambdaから使ってみる
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/429/" class="c-footer-list__link" data-v-39434060>
      Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>About</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>会社案内</div></a><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c>
              会社案内
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/news-archives/" class="c-footer-list__link" data-v-a49f4c2c>
              おしらせ
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/privacy-policy/" class="c-footer-list__link" data-v-a49f4c2c>
              プライバシーポリシー
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/download" class="c-footer-list__link" data-v-a49f4c2c>
              会社資料ダウンロード
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/contact" class="c-footer-list__link" data-v-a49f4c2c>
              お問い合わせ
            </a></li></ul></div></div><div class="row mt-8 mt-md-12" data-v-a49f4c2c data-v-a49f4c2c><div class="col-md-2 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/" class="active" data-v-a49f4c2c><img src="/assets/img/footer-severless-operations-logo.e1e6687a.svg" alt="Severless Operations ロゴ" data-v-a49f4c2c></a></div></div><div class="col-md-10 col-12" data-v-a49f4c2c data-v-a49f4c2c><div class="sns-link text-md-right" data-v-a49f4c2c><a href="https://github.com/serverless-operations" target="_blank" class="sns-link__github" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" data-v-a49f4c2c></i></a><a href="https://twitter.com/slsopsinc" target="_blank" class="sns-link__twitter" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-twitter theme--light" data-v-a49f4c2c></i></a></div></div><div class="footer-copyright" data-v-a49f4c2c>
        © Serverless Operations, inc
      </div></div></div></footer></div></div>
    <script>window.__INITIAL_STATE__={"data":{"wordPressBlog":{"title":"Serverless Frameworkの使い方まとめ","content":"\n\u003Ch1 class=\"wp-block-heading\"\u003E概要\u003C\u002Fh1\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"455\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F04\u002Fserverless_main-1024x455.gif\" alt=\"\" class=\"wp-image-463\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F04\u002Fserverless_main-1024x455.gif 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F04\u002Fserverless_main-300x133.gif 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F04\u002Fserverless_main-768x341.gif 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2022\u002F04\u002Fserverless_main-1536x683.gif 1536w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003E\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fserverless.com\u002F\" target=\"_blank\"\u003EServerless Framework\u003C\u002Fa\u003E&nbsp;はServerless Applicationを構成管理デプロイするためのツールです。この記事ではその使い方をまとめています。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E※ 2022.4.17 &#8211; Serverless Framework v3 の変更内容を反映しました。\u003C\u002Fp\u003E\n\n\n\n\u003Ch1 class=\"wp-block-heading\"\u003Eインストール\u003C\u002Fh1\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003ENode.jsのインストール\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EServerlessはNode.jsで作られたCLIツールです。\u003Cbr\u003Eなので、あなたのマシンにNode.jsをインストールする必要があります。\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fnodejs.org\u002Fja\u002F\" target=\"_blank\"\u003ENode.jsの公式サイト\u003C\u002Fa\u003EからあなたのPCにNode.jsをインストールしましょう。ServerlessはNode.jsのv12以上が必要となります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003EServerlessのインストール\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EServerlessは\u003Ca href=\"https:\u002F\u002Fwww.npmjs.com\u002F\" rel=\"noreferrer noopener\" target=\"_blank\"\u003Enpm\u003C\u002Fa\u003Eのパッケージとして公開されています。ターミナルを開いて、\u003Ccode\u003Enpm install -g serverless\u003C\u002Fcode\u003Eでインストールが完了します。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E正しくインストールされているかは、\u003Ccode\u003Eserverless --version\u003C\u002Fcode\u003Eにて確認しましょう。以下のようにバージョンが表示されれば正しくインストールされています。\u003C\u002Fp\u003E\n\n\n\n\u003Cdiv class=\"wp-block-group is-layout-flow\"\u003E\u003Cdiv class=\"wp-block-group__inner-container\"\u003E\n\u003Cdiv class=\"wp-block-group language-php is-layout-flow\"\u003E\u003Cdiv class=\"wp-block-group__inner-container\"\u003E\n\u003Cdiv class=\"wp-block-group is-layout-flow\"\u003E\u003Cdiv class=\"wp-block-group__inner-container\"\u003E\n\u003Cdiv class=\"wp-block-group is-layout-flow\"\u003E\u003Cdiv class=\"wp-block-group__inner-container\"\u003E\n\u003Cpre class=\"wp-block-code language-ssh\"\u003E\u003Ccode\u003E$ serverless --version\nFramework Core: 3.14.0\nPlugin: 6.2.1\nSDK: 4.3.2\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eプロバイダーアカウントのセットアップ\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eプロバイダーのアカウントをセットアップします。プロバイダーとは、要はどのクラウドサービスを使用してServerlessを動かすかということです。AWS, GCP, Azure, IBM Cloudなど様々なクラウドプロバイダーに対応しています。\u003Cbr\u003EここではAWSにスポットを当てて解説します。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fserverless.com\u002Fframework\u002Fdocs\u002Fproviders\u002Faws\u002Fsetup\u002F\" rel=\"noreferrer noopener\" target=\"_blank\"\u003EAWS account Setup\u003C\u002Fa\u003E\u003Cbr\u003EここにAWSアカウントのセットアップ方法が書いていますが、要は以下を実施すればOKです。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003EServerless用のIAMユーザを発行\u003C\u002Fli\u003E\u003Cli\u003EIAMユーザに\u003Ccode\u003EAdministratorAccess\u003C\u002Fcode\u003Eの管理ポリシーを与える\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003E基本的にはこのアカウントを使って、ServerlessのデプロイやLambdaファンクションのローカルからの実行を行います。\u003Cbr\u003Eまた、IAMロールを制限したい場合は、\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fpuresec\u002Fserverless-puresec-cli\" rel=\"noreferrer noopener\" target=\"_blank\"\u003Eserverless-puresec-cli\u003C\u002Fa\u003Eや\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fserverless\u002Fserverless\u002Fissues\u002F1439\" rel=\"noreferrer noopener\" target=\"_blank\"\u003ENarrowing the Serverless IAM Deployment Policy\u003C\u002Fa\u003Eを参考に独自でセットアップしましょう。\u003C\u002Fp\u003E\n\n\n\n\u003Ch1 class=\"wp-block-heading\"\u003Eサービスの作成\u003C\u002Fh1\u003E\n\n\n\n\u003Cp\u003EServerlessは\u003Ccode\u003Eサービス\u003C\u002Fcode\u003Eという単位で実行環境を作っていきます。\u003Cbr\u003Eまずはサービスを開設してみましょう。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EAWSをプロバイダーとしてNode.jsでサービスを開設する場合は以下の手順になります。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003E$ serverless create --template aws-nodejs --name my-special-service --path my-special-service\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eすると、my-special-serviceのディレクトリが作られ、その配下に以下のファイルが出来ているはずです。\u003Cbr\u003Eこれでサービスの作成は完了です。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003Eserverless.yml\u003C\u002Fli\u003E\u003Cli\u003Ehandler.js\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003Eまた、サービス用のテンプレートですが、以下の言語用のテンプレートが用意されています。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003Eaws-nodejs\u003C\u002Fli\u003E\u003Cli\u003Eaws-nodejs-typescript\u003C\u002Fli\u003E\u003Cli\u003Eaws-nodejs-ecma-script\u003C\u002Fli\u003E\u003Cli\u003Eaws-python\u003C\u002Fli\u003E\u003Cli\u003Eaws-python3\u003C\u002Fli\u003E\u003Cli\u003Eaws-kotlin-jvm-maven\u003C\u002Fli\u003E\u003Cli\u003Eaws-kotlin-jvm-gradle\u003C\u002Fli\u003E\u003Cli\u003Eaws-kotlin-nodejs-gradle\u003C\u002Fli\u003E\u003Cli\u003Eaws-groovy-gradle\u003C\u002Fli\u003E\u003Cli\u003Eaws-java-maven\u003C\u002Fli\u003E\u003Cli\u003Eaws-java-gradle\u003C\u002Fli\u003E\u003Cli\u003Eaws-scala-sbt\u003C\u002Fli\u003E\u003Cli\u003Eaws-csharp\u003C\u002Fli\u003E\u003Cli\u003Eaws-fsharp\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003Eどの言語でLambdaを動かしたいかによってテンプレートを変更してあげましょう\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eserverless.yml\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eserverless.ymlは各サービス全体の設定を行うためのファイルです。\u003Cbr\u003EAWSでは、以下のような設定が可能です。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003Eサービス内のLambdaファンクション群の設定\u003C\u002Fli\u003E\u003Cli\u003ELambdaに設定されるIAMロールの設定\u003C\u002Fli\u003E\u003Cli\u003Eデプロイ時にどのファイル\u002Fディレクトリを含めるか\u002F含めないかの設定\u003C\u002Fli\u003E\u003Cli\u003E使用するプラグインの定義\u003C\u002Fli\u003E\u003Cli\u003ELambdaファンクションごとのトリガーとなるイベントの定義\u003C\u002Fli\u003E\u003Cli\u003ELambdaファンクションが他のAWSリソースを連携する場合は、そのIAMを含めた定義\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003Eまずは、serverless.ymlの設定をしてあげましょう。もろもろサービスを実行するために必要な設定はすべてこのファイルで行います。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Ehandler.js\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eこれはファンクションを定義するためのスケルトンとして生成されるファイルです。これを参考に実際のファンクションのプログラムを作っていきます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eevent.json\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EServerlessのCLIでファンクションを実行する際に入力値となるデータを定義するファイルです。Lambdaファンクション内で\u003Ccode\u003Eevent\u003C\u002Fcode\u003E変数に展開されます。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E※2022年4月時点ではテンプレートに event.json が含まれないので、後述しますがサンプルで event.json を利用する場合別途作成しておく必要があります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003EGithubに上がった既存のサービスをインポートする場合\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E既にGithubに上がっている既存サービスの開発を行う場合は、そのままローカルにインポートしてServerlessをセットアップしたいと思います。その際は\u003Ccode\u003Eserverless install -u [GITHUB URL OF SERVICE]\u003C\u002Fcode\u003Eでインポート可能です。\u003C\u002Fp\u003E\n\n\n\n\u003Ch1 class=\"wp-block-heading\"\u003Eサービスのデプロイ\u003C\u002Fh1\u003E\n\n\n\n\u003Cp\u003E次に作ったサービスをプロバイダー上へデプロイしましょう。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Eserverless deploy -v\u003C\u002Fcode\u003Eでデプロイは開始されます。-vオプションを付けると\u003Ccode\u003Everbose\u003C\u002Fcode\u003Eというモードでデプロイが実施され、途中経過がターミナル上で確認できます。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eまた、Serverlessのデプロイには\u003Ccode\u003Estage\u003C\u002Fcode\u003Eという概念が導入されています。いわゆる本番環境とテスト環境といった環境をstageという単位で切り分けています。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EServerlessはデフォルトで、\u003Ccode\u003Edev\u003C\u002Fcode\u003Eというステージかつ\u003Ccode\u003Eus-east-1\u003C\u002Fcode\u003Eリージョンにデプロイされるようになっています。\u003Cbr\u003Eもしこれを変更したければ　\u003Ccode\u003Eserverless.yml\u003C\u002Fcode\u003Eに以下のように設定します。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003Eserverless.yml \n\nservice: service-name\nprovider:\n  name: aws\n  stage: beta\n  region: us-west-2\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eこれで\u003Ccode\u003Ebeta\u003C\u002Fcode\u003Eステージの\u003Ccode\u003Eus-west-2\u003C\u002Fcode\u003Eリージョンにデプロイされるようになります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eserverless.ymlで定義したものと異なるサービス及びリージョンへのデプロイ\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eまた、\u003Ccode\u003Edeploy\u003C\u002Fcode\u003Eコマンドはデプロイするstageやregionを引数で指定することも出来ます。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Eproduction\u003C\u002Fcode\u003Eステージの\u003Ccode\u003Eap-northeast-1\u003C\u002Fcode\u003Eリージョンに上げたければ、\u003Ccode\u003Eserverless deploy --stage production --region ap-northeast-1\u003C\u002Fcode\u003Eとすれば、引数通りの指定でデプロイが実施されます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eファンクション単位のデプロイ\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Eserverless deploy -v\u003C\u002Fcode\u003Eはサービス全体のデプロイを行います。ファンクションの一部を修正したなどのケースで、サービス全体がデプロイされるのは大変です。\u003Cbr\u003EServerlessはファンクション単位でのデプロイも\u003Ccode\u003Eserverless deploy function -f &lt;yourfunction&gt;\u003C\u002Fcode\u003Eにて可能です。\u003C\u002Fp\u003E\n\n\n\n\u003Ch1 class=\"wp-block-heading\"\u003Eファンクションの実行\u003C\u002Fh1\u003E\n\n\n\n\u003Cp\u003Eデプロイしたファンクションを実行してみましょう。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eevent.json の作成\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EServerlessのCLIでファンクションを実行する際に入力値となるデータを定義したファイルを作成します。Lambdaファンクション内で\u003Ccode\u003Eevent\u003C\u002Fcode\u003E変数に展開されます。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-json\"\u003E\u003Ccode\u003E{\n  \"key1\": \"value1\",\n  \"key2\": \"value2\",\n  \"key3\": \"value3\"\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Ehelloファンクションの実行\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eサービス作成時にhandler.jsとして作成されるhelloファンクションを実行する場合を考えてみましょう。\u003Ccode\u003Eserverless invoke --function hello -p event.json\u003C\u002Fcode\u003Eで実行できます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E実行時にログを表示させる\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eファンクションの実行時にログを見たいを思います。Lambdaの実行時にCloudwatchのログが同時に見れれば便利ですよね？ Serverlessはそれにも対応しています。\u003Ccode\u003Eserverless invoke --function Yourfunction -p event.json --log\u003C\u002Fcode\u003Eでlogオプションを付与するとこで以下の通りログが確認できます。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003E$ serverless invoke --function hello -p event.json --log\n{\n    \"statusCode\": 200,\n    \"body\": \"{\\n  \\\"message\\\": \\\"Go Serverless v1.0! Your function executed successfully!\\\",\\n  \\\"input\\\": {\\n    \\\"key1\\\": \\\"value1\\\",\\n    \\\"key2\\\": \\\"value2\\\",\\n    \\\"key3\\\": \\\"value3\\\"\\n  }\\n}\"\n}\n--------------------------------------------------------------------\nSTART\nEND RequestId: 4767edc0-b1cc-4dcb-9128-2474967ec40a\nEND Duration: 2.09 ms Memory Used: 56 MB\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp class=\"language-javascript\"\u003Ebody の中身をパースすると event.json の内容が含まれた以下のオブジェクトに展開されます。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code\"\u003E\u003Ccode\u003E{\n  message: 'Go Serverless v1.0! Your function executed successfully!',\n  input: {\n    key1: 'value1',\n    key2: 'value2',\n    key3: 'value3'\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E各ファンクションのログの履歴を確認する\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E後からファンクション毎のログを確認する場合は\u003Ccode\u003Eserverless logs --function Yourfunction\u003C\u002Fcode\u003Eというコマンドを実行します。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eすると以下の通りログがリストで表示されます。 \u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003E$ serverless logs --function hello\nSTART\nEND Duration: 2.47 ms (init: 167.55 ms) Memory Used: 55 MB\nSTART\n2022-04-16 02:16:58.039\t{ key1: 'value1', key2: 'value2', key3: 'value3' }\nEND Duration: 4.56 ms (init: 155.54 ms) Memory Used: 55 MB\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E※確認のため handler.js 関数内で \u003Ccode\u003Econsole.log(event)\u003C\u002Fcode\u003E のようにログ出力を追加しています。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E他のAWSリソースにIAMでポリシーを設定する\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E実行時に他のAWSリソースを参照する場合は、serverless.yml内の\u003Ccode\u003Eprovider.iam\u003C\u002Fcode\u003Eを使用して必要なポリシーを設定します。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EDynamoDBのexampleテーブルに対する全権限を付与する場合は以下のような設定をします。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-yaml\"\u003E\u003Ccode\u003E# serverless.yml \nprovider: \n  iam:\n    role:\n      statements:\n        - Effect: \"Allow\"\n          Action:\n            - \"dynamodb:*\"\n          Resource:\n            - arn:aws:dynamodb:us-east-1:*:table\u002Fexample\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch1 class=\"wp-block-heading\"\u003Eイベントトリガーの設定\u003C\u002Fh1\u003E\n\n\n\n\u003Cp\u003EServerless Frameworkはファンクションにイベントを設定することでイベント駆動のアーキテクチャを実現することをサポートしています。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EイベントにはHTTPリクエスト(AWSではAPI Gateway)やS3 bucket、スケジュールイベントなど、設定を行うことが出来ます。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E今回は、AWS Gatewayを使用したhttpイベントの設定を例にあげます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003EHTTP eventを追加する\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Egreet\u003C\u002Fcode\u003Eというパスでhttpリクエストを受けた場合に\u003Ccode\u003Ehello\u003C\u002Fcode\u003Eファンクションを実行させたい場合は以下のようにserverless.ymlを設定します。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003E# serverless.yml\nfunctions:\n  hello:\n    handler: handler.hello\n    events:\n      # HTTP API endpoint (API Gateway v2)\n      - httpApi:\n          path: \u002Fgreet\n          method: GET\n      # REST API endpoint (API Gateway v1)\n      - http:\n          path: \u002Fgreet\n          method: GET\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eこの設定を行い、\u003Ccode\u003Eserverless deploy\u003C\u002Fcode\u003Eを実行してデプロイに成功すれば以下のようなEndpointがターミナル上に表示されるはずです。 上が REST API、下が HTTP API のエンドポイントです。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003Eendpoints:\n  GET - https:\u002F\u002Fxxx.execute-api.us-east-1.amazonaws.com\u002Fdev\u002Fgreet\n  GET - https:\u002F\u002Fyyy.execute-api.us-east-1.amazonaws.com\u002Fgreet\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eこれに対して実際にリクエストを送ってみるとLambdaで定義した返り値が返ってくるはずです。 \u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003E$ curl https:\u002F\u002Fxxx.execute-api.us-east-1.amazonaws.com\u002Fdev\u002Fgreet\n$ curl https:\u002F\u002Fyyy.execute-api.us-east-1.amazonaws.com\u002Fgreet\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fserverless.com\u002Fframework\u002Fdocs\u002Fproviders\u002Faws\u002Fevents\u002Fapigateway\u002F\" rel=\"noreferrer noopener\" target=\"_blank\"\u003Ehttps:\u002F\u002Fserverless.com\u002Fframework\u002Fdocs\u002Fproviders\u002Faws\u002Fevents\u002Fapigateway\u002F\u003C\u002Fa\u003E\u003Cbr\u003EAPI Gatewayを使ったhttpイベントは様々なパラメータを設定することが可能です。詳しくは公式のドキュメントを確認してみてください。個人的にはlambda-proxyの機能が、手軽にLambdaからステータスコードの設定が出来て便利だと感じています。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eまた、現段階でAWSをプロバイダーとして以下のイベントが設定可能です。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003EAPI Gatewayを使用したhttpイベント\u003C\u002Fli\u003E\u003Cli\u003ES3の操作をトリガーとしたイベント\u003C\u002Fli\u003E\u003Cli\u003ELambdaのスケジュールイベント\u003C\u002Fli\u003E\u003Cli\u003ESNSの通知をトリガーとしたイベント\u003C\u002Fli\u003E\u003Cli\u003EDynamoDB \u002F Kinesis Streamsイベント\u003C\u002Fli\u003E\u003Cli\u003EAllexa Skill \u002F Alexa Smart Homeイベント\u003C\u002Fli\u003E\u003Cli\u003EAWS IoTイベント\u003C\u002Fli\u003E\u003Cli\u003ECloudWatch　Event\u003C\u002Fli\u003E\u003Cli\u003ECloudWatch　Log\u003C\u002Fli\u003E\u003Cli\u003ECognito User Poolのトリガーファンクション\u003C\u002Fli\u003E\u003Cli\u003ESQS\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fserverless.com\u002Fframework\u002Fdocs\u002Fproviders\u002Faws\u002Fevents\u002F\"\u003Ehttps:\u002F\u002Fserverless.com\u002Fframework\u002Fdocs\u002Fproviders\u002Faws\u002Fevents\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Ch1 class=\"wp-block-heading\"\u003EServerlessで使用できる変数\u003C\u002Fh1\u003E\n\n\n\n\u003Cp\u003EServerless Frameworkは\u003Ccode\u003Eserverless.yml\u003C\u002Fcode\u003E内で変数を定義することで柔軟なサービス設定が可能となっています。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E環境変数を参照する\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E環境変数を参照する場合は\u003Ccode\u003E${env:SOME_VAR}\u003C\u002Fcode\u003Eというシンタックスをserverless.ymlに記述します。以下がその例です。serverless.yml \u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003Eservice: new-service\nprovider: aws\nfunctions:\n  hello:\n      name: ${env:FUNC_PREFIX}-hello\n      handler: handler.hello\n  world:\n      name: ${env:FUNC_PREFIX}-world\n      handler: handler.world\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eこの例ではあなたのPC内の\u003Ccode\u003EFUNC_PREFIX\u003C\u002Fcode\u003Eという環境変数を参照するようになりました。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003ECLIオプションを参照する\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eserverlessコマンド実行時のオプションを参照させたい場合は\u003Ccode\u003E${opt:SOME_VAR}\u003C\u002Fcode\u003Eというシンタックスをserverless.ymlに記述します。以下がその例です。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003Eserverless.yml\n\nservice: new-service\nprovider: aws\nfunctions:\n  hello:\n      name: ${opt:stage}-hello\n      handler: handler.hello\n  world:\n      name: ${opt:stage}-world\n      handler: handler.world\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Eserverless deploy --stage dev\u003C\u002Fcode\u003Eとした場合は、\u003Ccode\u003E${opt:stage}\u003C\u002Fcode\u003Eはdevが返ります。また、\u003Ccode\u003Eserverless deploy --stage production\u003C\u002Fcode\u003Eとした場合は、productionが返ります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E自身で定義した変数を参照する\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eserverless.yml内で自身で定義した変数を参照させることも出来ます。\u003Ccode\u003E${self:someProperty}\u003C\u002Fcode\u003Eというシンタックスで定義可能です。以下がその例です。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003Eserverless.yml \n\nservice: new-service\nprovider: aws\ncustom:\n  globalSchedule: rate(10 minutes)\n\nfunctions:\n  hello:\n      handler: handler.hello\n      events:\n        - schedule: ${self:custom.globalSchedule}\n  world:\n      handler: handler.world\n      events:\n        - schedule: ${self:custom.globalSchedule}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E他のファイルで定義した変数を参照する\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eserverless.ymlとは別で定義したファイルを読み込んで、その変数を参照することも出来ます。\u003Ccode\u003E${file(..\u002FmyFile.yml):someProperty}\u003C\u002Fcode\u003Eというシンタックスでserverless.ymlに定義してください。以下がその例になります。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003EmyCustomFile.yml \n\nglobalSchedule: rate(10 minutes)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003Eserverless.yml \n\nservice: new-service\nprovider: aws\ncustom: ${file(..\u002FmyCustomFile.yml)} # You can reference the entire file\nfunctions:\n  hello:\n      handler: handler.hello\n      events:\n        - schedule: ${file(..\u002FmyCustomFile.yml):globalSchedule} # Or you can reference a specific property\n  world:\n      handler: handler.world\n      events:\n        - schedule: ${self:custom.globalSchedule} # This would also work in this case\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E変数のネスト\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E以下のように変数をネストさせることも可能です。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003Eserverless.yml \n\nservice: new-service\nprovider: aws\ncustom:\n  myFlexibleArn: ${env:${opt:stage}_arn}\n\nfunctions:\n  hello:\n      handler: handler.hello\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003E変数の上書き\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E以下のような記述を例にあげます。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-shell\"\u003E\u003Ccode\u003Eserverless.yml\n\nservice: new-service\nprovider:\n  name: aws\n  stage: dev\ncustom:\n  myStage: ${opt:stage, self:provider.stage}\n\nfunctions:\n  hello:\n      handler: handler.hello\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eこの場合に\u003Ccode\u003Eserverless deploy\u003C\u002Fcode\u003Eを発行したとします。この時、\u003Ccode\u003Eopt:stage\u003C\u002Fcode\u003Eは定義されていないため、\u003Ccode\u003Eself:provider.stage\u003C\u002Fcode\u003Eに定義されているdevが参照されます。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Eserverless deploy --stage production\u003C\u002Fcode\u003Eが指定されている場合は、\u003Ccode\u003Eopt:stage\u003C\u002Fcode\u003Eが定義されているため\u003Ccode\u003Eopt:stage\u003C\u002Fcode\u003Eが優先して参照されます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eサービスの削除\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eあなたのつくったサービス内で、\u003Ccode\u003Eserverless remove\u003C\u002Fcode\u003Eを実行してください。これでサービスがプロバイダー上から削除されます。\u003C\u002Fp\u003E\n\n\n\n\u003Ch1 class=\"wp-block-heading\"\u003ETips\u003C\u002Fh1\u003E\n\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003Eアクセスキーなど見せたくない情報をserverless.ymlで扱う\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003ESSM秘匿パラメータの機能を使いましょう\u003Cbr\u003E\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fserverless.com\u002Fframework\u002Fdocs\u002Fproviders\u002Faws\u002Fguide\u002Fvariables\u002F#reference-variables-using-the-ssm-parameter-store\" target=\"_blank\"\u003Ehttps:\u002F\u002Fserverless.com\u002Fframework\u002Fdocs\u002Fproviders\u002Faws\u002Fguide\u002Fvariables\u002F#reference-variables-using-the-ssm-parameter-store\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n","author":{"name":"Takahiro Horike","description":"Co-founder and CEO of Serverless Operations, Inc","avatars":{"avatar96":"https:\u002F\u002Fsecure.gravatar.com\u002Favatar\u002F2ee9db3a5b6c492acf66ec14c8a5d8dc?s=96&d=mm&r=g"},"acf":{"userJpName":"堀家 隆宏","userRole":"CEO","facebook":"https:\u002F\u002Fwww.facebook.com\u002Fhorike.takahiro","twitter":"https:\u002F\u002Ftwitter.com\u002Fhorike37","github":"https:\u002F\u002Fgithub.com\u002Fhorike37"}},"date":"2022.04.18","path":"\u002Fblog\u002F25\u002F","featuredMedia":{"sourceUrl":"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2020\u002F07\u002Fhttps___camo.githubusercontent.jpeg","altText":"","mediaDetails":{"width":1950}},"categories":[{"id":"7","title":"Blog","path":"\u002Fcategory\u002Fblog\u002F"}],"tags":[{"id":"11","title":"Serverless Framework","path":"\u002Ftag\u002Fserverless-framework\u002F"}]},"metadata":{"siteName":"Serverless Operations","siteDescription":"Serverless Operationsは、これまでグローバルの第一線で培ってきたクラウド技術（AWS − アマゾンウェブサービス）の豊富な実績と知見を活かし、お客さまのサーバーレスによる開発や運用の支援、コンサルティングまで一貫してサポート。サーバーレスに関するさまざまな課題を解決いたします。","siteUrl":"https:\u002F\u002Fserverless.co.jp","siteOgImage":"https:\u002F\u002Fserverless.co.jp\u002Fogp.png"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.7f894eb2.js" defer></script><script src="/assets/js/page--src--templates--word-press-blog-vue.fdf3ed1a.js" defer></script><script data-vue-tag="ssr" src="https://webfont.fontplus.jp/accessor/script/fontplus.js?LuMx0zy9taw%3D&box=ME4Rs88c3-0%3D&aa=1&ab=2" data-body="true"></script>
  </body>
</html>
