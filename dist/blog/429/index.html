<!DOCTYPE html>
<html data-html-server-rendered="true" lang="ja" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22ja%22%7D%7D">
  <head>
    <title>Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS | Serverless Operations</title><meta name="gridsome:hash" content="899a7dadc9c3ff481284dbd8cf731b9f93beffd5"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="og:locale" property="og:locale" content="ja_JP"><meta data-vue-tag="ssr" data-key="og:site_name" property="og:site_name" content="Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://serverless.co.jp/ogp.png"><meta data-vue-tag="ssr" data-key="og:type" property="og:type" content="article"><meta data-vue-tag="ssr" data-key="og:url" property="og:url" content="https://serverless.co.jp/blog/429/"><meta data-vue-tag="ssr" data-key="og:image" property="og:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2020/05/so-release.png"><meta data-vue-tag="ssr" data-key="og:title" property="og:title" content="Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS | Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2020/05/so-release.png"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css"><link data-vue-tag="ssr" data-key="canonical" rel="canonical" href="https://serverless.co.jp/blog/429/"><link rel="preload" href="/assets/css/0.styles.adfe40b8.css" as="style"><link rel="preload" href="/assets/js/app.f355efd1.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--word-press-blog-vue.fdf3ed1a.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.84e8aa18.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.094252a3.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-archives-vue.771d12fd.js"><link rel="prefetch" href="/assets/js/page--src--pages--contact-vue.c49312ad.js"><link rel="prefetch" href="/assets/js/page--src--pages--download-vue.e2fb64ed.js"><link rel="prefetch" href="/assets/js/page--src--pages--event-archives-vue.dc6c64cc.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.8d1729b1.js"><link rel="prefetch" href="/assets/js/page--src--pages--news-archives-vue.2871bf8d.js"><link rel="prefetch" href="/assets/js/page--src--pages--our-products-vue.d569f152.js"><link rel="prefetch" href="/assets/js/page--src--pages--privacy-policy-vue.9015b9cf.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue.548b9c96.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue~page--src--pages--services--iot-serverless-vue.bada637e.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--index-vue.605da173.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--iot-serverless-vue.1324af58.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-consulting-vue.bf933f33.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-development-vue.d8c60529.js"><link rel="prefetch" href="/assets/js/page--src--pages--test-form-vue.37425afa.js"><link rel="prefetch" href="/assets/js/page--src--pages--works-archives-vue.b641ea0a.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-category-vue.7424850d.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-tag-vue.a058c92f.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-vue.8fb7ceee.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-works-vue.dc66c364.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--contact-vue~page--src--pages--download-vue.7a23cb3f.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--our-products-vue.8e9052c2.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-blog-vue.16b09ab1.js"><link rel="stylesheet" href="/assets/css/0.styles.adfe40b8.css"><script data-vue-tag="ssr">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MLP4448');</script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="v-application v-application--is-ltr theme--dark" data-v-7de3dd27><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MLP4448" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="v-application--wrap"><header class="header-nav" data-v-5f4f5539><div class="header-nav__logo-block" data-v-5f4f5539><a href="/" class="header-nav__logo-link active" data-v-5f4f5539><img src="/assets/img/header-logo.a93f880b.svg" alt="Severless Operations ロゴ" class="header-nav__logo" data-v-5f4f5539></a></div><nav data-v-5f4f5539><ul data-v-5f4f5539><li data-v-5f4f5539><a href="/about" data-v-5f4f5539>私たちについて</a></li><li data-v-5f4f5539><a href="/services" data-v-5f4f5539>サービス</a></li><li data-v-5f4f5539><a href="/works-archives" data-v-5f4f5539>実績紹介</a></li><li data-v-5f4f5539><a href="/blog-archives" data-v-5f4f5539>ブログ</a></li><li data-v-5f4f5539><a href="/news-archives" data-v-5f4f5539>お知らせ</a></li><li data-v-5f4f5539><a href="/download" data-v-5f4f5539>会社資料ダウンロード</a></li><li data-v-5f4f5539><a href="/contact" data-v-5f4f5539>お問い合わせ</a></li></ul></nav><div id="app" class="header-nav__toggler-block d-block d-md-none" data-v-5f4f5539><button id="btn" type="button" class="header-nav__toggler-button btn" data-v-5f4f5539><div tabindex="-1" class="btn__content" data-v-5f4f5539><span class="header-nav__toggler-top" data-v-5f4f5539></span><span class="header-nav__toggler-middle" data-v-5f4f5539></span><span class="header-nav__toggler-bottom" data-v-5f4f5539></span></div></button></div><!----></header><main class="v-content"><div class="v-content" data-v-7de3dd27><div class="v-content__wrap" data-v-7de3dd27><div class="container" data-v-7de3dd27><p class="category-title" data-v-7de3dd27>
          Blog
        </p></div><header class="post-header" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="col-md-10 col-11" data-v-7de3dd27><h1 class="post-title" data-v-7de3dd27>Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS</h1><div class="post-tag-container" data-v-7de3dd27><time datetime="2021.11.30" class="post-date" data-v-7de3dd27> 
                  2021.11.30
                  
                </time><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Amplify</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Next.js</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>React</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Server-side rendering</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Serverless</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>SSR</span></div></div></div></div></div></header><article class="post-container" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="post-article-container col-md-10 col-11" data-v-7de3dd27><div class="post-article" data-v-7de3dd27>
<p>※ 2021 re:Invent のアップデート次第でタイムリーに内容が更新されることがあります。</p>



<p>2021年5月、Next.js のホスティング先として <a rel="noreferrer noopener" href="https://aws.amazon.com/jp/about-aws/whats-new/2021/05/aws-amplify-hosting-announces-server-side-rendering-support-for-next-js-web-apps/" data-type="URL" data-id="https://aws.amazon.com/jp/about-aws/whats-new/2021/05/aws-amplify-hosting-announces-server-side-rendering-support-for-next-js-web-apps/" target="_blank">AWS Amplify Console が対応可能になったお知らせ</a>により、SSR（Server-side rendering）においても Vercel や自前のホスティング環境を構築する以外のもう一つの選択肢として Amplify Console が利用できるようになりました。以前より <a rel="noreferrer noopener" href="https://www.serverless.com/blog/serverless-nextjs" data-type="URL" data-id="https://www.serverless.com/blog/serverless-nextjs" target="_blank">Serverless Nextjs Component</a> を使うという方法もありましたが、Amplify Console を使うとフロントエンドのインフラ構築がほぼコードレスに対応できる点でオススメする方法となります。</p>



<p>この記事では、Amplify Console を使った基本的な Next.js のホスティング設定方法を紹介しつつ、いくつか TIPS を紹介します。</p>



<h2 class="wp-block-heading">Amplify Console を利用したホスティング方法</h2>



<p>まず、デプロイする Next.js アプリのテンプレートを作成します。<a href="https://nextjs.org/docs/api-reference/create-next-app" data-type="URL" data-id="https://nextjs.org/docs/api-reference/create-next-app">create-next-app</a> を利用して新規プロジェクトとソースコードのテンプレートを展開します。</p>



<pre class="wp-block-code language-bash"><code>npx create-next-app@latest --ts
# or
yarn create next-app --typescript</code></pre>



<p>プロジェクト名を入力すると、コマンドを実行したところに指定した名前で新しくディレクトリが作成されます。そのままビルドして実行（ <code>yarn build &amp;&amp; yarn start</code> ）すると、以下のようなサンプル画面が表示されます。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="561" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-13.56.38-1024x561.jpg" alt="" class="wp-image-431" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-13.56.38-1024x561.jpg 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-13.56.38-300x164.jpg 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-13.56.38-768x421.jpg 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-13.56.38-1536x842.jpg 1536w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-13.56.38.jpg 2000w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>これをデプロイしてホスティングしてみます。Amplify Console では、GitHub/GitLab/BitBucket 等のリポジトリからソースコードを連携し、AWS 環境内でCI/CDの仕組みを自動構築することができます。まずはサンプルとして GitHub リポジトリを作成し、テンプレートのソースコードをコミットしておきます。</p>



<pre class="wp-block-code language-bash"><code>git remote add origin https://github.com/&lt;GITHUB_USERNAME&gt;/amplify-hosting-next-app.git
git branch -M main
git push -u origin main</code></pre>



<p>AWS コンソールを開き、AWS Amplify &gt; Host your web app を選択します。</p>



<div class="wp-block-image"><figure class="aligncenter size-full is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-20.52.06.png" alt="" class="wp-image-432" width="352" height="301" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-20.52.06.png 502w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-20.52.06-300x257.png 300w" sizes="(max-width: 352px) 100vw, 352px" /></figure></div>



<p>続いて From your existing code &gt; GitHub &gt; Continue を選択、GitHubでの認可の手続きを経て、先程作成したリポジトリとブランチを選択します。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="546" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-20.59.20-1024x546.png" alt="" class="wp-image-433" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-20.59.20-1024x546.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-20.59.20-300x160.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-20.59.20-768x410.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-20.59.20.png 1115w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>特に問題なければ Next を押して進みます。Next.js テンプレートであれば、基本的に自動で Server-side rendering deployment と検知してくれます。もし npm scripts 内で <code>next export</code> を使ってビルドする場合、SSR ではなく SSG（通常の静的アセット配信）として認識してくれるので、別途設定を行う必要がなく便利です。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="617" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.03.52-1024x617.png" alt="" class="wp-image-434" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.03.52-1024x617.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.03.52-300x181.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.03.52-768x462.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.03.52.png 1121w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>SSGの場合 artifacts.baseDirectory が out になります</figcaption></figure>



<p>Advanced settings ではビルドで利用する Docker イメージや環境変数の指定ができます。後から変更することもできますので、開発が進むにつれて適宜変更していく想定で問題ないです。最初の時点では特に触れる必要がないため、引き続き Next を押して進めます。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="278" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.16.40-1024x278.png" alt="" class="wp-image-435" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.16.40-1024x278.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.16.40-300x81.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.16.40-768x209.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.16.40.png 1108w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>SSG の場合 Framework: Next.js &#8211; SSG と表示されます</figcaption></figure>



<p>それでは、Save and deploy を押してデプロイしてみましょう。</p>



<p>（※初回ビルドに失敗する場合はこの記事の次のセクションをご参照ください）</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="282" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.56.08-1024x282.png" alt="" class="wp-image-438" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.56.08-1024x282.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.56.08-300x83.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.56.08-768x211.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.56.08.png 1162w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>以降、指定したブランチへの push イベントを受けて自動デプロイされるようになります（※設定で無効化可能）。ビルドに成功すると発行されたURLを開いて画面を確認し、最初にローカルで実行したのと同じ画面が表示されていれば、ホスティング完了です。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="643" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-22.02.39-1024x643.jpg" alt="" class="wp-image-439" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-22.02.39-1024x643.jpg 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-22.02.39-300x188.jpg 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-22.02.39-768x482.jpg 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-22.02.39.jpg 1307w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<h2 class="wp-block-heading">デフォルトのビルド環境で Node.js バージョンを指定する方法</h2>



<p>デフォルトのビルドで利用するイメージの Node.js バージョンが v12 とやや古いため、現時点では初回のビルド実行で以下のエラーメッセージと共に失敗するようになります。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="335" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.33.54-1024x335.jpg" alt="" class="wp-image-436" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.33.54-1024x335.jpg 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.33.54-300x98.jpg 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.33.54-768x251.jpg 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.33.54.jpg 1259w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>これを解決するためには、ビルドを実行する環境の Node.js バージョンを上げておく必要があります。幸い <code>nvm</code> が利用できるので、preBuild の時点で必要な Node.js バージョンをインストール、<code>nvm use</code> を使って指定しておくことで解決できます。</p>



<pre class="wp-block-code"><code>version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 16.13.0
        - nvm use 16.13.0
        - node -v
        - yarn install</code></pre>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="641" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.36.58-1024x641.jpg" alt="" class="wp-image-437" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.36.58-1024x641.jpg 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.36.58-300x188.jpg 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.36.58-768x481.jpg 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-21.36.58.jpg 1139w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<h2 class="wp-block-heading">SSR → SSG, SSG → SSR への変換はできない</h2>



<div class="wp-block-columns is-layout-flex wp-container-7">
<div class="wp-block-column is-layout-flow">
<div class="wp-block-image"><figure class="aligncenter size-full"><img decoding="async" loading="lazy" width="123" height="68" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-22.20.33-1.png" alt="" class="wp-image-444"/></figure></div>
</div>



<div class="wp-block-column is-layout-flow">
<div class="wp-block-image"><figure class="aligncenter size-full"><img decoding="async" loading="lazy" width="113" height="64" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2021/11/Screen-Shot-2021-11-30-at-22.20.22-2.png" alt="" class="wp-image-443"/></figure></div>
</div>
</div>



<p>App Settings &gt; General にて、上記のように SSR / SSG のどちらで動作するかについて確認できるようになっています。ただし一度 SSR か SSG に指定されると、後から変更することは現状できないので注意が必要です。もし途中から変更したい場合、別途新しい App を追加・連携してホスティングする必要があります。</p>



<h2 class="wp-block-heading">その他、ウェブアプリに必要な基本的な設定</h2>



<p>Amplify Console はホスティングに関連する様々な機能が提供されています。SSL証明書発行を含むドメイン設定、ベーシック認証によるアクセスコントロール、リダイレクト設定など、従来の静的ファイル配信の定番構成 S3 + CloudFront を構築した経験があれば簡単にイメージできる機能が揃っています。</p>



<p>ベーシック認証によるアクセスコントロールについては、当初 SSR では非対応でしたが、現時点では対応されているので利用可能になっています。</p>



<p>これらの機能についてはコンソール左側のメニュー <code>App settings</code> から適宜選択して設定を行うことができます。ただし、自前でホスティングする場合や CloudFront ディストリビューションを直接操作する場合に比べればできることが限られてくるので、Amplify Console を利用する場合は可能な限りフロントエンドのインフラ環境が複雑な構成にならないようにすることを念頭に置きつつ、アプリケーションの開発に集中することがポイントになります。</p>
</div><section class="l-share-button" data-v-629ec8b5 data-v-7de3dd27><aside class="p-share-button" data-v-629ec8b5><div class="p-share-button__header" data-v-629ec8b5>SHARE</div><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fserverless.co.jp%2Fblog%2F429%2F" target="_blank" title="Facebookでシェア" class="p-share-button__link--facebook " data-v-629ec8b5><i class="mdi mdi-facebook" data-v-629ec8b5></i></a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fserverless.co.jp%2Fblog%2F429%2F&amp;text=Next.js%20%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%20AWS%20Amplify%20%E3%81%A7%E3%83%9B%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B%E4%B8%8A%E3%81%A7%E3%81%AETIPS" target="_blank" title="Twitterでシェア" class="p-share-button__link--twitter" data-v-629ec8b5><i class="mdi mdi-twitter" data-v-629ec8b5></i></a></aside></section><div class="post-author-container" data-v-7de3dd27><h5 class="post-author-title" data-v-7de3dd27>Written by</h5><div class="post-author-text" data-v-7de3dd27><p data-v-7de3dd27><span class="role" data-v-7de3dd27>
                      COO
                    </span><span class="name-jp" data-v-7de3dd27>
                      金 仙優
                    </span><span class="name-en" data-v-7de3dd27>
                      Sonu Kim
                    </span></p><p class="author-desc" data-v-7de3dd27>
                    
                  </p><ul class="author-sns" data-v-7de3dd27><li data-v-7de3dd27><!----></li><li data-v-7de3dd27><!----></li><li data-v-7de3dd27><!----></li></ul></div></div></div></div></div><div class="p-news-bg" data-v-7de3dd27></div></article><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><a href="/blog-archives" class="post-archives-link" data-v-7de3dd27><span class="post-archives-link-text" data-v-7de3dd27>BACK TO LIST</span><span data-v-7de3dd27><img src="/assets/img/icon-back-to-list.3add3700.svg" alt="BACK TO LIST アイコン" data-v-7de3dd27></span></a></div></div></div></div></main><footer class="v-footer footer v-sheet v-sheet--tile theme--dark" data-v-a49f4c2c><div class="container" data-v-a49f4c2c data-v-a49f4c2c><div class="row" data-v-a49f4c2c data-v-a49f4c2c><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/works-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Works</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>実績紹介</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-b68eaa08 data-v-a49f4c2c><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/666/" class="c-footer-list__link" data-v-b68eaa08>
      A社（企業名非公開）
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/501/" class="c-footer-list__link" data-v-b68eaa08>
      戸田建設株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/396/" class="c-footer-list__link" data-v-b68eaa08>
      北海道テレビ放送株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/358/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社Geolonia
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/24/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社LIXIL
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/185/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社TOKION
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Services</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>サービス紹介</div></a></div><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスオペレーションズの<br data-v-a49f4c2c>サービスと強み</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/iot-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              IoT × サーバーレス / コンテナ開発<br data-v-a49f4c2c>導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/aws-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              AWSコアサーバーレスサービスの開発導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-consulting" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスコンサルティング</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-development" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスディべロプメント</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/our-products" class="c-footer-list__link" data-v-a49f4c2c>
              自社開発プロダクト
            </a></li></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/blog-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Blog</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>開発ブログ</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-39434060 data-v-a49f4c2c><li class="c-footer-list__item" data-v-39434060><a href="/blog/640/" class="c-footer-list__link" data-v-39434060>
      AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/532/" class="c-footer-list__link" data-v-39434060>
      AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/512/" class="c-footer-list__link" data-v-39434060>
      AWS Lambda + Nuxt3で実現する「サーバーレスなSSR」とその構成
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/25/" class="c-footer-list__link" data-v-39434060>
      Serverless Frameworkの使い方まとめ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/450/" class="c-footer-list__link" data-v-39434060>
      軽量で簡単に使えるキャッシュSaaS、MomentoをAWS Lambdaから使ってみる
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/429/" class="c-footer-list__link active--exact active" data-v-39434060>
      Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>About</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>会社案内</div></a><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c>
              会社案内
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/news-archives/" class="c-footer-list__link" data-v-a49f4c2c>
              おしらせ
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/privacy-policy/" class="c-footer-list__link" data-v-a49f4c2c>
              プライバシーポリシー
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/download" class="c-footer-list__link" data-v-a49f4c2c>
              会社資料ダウンロード
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/contact" class="c-footer-list__link" data-v-a49f4c2c>
              お問い合わせ
            </a></li></ul></div></div><div class="row mt-8 mt-md-12" data-v-a49f4c2c data-v-a49f4c2c><div class="col-md-2 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/" class="active" data-v-a49f4c2c><img src="/assets/img/footer-severless-operations-logo.e1e6687a.svg" alt="Severless Operations ロゴ" data-v-a49f4c2c></a></div></div><div class="col-md-10 col-12" data-v-a49f4c2c data-v-a49f4c2c><div class="sns-link text-md-right" data-v-a49f4c2c><a href="https://github.com/serverless-operations" target="_blank" class="sns-link__github" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" data-v-a49f4c2c></i></a><a href="https://twitter.com/slsopsinc" target="_blank" class="sns-link__twitter" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-twitter theme--light" data-v-a49f4c2c></i></a></div></div><div class="footer-copyright" data-v-a49f4c2c>
        © Serverless Operations, inc
      </div></div></div></footer></div></div>
    <script>window.__INITIAL_STATE__={"data":{"wordPressBlog":{"title":"Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS","content":"\n\u003Cp\u003E※ 2021 re:Invent のアップデート次第でタイムリーに内容が更新されることがあります。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E2021年5月、Next.js のホスティング先として \u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Faws.amazon.com\u002Fjp\u002Fabout-aws\u002Fwhats-new\u002F2021\u002F05\u002Faws-amplify-hosting-announces-server-side-rendering-support-for-next-js-web-apps\u002F\" data-type=\"URL\" data-id=\"https:\u002F\u002Faws.amazon.com\u002Fjp\u002Fabout-aws\u002Fwhats-new\u002F2021\u002F05\u002Faws-amplify-hosting-announces-server-side-rendering-support-for-next-js-web-apps\u002F\" target=\"_blank\"\u003EAWS Amplify Console が対応可能になったお知らせ\u003C\u002Fa\u003Eにより、SSR（Server-side rendering）においても Vercel や自前のホスティング環境を構築する以外のもう一つの選択肢として Amplify Console が利用できるようになりました。以前より \u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fwww.serverless.com\u002Fblog\u002Fserverless-nextjs\" data-type=\"URL\" data-id=\"https:\u002F\u002Fwww.serverless.com\u002Fblog\u002Fserverless-nextjs\" target=\"_blank\"\u003EServerless Nextjs Component\u003C\u002Fa\u003E を使うという方法もありましたが、Amplify Console を使うとフロントエンドのインフラ構築がほぼコードレスに対応できる点でオススメする方法となります。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eこの記事では、Amplify Console を使った基本的な Next.js のホスティング設定方法を紹介しつつ、いくつか TIPS を紹介します。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003EAmplify Console を利用したホスティング方法\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eまず、デプロイする Next.js アプリのテンプレートを作成します。\u003Ca href=\"https:\u002F\u002Fnextjs.org\u002Fdocs\u002Fapi-reference\u002Fcreate-next-app\" data-type=\"URL\" data-id=\"https:\u002F\u002Fnextjs.org\u002Fdocs\u002Fapi-reference\u002Fcreate-next-app\"\u003Ecreate-next-app\u003C\u002Fa\u003E を利用して新規プロジェクトとソースコードのテンプレートを展開します。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-bash\"\u003E\u003Ccode\u003Enpx create-next-app@latest --ts\n# or\nyarn create next-app --typescript\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eプロジェクト名を入力すると、コマンドを実行したところに指定した名前で新しくディレクトリが作成されます。そのままビルドして実行（ \u003Ccode\u003Eyarn build &amp;&amp; yarn start\u003C\u002Fcode\u003E ）すると、以下のようなサンプル画面が表示されます。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"561\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-13.56.38-1024x561.jpg\" alt=\"\" class=\"wp-image-431\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-13.56.38-1024x561.jpg 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-13.56.38-300x164.jpg 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-13.56.38-768x421.jpg 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-13.56.38-1536x842.jpg 1536w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-13.56.38.jpg 2000w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003Eこれをデプロイしてホスティングしてみます。Amplify Console では、GitHub\u002FGitLab\u002FBitBucket 等のリポジトリからソースコードを連携し、AWS 環境内でCI\u002FCDの仕組みを自動構築することができます。まずはサンプルとして GitHub リポジトリを作成し、テンプレートのソースコードをコミットしておきます。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-bash\"\u003E\u003Ccode\u003Egit remote add origin https:\u002F\u002Fgithub.com\u002F&lt;GITHUB_USERNAME&gt;\u002Famplify-hosting-next-app.git\ngit branch -M main\ngit push -u origin main\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003EAWS コンソールを開き、AWS Amplify &gt; Host your web app を選択します。\u003C\u002Fp\u003E\n\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter size-full is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-20.52.06.png\" alt=\"\" class=\"wp-image-432\" width=\"352\" height=\"301\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-20.52.06.png 502w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-20.52.06-300x257.png 300w\" sizes=\"(max-width: 352px) 100vw, 352px\" \u002F\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003E続いて From your existing code &gt; GitHub &gt; Continue を選択、GitHubでの認可の手続きを経て、先程作成したリポジトリとブランチを選択します。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"546\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-20.59.20-1024x546.png\" alt=\"\" class=\"wp-image-433\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-20.59.20-1024x546.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-20.59.20-300x160.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-20.59.20-768x410.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-20.59.20.png 1115w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003E特に問題なければ Next を押して進みます。Next.js テンプレートであれば、基本的に自動で Server-side rendering deployment と検知してくれます。もし npm scripts 内で \u003Ccode\u003Enext export\u003C\u002Fcode\u003E を使ってビルドする場合、SSR ではなく SSG（通常の静的アセット配信）として認識してくれるので、別途設定を行う必要がなく便利です。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"617\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.03.52-1024x617.png\" alt=\"\" class=\"wp-image-434\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.03.52-1024x617.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.03.52-300x181.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.03.52-768x462.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.03.52.png 1121w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003Cfigcaption\u003ESSGの場合 artifacts.baseDirectory が out になります\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003EAdvanced settings ではビルドで利用する Docker イメージや環境変数の指定ができます。後から変更することもできますので、開発が進むにつれて適宜変更していく想定で問題ないです。最初の時点では特に触れる必要がないため、引き続き Next を押して進めます。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"278\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.16.40-1024x278.png\" alt=\"\" class=\"wp-image-435\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.16.40-1024x278.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.16.40-300x81.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.16.40-768x209.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.16.40.png 1108w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003Cfigcaption\u003ESSG の場合 Framework: Next.js &#8211; SSG と表示されます\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003Eそれでは、Save and deploy を押してデプロイしてみましょう。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E（※初回ビルドに失敗する場合はこの記事の次のセクションをご参照ください）\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"282\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.56.08-1024x282.png\" alt=\"\" class=\"wp-image-438\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.56.08-1024x282.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.56.08-300x83.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.56.08-768x211.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.56.08.png 1162w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003E以降、指定したブランチへの push イベントを受けて自動デプロイされるようになります（※設定で無効化可能）。ビルドに成功すると発行されたURLを開いて画面を確認し、最初にローカルで実行したのと同じ画面が表示されていれば、ホスティング完了です。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"643\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-22.02.39-1024x643.jpg\" alt=\"\" class=\"wp-image-439\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-22.02.39-1024x643.jpg 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-22.02.39-300x188.jpg 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-22.02.39-768x482.jpg 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-22.02.39.jpg 1307w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eデフォルトのビルド環境で Node.js バージョンを指定する方法\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003Eデフォルトのビルドで利用するイメージの Node.js バージョンが v12 とやや古いため、現時点では初回のビルド実行で以下のエラーメッセージと共に失敗するようになります。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"335\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.33.54-1024x335.jpg\" alt=\"\" class=\"wp-image-436\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.33.54-1024x335.jpg 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.33.54-300x98.jpg 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.33.54-768x251.jpg 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.33.54.jpg 1259w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003Eこれを解決するためには、ビルドを実行する環境の Node.js バージョンを上げておく必要があります。幸い \u003Ccode\u003Envm\u003C\u002Fcode\u003E が利用できるので、preBuild の時点で必要な Node.js バージョンをインストール、\u003Ccode\u003Envm use\u003C\u002Fcode\u003E を使って指定しておくことで解決できます。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code\"\u003E\u003Ccode\u003Eversion: 1\nfrontend:\n  phases:\n    preBuild:\n      commands:\n        - nvm install 16.13.0\n        - nvm use 16.13.0\n        - node -v\n        - yarn install\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"641\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.36.58-1024x641.jpg\" alt=\"\" class=\"wp-image-437\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.36.58-1024x641.jpg 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.36.58-300x188.jpg 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.36.58-768x481.jpg 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-21.36.58.jpg 1139w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003ESSR → SSG, SSG → SSR への変換はできない\u003C\u002Fh2\u003E\n\n\n\n\u003Cdiv class=\"wp-block-columns is-layout-flex wp-container-7\"\u003E\n\u003Cdiv class=\"wp-block-column is-layout-flow\"\u003E\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"123\" height=\"68\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-22.20.33-1.png\" alt=\"\" class=\"wp-image-444\"\u002F\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cdiv class=\"wp-block-column is-layout-flow\"\u003E\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter size-full\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"113\" height=\"64\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2021\u002F11\u002FScreen-Shot-2021-11-30-at-22.20.22-2.png\" alt=\"\" class=\"wp-image-443\"\u002F\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EApp Settings &gt; General にて、上記のように SSR \u002F SSG のどちらで動作するかについて確認できるようになっています。ただし一度 SSR か SSG に指定されると、後から変更することは現状できないので注意が必要です。もし途中から変更したい場合、別途新しい App を追加・連携してホスティングする必要があります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eその他、ウェブアプリに必要な基本的な設定\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EAmplify Console はホスティングに関連する様々な機能が提供されています。SSL証明書発行を含むドメイン設定、ベーシック認証によるアクセスコントロール、リダイレクト設定など、従来の静的ファイル配信の定番構成 S3 + CloudFront を構築した経験があれば簡単にイメージできる機能が揃っています。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eベーシック認証によるアクセスコントロールについては、当初 SSR では非対応でしたが、現時点では対応されているので利用可能になっています。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eこれらの機能についてはコンソール左側のメニュー \u003Ccode\u003EApp settings\u003C\u002Fcode\u003E から適宜選択して設定を行うことができます。ただし、自前でホスティングする場合や CloudFront ディストリビューションを直接操作する場合に比べればできることが限られてくるので、Amplify Console を利用する場合は可能な限りフロントエンドのインフラ環境が複雑な構成にならないようにすることを念頭に置きつつ、アプリケーションの開発に集中することがポイントになります。\u003C\u002Fp\u003E\n","author":{"name":"Sonu Kim","description":"","avatars":{"avatar96":"https:\u002F\u002Fsecure.gravatar.com\u002Favatar\u002F5b527696e38c84c34048954d767b1537?s=96&d=mm&r=g"},"acf":{"userJpName":"金 仙優","userRole":"COO","facebook":"","twitter":"","github":""}},"date":"2021.11.30","path":"\u002Fblog\u002F429\u002F","featuredMedia":{"sourceUrl":"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2020\u002F05\u002Fso-release.png","altText":"so-release-image","mediaDetails":{"width":1200}},"categories":[{"id":"7","title":"Blog","path":"\u002Fcategory\u002Fblog\u002F"}],"tags":[{"id":"53","title":"Amplify","path":"\u002Ftag\u002Famplify\u002F"},{"id":"55","title":"Next.js","path":"\u002Ftag\u002Fnext-js\u002F"},{"id":"57","title":"React","path":"\u002Ftag\u002Freact\u002F"},{"id":"60","title":"Server-side rendering","path":"\u002Ftag\u002Fserver-side-rendering\u002F"},{"id":"2","title":"Serverless","path":"\u002Ftag\u002Fserverless\u002F"},{"id":"58","title":"SSR","path":"\u002Ftag\u002Fssr\u002F"}]},"metadata":{"siteName":"Serverless Operations","siteDescription":"Serverless Operationsは、これまでグローバルの第一線で培ってきたクラウド技術（AWS − アマゾンウェブサービス）の豊富な実績と知見を活かし、お客さまのサーバーレスによる開発や運用の支援、コンサルティングまで一貫してサポート。サーバーレスに関するさまざまな課題を解決いたします。","siteUrl":"https:\u002F\u002Fserverless.co.jp","siteOgImage":"https:\u002F\u002Fserverless.co.jp\u002Fogp.png"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.f355efd1.js" defer></script><script src="/assets/js/page--src--templates--word-press-blog-vue.fdf3ed1a.js" defer></script><script data-vue-tag="ssr" src="https://webfont.fontplus.jp/accessor/script/fontplus.js?LuMx0zy9taw%3D&box=ME4Rs88c3-0%3D&aa=1&ab=2" data-body="true"></script>
  </body>
</html>
