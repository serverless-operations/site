<!DOCTYPE html>
<html data-html-server-rendered="true" lang="ja" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22ja%22%7D%7D">
  <head>
    <title>AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ | Serverless Operations</title><meta name="gridsome:hash" content="7d8cc78e1b8fcf6bb367080efcae4f8df6dfb6c5"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="og:locale" property="og:locale" content="ja_JP"><meta data-vue-tag="ssr" data-key="og:site_name" property="og:site_name" content="Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://serverless.co.jp/ogp.png"><meta data-vue-tag="ssr" data-key="og:type" property="og:type" content="article"><meta data-vue-tag="ssr" data-key="og:url" property="og:url" content="https://serverless.co.jp/blog/640/"><meta data-vue-tag="ssr" data-key="og:image" property="og:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/so-release.png"><meta data-vue-tag="ssr" data-key="og:title" property="og:title" content="AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ | Serverless Operations"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:image" content="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/so-release.png"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.2cc8acaa6971d9266cbf9d7d5455c37a.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css"><link data-vue-tag="ssr" data-key="canonical" rel="canonical" href="https://serverless.co.jp/blog/640/"><link rel="preload" href="/assets/css/0.styles.98f560c0.css" as="style"><link rel="preload" href="/assets/js/app.748a8736.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--word-press-blog-vue.3139ba43.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.0efd8db6.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.1af80757.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-archives-vue.3f2792c8.js"><link rel="prefetch" href="/assets/js/page--src--pages--contact-vue.ff3778ed.js"><link rel="prefetch" href="/assets/js/page--src--pages--download-vue.ed8d75f7.js"><link rel="prefetch" href="/assets/js/page--src--pages--event-archives-vue.020ba0bf.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.be66fc9c.js"><link rel="prefetch" href="/assets/js/page--src--pages--news-archives-vue.d0b081f1.js"><link rel="prefetch" href="/assets/js/page--src--pages--our-products-vue.dc9f52c4.js"><link rel="prefetch" href="/assets/js/page--src--pages--privacy-policy-vue.fdaf6562.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue.b118f419.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--aws-serverless-vue~page--src--pages--services--iot-serverless-vue.bada637e.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--index-vue.45768e68.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--iot-serverless-vue.bbc11f2a.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-consulting-vue.1e87ce7a.js"><link rel="prefetch" href="/assets/js/page--src--pages--services--serverless-development-vue.4d9baf66.js"><link rel="prefetch" href="/assets/js/page--src--pages--test-form-vue.03f7db27.js"><link rel="prefetch" href="/assets/js/page--src--pages--works-archives-vue.eb99c43a.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-category-vue.d9298a51.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-tag-vue.1b66b17a.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-vue.808e5e69.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-works-vue.491af2ec.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--contact-vue~page--src--pages--download-vue.7a23cb3f.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--our-products-vue.8e9052c2.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-blog-vue.16b09ab1.js"><link rel="stylesheet" href="/assets/css/0.styles.98f560c0.css"><script data-vue-tag="ssr">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MLP4448');</script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="v-application v-application--is-ltr theme--dark" data-v-7de3dd27><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MLP4448" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="v-application--wrap"><header class="header-nav" data-v-5f4f5539><div class="header-nav__logo-block" data-v-5f4f5539><a href="/" class="header-nav__logo-link active" data-v-5f4f5539><img src="/assets/img/header-logo.a93f880b.svg" alt="Severless Operations ロゴ" class="header-nav__logo" data-v-5f4f5539></a></div><nav data-v-5f4f5539><ul data-v-5f4f5539><li data-v-5f4f5539><a href="/about" data-v-5f4f5539>私たちについて</a></li><li data-v-5f4f5539><a href="/services" data-v-5f4f5539>サービス</a></li><li data-v-5f4f5539><a href="/works-archives" data-v-5f4f5539>実績紹介</a></li><li data-v-5f4f5539><a href="/blog-archives" data-v-5f4f5539>ブログ</a></li><li data-v-5f4f5539><a href="/news-archives" data-v-5f4f5539>お知らせ</a></li><li data-v-5f4f5539><a href="/download" data-v-5f4f5539>会社資料ダウンロード</a></li><li data-v-5f4f5539><a href="/contact" data-v-5f4f5539>お問い合わせ</a></li></ul></nav><div id="app" class="header-nav__toggler-block d-block d-md-none" data-v-5f4f5539><button id="btn" type="button" class="header-nav__toggler-button btn" data-v-5f4f5539><div tabindex="-1" class="btn__content" data-v-5f4f5539><span class="header-nav__toggler-top" data-v-5f4f5539></span><span class="header-nav__toggler-middle" data-v-5f4f5539></span><span class="header-nav__toggler-bottom" data-v-5f4f5539></span></div></button></div><!----></header><main class="v-content"><div class="v-content" data-v-7de3dd27><div class="v-content__wrap" data-v-7de3dd27><div class="container" data-v-7de3dd27><p class="category-title" data-v-7de3dd27>
          Blog
        </p></div><header class="post-header" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="col-md-10 col-11" data-v-7de3dd27><h1 class="post-title" data-v-7de3dd27>AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ</h1><div class="post-tag-container" data-v-7de3dd27><time datetime="2023.08.20" class="post-date" data-v-7de3dd27> 
                  2023.08.20
                  
                </time><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>AFT</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>AWS</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>AWS Organizations</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Control Tower</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>EventBridge</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Serverless</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Service Catalog</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Terraform</span></div><div class="post-tags" data-v-7de3dd27><span data-v-7de3dd27>Terraform Cloud</span></div></div></div></div></div></header><article class="post-container" data-v-7de3dd27><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><div class="post-article-container col-md-10 col-11" data-v-7de3dd27><div class="post-article" data-v-7de3dd27>
<p>AWS環境を利用して開発を行う上で、複数のアカウントを跨ぎながら開発を行うことが一般的になってきました。例えば、商用環境（production）と開発環境（development）のアカウントを分離して利用したり、ステージング環境やQA環境を別途用意して検証を行うこともあるかと思います。一方、様々な組織がAWS環境を利用していて、それらの組織に対して個別にアカウントを払い出し、各アカウントがどのように利用されているか管理を行っていく場面も多々あるかと思います。</p>



<p>本記事では、そういった場面においてどのように複数のアカウントを管理し、AWSを開発基盤として利用していけるかについて、セキュリティを考慮した観点を交えてお伝えしていきたいと思います。</p>



<h2 class="wp-block-heading">マルチアカウント構成にする理由</h2>



<p>「一つのAWSアカウント」を複数の組織が利用したり、複数のシステムの構築運用に利用すること自体、可能です。しかし、管理において例えば以下のような悩みが発生することになります。</p>



<ul>
<li>別の組織や業務委託先によるアクセスを防ぐなど、AWSリソースやデータに対して細かく権限制御を行いたい</li>



<li>組織・システムごとに費用を分けて管理したい</li>



<li>商用環境へのアクセスや操作を限定し、意図しないミスを防ぎたい</li>



<li>大規模なプロジェクトに取り組んでいて、ユーザー管理及び権限管理をしやすくしたい</li>



<li>監査対応とログ管理のコストが増大し、そのための仕組みや運用の工夫が必要になる</li>
</ul>



<p>具体的には、複数の組織やプロジェクトから共通のAWSサービスを利用する場合、見せたくないリソースが他の組織から見えてしまったり、操作ができてしまうことが考えられます。IAM ポリシーなどで細かく制御することは十分可能ですが、変更がある度にリソースレベルで権限制御を行うことは辛い作業になることもあるかと思います。</p>



<p>また、シングルアカウントでは、複数のユーザーグループによるAWS サービスの利用状況・ネットワーク構成・ロギング・DB運用やデータ管理など、様々な領域において密度の高いアカウント構成となるため、監査対応やログの調査にも膨大なコストがかかることが想定されます。</p>



<p>これらの悩みを効果的に解決するために必要になるのがマルチアカウント戦略となります。</p>



<h2 class="wp-block-heading">AWS アカウント管理を行う上で考えたいポイント</h2>



<p>以下のような分類で、マルチアカウント構成の観点から考慮すべきポイントがあります。</p>



<h3 class="wp-block-heading">認証方法</h3>



<p>どのような方法でAWSアカウントへアクセスするかという点においては、AWS IAM アイデンティティセンター（AWS SSO）を利用して認証する場所を一つにまとめることができます。ID/PASS及びMFA認証を経て、以下のような画面からマネジメントコンソールを開くことができ、また一時的なアクセスキーを発行して利用することが可能です。</p>


<div class="wp-block-image">
<figure class="aligncenter size-large is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/1-1024x892.png" alt="AWS IAM アイデンティティセンター（AWS SSO）" class="wp-image-641" width="626" height="544" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/1-1024x892.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/1-300x261.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/1-768x669.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/1.png 1049w" sizes="(max-width: 626px) 100vw, 626px" /></figure></div>


<h3 class="wp-block-heading">アカウントを分離する基準と構成</h3>



<p>どのようにアカウントを分離するかについての基準と構成のアウトラインが必要です。具体的には、AWS Organizations の OU（Organization Unit）構成について考えることになりますが、「AWS Control Tower」 というマルチアカウント管理サービスの基本構成をベースラインとすることがおすすめです。</p>


<div class="wp-block-image">
<figure class="aligncenter size-full is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_2.png" alt="AWS Organizations の OU（Organization Unit）構成" class="wp-image-642" width="735" height="602" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_2.png 881w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_2-300x246.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_2-768x629.png 768w" sizes="(max-width: 735px) 100vw, 735px" /></figure></div>


<p>また、環境によってもアカウントを分離することが考えられます。以下のようにアカウントを分離することで、各アカウントのクオーターをフルで活用でき、システムコンポーネントやワークロードの分離、IaCによるリソース管理、ログ収集などが明確な権限の境界線を持った上で拡張・分離できるというメリットがあります。</p>


<div class="wp-block-image">
<figure class="aligncenter size-full is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_3_1-1.png" alt="Production / Non-production による区分" class="wp-image-645" width="727" height="364" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_3_1-1.png 881w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_3_1-1-300x150.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_3_1-1-768x384.png 768w" sizes="(max-width: 727px) 100vw, 727px" /><figcaption class="wp-element-caption">Production / Non-production による区分</figcaption></figure></div>

<div class="wp-block-image">
<figure class="aligncenter size-full is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_3_2-1.png" alt="共通機能をまとめたOU（Shared Service OU）による区分" class="wp-image-646" width="743" height="372" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_3_2-1.png 881w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_3_2-1-300x150.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_3_2-1-768x384.png 768w" sizes="(max-width: 743px) 100vw, 743px" /><figcaption class="wp-element-caption">共通機能をまとめたOU（Shared Service OU）による区分</figcaption></figure></div>


<h3 class="wp-block-heading">権限設定</h3>



<p>SSOで認証したユーザーに対して持たせる権限と、システムとしてアカウントを跨いだ構成になる場合の Assume Role 構成を検討します。ユーザー権限については、関係各者をグループングしてどのアカウントに・どこまでの権限を渡すかについても考えておく必要があります。例えば、以下のようなグループとして分離することが考えられます。</p>



<ul>
<li>AWS開発基盤管理者</li>



<li>プロジェクト関係者、開発者</li>



<li>外部パートナーなど、業務委託先の作業者</li>



<li>QA, 監視, 監査担当者</li>
</ul>



<p>それぞれのポジションをロールとして適切な権限を適用し、メンバー入れ替え時も簡単に対応できる仕組みがAWS IAM アイデンティティセンター（AWS SSO）に備わっています。以下のように Permission Set を構成して各アカウント及びユーザーグループに指定する形で設定を行います。</p>


<div class="wp-block-image">
<figure class="aligncenter size-large is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/2-1-1024x693.png" alt="Permission SetにてSSOユーザーに指定するポリシーを設定" class="wp-image-647" width="696" height="470" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/2-1-1024x693.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/2-1-300x203.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/2-1-768x520.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/2-1.png 1159w" sizes="(max-width: 696px) 100vw, 696px" /><figcaption class="wp-element-caption">Permission SetにてSSOユーザーに指定するポリシーを設定</figcaption></figure></div>

<div class="wp-block-image">
<figure class="aligncenter size-large is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/2-2-1024x743.png" alt="Permission Setが適用されているアカウント一覧" class="wp-image-648" width="698" height="505" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/2-2-1024x743.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/2-2-300x218.png 300w" sizes="(max-width: 698px) 100vw, 698px" /><figcaption class="wp-element-caption">Permission Setが適用されているアカウント一覧</figcaption></figure></div>


<h3 class="wp-block-heading">費用</h3>



<p>AWS Organizations の一括請求によって支払が統合されます。注意点として、全体及びアカウントごとの Billing Alert または AWS Budgets を設定して監視を行うことをおすすめします。設定ミスや無限ループなどによる予期せぬコスト増にも早めに気づくことができます。</p>


<div class="wp-block-image">
<figure class="aligncenter size-large is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/3-1-1024x697.png" alt="CloudWatch の Billing メトリクスを有効化" class="wp-image-649" width="656" height="446" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/3-1-1024x697.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/3-1-300x204.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/3-1-768x523.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/3-1.png 1209w" sizes="(max-width: 656px) 100vw, 656px" /><figcaption class="wp-element-caption">CloudWatch の Billing メトリクスを有効化</figcaption></figure></div>

<div class="wp-block-image">
<figure class="aligncenter size-full is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/3-2.png" alt="メトリクスから各アカウントごとの料金を確認、アラートを設定" class="wp-image-650" width="663" height="260" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/3-2.png 766w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/3-2-300x117.png 300w" sizes="(max-width: 663px) 100vw, 663px" /><figcaption class="wp-element-caption">メトリクスから各アカウントごとの料金を確認、アラートを設定</figcaption></figure></div>


<h2 class="wp-block-heading">マルチアカウント構成を取り入れた開発基盤の構成イメージ</h2>



<p>例えば、複数のDevOpsチームを持ち、複数のプロダクトを構えるプラットフォーム開発基盤としての構成イメージがこちらになります。必要に応じて OU 及びそれに属する AWS アカウントを柔軟に追加することができ、アカウントレベルでも疎結合なアプローチとなります。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="640" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_4-1024x640.png" alt="マルチアカウント構成を取り入れた開発基盤の構成イメージ" class="wp-image-651" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_4-1024x640.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_4-300x188.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_4-768x480.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_4.png 1281w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<h2 class="wp-block-heading">セキュリティにおける考慮事項</h2>



<p>複数のアカウントを管理していくときの懸念点として、コンプライアンスやセキュリティ面におけるリスク対応のための共通設定を適用する必要があります。一方で、一部のアカウントには開発のための例外措置や、より厳しいルールを指定するといったカスタマイズが必要になるケースがあります。</p>



<p>マルチアカウント構成において AWS Control Tower を利用することである程度基本的なところは整いますが、各組織の特性や制約などを踏まえると、AWS Config によるルールの整備と、ルールに違反した構成が組まれた際の監視を自動化する仕組みが必要になります。そのためのアプローチとしては、以下のようは方法があります。</p>



<ul>
<li>AWS Security Hub / AWS Config / Amazon GuardDuty など、各種セキュリティ関連サービスの有効化と設定</li>



<li>有事の際や検証にひかかったときに通知を行う仕組み</li>
</ul>


<div class="wp-block-image">
<figure class="aligncenter size-large is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.30.15-1024x639.png" alt="セキュリティ標準項目を指定したSecurity Hubのレポート画面" class="wp-image-652" width="598" height="373" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.30.15-1024x639.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.30.15-300x187.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.30.15-768x479.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.30.15.png 1228w" sizes="(max-width: 598px) 100vw, 598px" /><figcaption class="wp-element-caption">セキュリティ標準項目を指定したSecurity Hubのレポート画面</figcaption></figure></div>


<p>Security Hub の設定では、標準としてAWSベストプラクティス・CIS AWS Foundations Benchmark (v1.2.0, v1,4,0)・NIST SP 800-53 などがサポートされています。</p>


<div class="wp-block-image">
<figure class="aligncenter size-full is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.18.50.png" alt="セキュリティ標準" class="wp-image-654" width="470" height="151" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.18.50.png 826w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.18.50-300x96.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/Screenshot-2023-08-20-at-2.18.50-768x245.png 768w" sizes="(max-width: 470px) 100vw, 470px" /></figure></div>


<p>また、AWS Config を利用してカスタムルールを適用する機能も使えます。AWS Lambda と連動して、チェックする周期の指定やチェックのロジックを実行して監視することができます。</p>



<p>セキュリティに関するルールセットや監視については、作成するアカウント全てに適用しておくことが望ましいです。しかし、個別のアカウントごとに同じ設定をマニュアル対応することはやや現実的ではありません。よって、次項で説明するアカウント作成の自動化（Account Factory）を検討してみることをおすすめします。</p>



<h2 class="wp-block-heading">アカウント作成の自動化</h2>



<p>AWS Control Tower を利用すると、Account Factory という機能を使って新規アカウントを作成することができます。Service Catalog に新規アカウント Product が登録されており、連携してアカウント名やOUなど必要なパラメータ情報を入力すると新規アカウントが作成されます。完了後は AWS Control Tower 管理下のアカウントとして紐づく流れになります。</p>



<p>この一連の流れについて、公式でサポートされている「AFT（Account Factory for Terraform）」というソリューションがあります。アカウント新規作成、アカウント作成時のカスタマイズ、アカウント作成後の個別アカウントごとのカスタマイズ、アカウント作成後の全アカウント共通設定を適用するカスタマイズなど、様々な形でマルチアカウント構成を構築運用するための機能が含まれています。</p>


<div class="wp-block-image">
<figure class="aligncenter size-large is-resized"><img decoding="async" loading="lazy" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/aws_ct_diagram-1024x636.png" alt="AFT（Account Factory for Terraform）" class="wp-image-655" width="699" height="433" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/aws_ct_diagram-1024x636.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/aws_ct_diagram-300x186.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/aws_ct_diagram-768x477.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/aws_ct_diagram.png 1728w" sizes="(max-width: 699px) 100vw, 699px" /><figcaption class="wp-element-caption">Terraform &gt; Control Tower より抜粋（2023.08.19）<br>https://developer.hashicorp.com/terraform/tutorials/aws/aws-control-tower-aft</figcaption></figure></div>


<p>しかし、公式では、利用しない間にも発生する固定費用（NAT Gateway の料金など）を含めややコストが発生したり、高機能であるが故に、カジュアルに利用するという観点ではどうかなという疑問もあるかと思います。その場合、公式のAFTの構成を参考に、以下のようにカジュアルな形でアカウント作成とカスタマイズの設定を行う構成の仕組みを構築することができます。Terraform コードでアカウント作成情報を記載し、Terraform Cloud からデプロイする構成になります。フルサーバーレスで対応できる点もメリットになります。</p>



<figure class="wp-block-image size-large"><img decoding="async" loading="lazy" width="1024" height="620" src="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_5-1024x620.png" alt="Terraform Cloud からデプロイする構成" class="wp-image-656" srcset="https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_5-1024x620.png 1024w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_5-300x182.png 300w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_5-768x465.png 768w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_5-1536x930.png 1536w, https://cdn.getshifter.co/f6642def64a63651c07142605e040674c5441f6d/uploads/2023/08/image_5.png 1621w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>アカウント作成リクエストに関しては、以下のような Terraform コードを書いて IaC 化することが可能です。</p>



<p>enviroment/<code>main.tf</code></p>



<pre class="wp-block-code language-terraform"><code>provider "aws" {
  region = "ap-northeast-1"
}

module "sandbox_account_01" {
  source = "../modules/sandbox_account/"
  account_name             = "sandbox01"
  product_id               = "prod-xxxxxxxxxx"
  provisioning_artifact_id = "pa-xxxxxxxxxxxx"
  new_account_params = {
    account_email       = "sandbox01@example.com"
    account_name        = "sandbox01"
    ou                  = "Sandbox (ou-xxxx)"
    sso_user_email      = "sandbox01@example.com"
    sso_user_first_name = "Katsuo"
    sso_user_last_name  = "Isono"
  }
}</code></pre>



<p><code>modules/sandbox_account/main.tf</code></p>



<pre class="wp-block-code language-terraform"><code>resource "aws_servicecatalog_provisioned_product" "new_controll_tower_managed_account" {
  name                     = var.account_name
  product_id               = var.product_id
  provisioning_artifact_id = var.provisioning_artifact_id

  provisioning_parameters {
    key   = "AccountEmail"
    value = var.new_account_params.account_email
  }
  provisioning_parameters {
    key   = "AccountName"
    value = var.new_account_params.account_name
  }
  # ...
}</code></pre>



<p>アカウント作成が完了すれば、EventBridge から以下のようなイベントを取得することが可能です。このイベントを拾って別途 Terraform Cloud 上で workspace を作成し、後続処理として AWS Config のカスタムルールの設定やアカウントごとのカスタマイズなどを適用することが可能になります。</p>



<pre class="wp-block-preformatted language-json">{<br>  "detail-type": "AWS Service Event via CloudTrail",<br>  "source": "aws.controltower",<br>  "detail": {<br>    "eventSource": "controltower.amazonaws.com",<br>    "eventName": "CreateManagedAccount",<br>    "awsRegion": "ap-northeast-1",<br>    "serviceEventDetails": {<br>      "createManagedAccountStatus": {<br>        "organizationalUnit": {<br>          "organizationalUnitName": "Sandbox",<br>          "organizationalUnitId": "ou-xxxx-xxxxx"<br>        },<br>        "account": {<br>          "accountName": "sandbox05",<br>          "accountId": "111122223333"<br>        },<br>        "state": "SUCCEEDED",<br>        "message": "AWS Control Tower successfully created an enrolled account.",<br>      }<br>    }<br>    // ...<br>  }<br>}</pre>



<p>いかがだったでしょうか。結論としては、各組織・プロジェクトの特性と制約を鑑みながら、可能な限りセキュリティと運用効率の両方を向上できる形で開発基盤を構築することを目指す形になります。AWSのベストプラクティスを積極的に理解して活用することも大事ですので、そういった情報を探していた方々の参考になると幸いです。不明点などあれば、お気軽にお問い合わせください。</p>
</div><section class="l-share-button" data-v-629ec8b5 data-v-7de3dd27><aside class="p-share-button" data-v-629ec8b5><div class="p-share-button__header" data-v-629ec8b5>SHARE</div><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fserverless.co.jp%2Fblog%2F640%2F" target="_blank" title="Facebookでシェア" class="p-share-button__link--facebook " data-v-629ec8b5><i class="mdi mdi-facebook" data-v-629ec8b5></i></a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fserverless.co.jp%2Fblog%2F640%2F&amp;text=AWS%20%E9%96%8B%E7%99%BA%E5%9F%BA%E7%9B%A4%E3%81%A8%E3%81%97%E3%81%A6%E3%80%81%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%92%E8%80%83%E6%85%AE%E3%81%97%E3%81%9F%E3%83%9E%E3%83%AB%E3%83%81%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E6%A7%8B%E6%88%90%E3%81%AE%E3%82%B9%E3%82%B9%E3%83%A1" target="_blank" title="Twitterでシェア" class="p-share-button__link--twitter" data-v-629ec8b5><i class="mdi mdi-twitter" data-v-629ec8b5></i></a></aside></section><div class="post-author-container" data-v-7de3dd27><h5 class="post-author-title" data-v-7de3dd27>Written by</h5><div class="post-author-text" data-v-7de3dd27><p data-v-7de3dd27><span class="role" data-v-7de3dd27>
                      COO
                    </span><span class="name-jp" data-v-7de3dd27>
                      金 仙優
                    </span><span class="name-en" data-v-7de3dd27>
                      Sonu Kim
                    </span></p><p class="author-desc" data-v-7de3dd27>
                    
                  </p><ul class="author-sns" data-v-7de3dd27><li data-v-7de3dd27><!----></li><li data-v-7de3dd27><!----></li><li data-v-7de3dd27><!----></li></ul></div></div></div></div></div><div class="p-news-bg" data-v-7de3dd27></div></article><div class="container" data-v-7de3dd27><div class="row justify-center" data-v-7de3dd27><a href="/blog-archives" class="post-archives-link" data-v-7de3dd27><span class="post-archives-link-text" data-v-7de3dd27>BACK TO LIST</span><span data-v-7de3dd27><img src="/assets/img/icon-back-to-list.3add3700.svg" alt="BACK TO LIST アイコン" data-v-7de3dd27></span></a></div></div></div></div></main><footer class="v-footer footer v-sheet v-sheet--tile theme--dark" data-v-a49f4c2c><div class="container" data-v-a49f4c2c data-v-a49f4c2c><div class="row" data-v-a49f4c2c data-v-a49f4c2c><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/works-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Works</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>実績紹介</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-b68eaa08 data-v-a49f4c2c><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/501/" class="c-footer-list__link" data-v-b68eaa08>
      戸田建設株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/396/" class="c-footer-list__link" data-v-b68eaa08>
      北海道テレビ放送株式会社
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/358/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社Geolonia
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/24/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社LIXIL
    </a></li><li class="c-footer-list__item" data-v-b68eaa08><a href="/works/185/" class="c-footer-list__link" data-v-b68eaa08>
      株式会社TOKION
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Services</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>サービス紹介</div></a></div><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスオペレーションズの<br data-v-a49f4c2c>サービスと強み</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/iot-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              IoT × サーバーレス / コンテナ開発<br data-v-a49f4c2c>導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/aws-serverless" class="c-footer-list__link" data-v-a49f4c2c>
              AWSコアサーバーレスサービスの開発導⼊サポート
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-consulting" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスコンサルティング</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/services/serverless-development" class="c-footer-list__link" data-v-a49f4c2c>サーバーレスディべロプメント</a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/our-products" class="c-footer-list__link" data-v-a49f4c2c>
              自社開発プロダクト
            </a></li></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/blog-archives" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>Blog</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>開発ブログ</div></a><ul class="c-footer-list" data-v-a49f4c2c><div data-v-39434060 data-v-a49f4c2c><li class="c-footer-list__item" data-v-39434060><a href="/blog/640/" class="c-footer-list__link active--exact active" data-v-39434060>
      AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/532/" class="c-footer-list__link" data-v-39434060>
      AWS Amplify GraphQL Transformer v2 のデータモデリングとリレーションの仕組みを解説する
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/512/" class="c-footer-list__link" data-v-39434060>
      AWS Lambda + Nuxt3で実現する「サーバーレスなSSR」とその構成
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/25/" class="c-footer-list__link" data-v-39434060>
      Serverless Frameworkの使い方まとめ
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/450/" class="c-footer-list__link" data-v-39434060>
      軽量で簡単に使えるキャッシュSaaS、MomentoをAWS Lambdaから使ってみる
    </a></li><li class="c-footer-list__item" data-v-39434060><a href="/blog/429/" class="c-footer-list__link" data-v-39434060>
      Next.js アプリケーションを AWS Amplify でホスティングする上でのTIPS
    </a></li></div></ul></div><div class="footer-list-anim col-sm-6 col-md-3 col-12" data-v-a49f4c2c data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c><div class="c-footer-menu__title" data-v-a49f4c2c>About</div><div class="c-footer-menu__subtitle" data-v-a49f4c2c>会社案内</div></a><ul class="c-footer-list" data-v-a49f4c2c><li class="c-footer-list__item" data-v-a49f4c2c><a href="/about" class="c-footer-list__link" data-v-a49f4c2c>
              会社案内
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/news-archives/" class="c-footer-list__link" data-v-a49f4c2c>
              おしらせ
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/privacy-policy/" class="c-footer-list__link" data-v-a49f4c2c>
              プライバシーポリシー
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/download" class="c-footer-list__link" data-v-a49f4c2c>
              会社資料ダウンロード
            </a></li><li class="c-footer-list__item" data-v-a49f4c2c><a href="/contact" class="c-footer-list__link" data-v-a49f4c2c>
              お問い合わせ
            </a></li></ul></div></div><div class="row mt-8 mt-md-12" data-v-a49f4c2c data-v-a49f4c2c><div class="col-md-2 col-12" data-v-a49f4c2c data-v-a49f4c2c><div data-v-a49f4c2c><a href="/" class="active" data-v-a49f4c2c><img src="/assets/img/footer-severless-operations-logo.e1e6687a.svg" alt="Severless Operations ロゴ" data-v-a49f4c2c></a></div></div><div class="col-md-10 col-12" data-v-a49f4c2c data-v-a49f4c2c><div class="sns-link text-md-right" data-v-a49f4c2c><a href="https://github.com/serverless-operations" target="_blank" class="sns-link__github" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" data-v-a49f4c2c></i></a><a href="https://twitter.com/slsopsinc" target="_blank" class="sns-link__twitter" data-v-a49f4c2c><i aria-hidden="true" class="v-icon notranslate mdi mdi-twitter theme--light" data-v-a49f4c2c></i></a></div></div><div class="footer-copyright" data-v-a49f4c2c>
        © Serverless Operations, inc
      </div></div></div></footer></div></div>
    <script>window.__INITIAL_STATE__={"data":{"wordPressBlog":{"title":"AWS 開発基盤として、セキュリティを考慮したマルチアカウント構成のススメ","content":"\n\u003Cp\u003EAWS環境を利用して開発を行う上で、複数のアカウントを跨ぎながら開発を行うことが一般的になってきました。例えば、商用環境（production）と開発環境（development）のアカウントを分離して利用したり、ステージング環境やQA環境を別途用意して検証を行うこともあるかと思います。一方、様々な組織がAWS環境を利用していて、それらの組織に対して個別にアカウントを払い出し、各アカウントがどのように利用されているか管理を行っていく場面も多々あるかと思います。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E本記事では、そういった場面においてどのように複数のアカウントを管理し、AWSを開発基盤として利用していけるかについて、セキュリティを考慮した観点を交えてお伝えしていきたいと思います。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eマルチアカウント構成にする理由\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E「一つのAWSアカウント」を複数の組織が利用したり、複数のシステムの構築運用に利用すること自体、可能です。しかし、管理において例えば以下のような悩みが発生することになります。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003E別の組織や業務委託先によるアクセスを防ぐなど、AWSリソースやデータに対して細かく権限制御を行いたい\u003C\u002Fli\u003E\n\n\n\n\u003Cli\u003E組織・システムごとに費用を分けて管理したい\u003C\u002Fli\u003E\n\n\n\n\u003Cli\u003E商用環境へのアクセスや操作を限定し、意図しないミスを防ぎたい\u003C\u002Fli\u003E\n\n\n\n\u003Cli\u003E大規模なプロジェクトに取り組んでいて、ユーザー管理及び権限管理をしやすくしたい\u003C\u002Fli\u003E\n\n\n\n\u003Cli\u003E監査対応とログ管理のコストが増大し、そのための仕組みや運用の工夫が必要になる\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003E具体的には、複数の組織やプロジェクトから共通のAWSサービスを利用する場合、見せたくないリソースが他の組織から見えてしまったり、操作ができてしまうことが考えられます。IAM ポリシーなどで細かく制御することは十分可能ですが、変更がある度にリソースレベルで権限制御を行うことは辛い作業になることもあるかと思います。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eまた、シングルアカウントでは、複数のユーザーグループによるAWS サービスの利用状況・ネットワーク構成・ロギング・DB運用やデータ管理など、様々な領域において密度の高いアカウント構成となるため、監査対応やログの調査にも膨大なコストがかかることが想定されます。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eこれらの悩みを効果的に解決するために必要になるのがマルチアカウント戦略となります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003EAWS アカウント管理を行う上で考えたいポイント\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E以下のような分類で、マルチアカウント構成の観点から考慮すべきポイントがあります。\u003C\u002Fp\u003E\n\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003E認証方法\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003Eどのような方法でAWSアカウントへアクセスするかという点においては、AWS IAM アイデンティティセンター（AWS SSO）を利用して認証する場所を一つにまとめることができます。ID\u002FPASS及びMFA認証を経て、以下のような画面からマネジメントコンソールを開くことができ、また一時的なアクセスキーを発行して利用することが可能です。\u003C\u002Fp\u003E\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-large is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F1-1024x892.png\" alt=\"AWS IAM アイデンティティセンター（AWS SSO）\" class=\"wp-image-641\" width=\"626\" height=\"544\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F1-1024x892.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F1-300x261.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F1-768x669.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F1.png 1049w\" sizes=\"(max-width: 626px) 100vw, 626px\" \u002F\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003Eアカウントを分離する基準と構成\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003Eどのようにアカウントを分離するかについての基準と構成のアウトラインが必要です。具体的には、AWS Organizations の OU（Organization Unit）構成について考えることになりますが、「AWS Control Tower」 というマルチアカウント管理サービスの基本構成をベースラインとすることがおすすめです。\u003C\u002Fp\u003E\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-full is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_2.png\" alt=\"AWS Organizations の OU（Organization Unit）構成\" class=\"wp-image-642\" width=\"735\" height=\"602\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_2.png 881w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_2-300x246.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_2-768x629.png 768w\" sizes=\"(max-width: 735px) 100vw, 735px\" \u002F\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\u003Cp\u003Eまた、環境によってもアカウントを分離することが考えられます。以下のようにアカウントを分離することで、各アカウントのクオーターをフルで活用でき、システムコンポーネントやワークロードの分離、IaCによるリソース管理、ログ収集などが明確な権限の境界線を持った上で拡張・分離できるというメリットがあります。\u003C\u002Fp\u003E\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-full is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_3_1-1.png\" alt=\"Production \u002F Non-production による区分\" class=\"wp-image-645\" width=\"727\" height=\"364\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_3_1-1.png 881w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_3_1-1-300x150.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_3_1-1-768x384.png 768w\" sizes=\"(max-width: 727px) 100vw, 727px\" \u002F\u003E\u003Cfigcaption class=\"wp-element-caption\"\u003EProduction \u002F Non-production による区分\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-full is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_3_2-1.png\" alt=\"共通機能をまとめたOU（Shared Service OU）による区分\" class=\"wp-image-646\" width=\"743\" height=\"372\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_3_2-1.png 881w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_3_2-1-300x150.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_3_2-1-768x384.png 768w\" sizes=\"(max-width: 743px) 100vw, 743px\" \u002F\u003E\u003Cfigcaption class=\"wp-element-caption\"\u003E共通機能をまとめたOU（Shared Service OU）による区分\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003E権限設定\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003ESSOで認証したユーザーに対して持たせる権限と、システムとしてアカウントを跨いだ構成になる場合の Assume Role 構成を検討します。ユーザー権限については、関係各者をグループングしてどのアカウントに・どこまでの権限を渡すかについても考えておく必要があります。例えば、以下のようなグループとして分離することが考えられます。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EAWS開発基盤管理者\u003C\u002Fli\u003E\n\n\n\n\u003Cli\u003Eプロジェクト関係者、開発者\u003C\u002Fli\u003E\n\n\n\n\u003Cli\u003E外部パートナーなど、業務委託先の作業者\u003C\u002Fli\u003E\n\n\n\n\u003Cli\u003EQA, 監視, 監査担当者\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003Eそれぞれのポジションをロールとして適切な権限を適用し、メンバー入れ替え時も簡単に対応できる仕組みがAWS IAM アイデンティティセンター（AWS SSO）に備わっています。以下のように Permission Set を構成して各アカウント及びユーザーグループに指定する形で設定を行います。\u003C\u002Fp\u003E\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-large is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F2-1-1024x693.png\" alt=\"Permission SetにてSSOユーザーに指定するポリシーを設定\" class=\"wp-image-647\" width=\"696\" height=\"470\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F2-1-1024x693.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F2-1-300x203.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F2-1-768x520.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F2-1.png 1159w\" sizes=\"(max-width: 696px) 100vw, 696px\" \u002F\u003E\u003Cfigcaption class=\"wp-element-caption\"\u003EPermission SetにてSSOユーザーに指定するポリシーを設定\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-large is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F2-2-1024x743.png\" alt=\"Permission Setが適用されているアカウント一覧\" class=\"wp-image-648\" width=\"698\" height=\"505\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F2-2-1024x743.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F2-2-300x218.png 300w\" sizes=\"(max-width: 698px) 100vw, 698px\" \u002F\u003E\u003Cfigcaption class=\"wp-element-caption\"\u003EPermission Setが適用されているアカウント一覧\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\u003Ch3 class=\"wp-block-heading\"\u003E費用\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003EAWS Organizations の一括請求によって支払が統合されます。注意点として、全体及びアカウントごとの Billing Alert または AWS Budgets を設定して監視を行うことをおすすめします。設定ミスや無限ループなどによる予期せぬコスト増にも早めに気づくことができます。\u003C\u002Fp\u003E\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-large is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F3-1-1024x697.png\" alt=\"CloudWatch の Billing メトリクスを有効化\" class=\"wp-image-649\" width=\"656\" height=\"446\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F3-1-1024x697.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F3-1-300x204.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F3-1-768x523.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F3-1.png 1209w\" sizes=\"(max-width: 656px) 100vw, 656px\" \u002F\u003E\u003Cfigcaption class=\"wp-element-caption\"\u003ECloudWatch の Billing メトリクスを有効化\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-full is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F3-2.png\" alt=\"メトリクスから各アカウントごとの料金を確認、アラートを設定\" class=\"wp-image-650\" width=\"663\" height=\"260\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F3-2.png 766w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002F3-2-300x117.png 300w\" sizes=\"(max-width: 663px) 100vw, 663px\" \u002F\u003E\u003Cfigcaption class=\"wp-element-caption\"\u003Eメトリクスから各アカウントごとの料金を確認、アラートを設定\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eマルチアカウント構成を取り入れた開発基盤の構成イメージ\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E例えば、複数のDevOpsチームを持ち、複数のプロダクトを構えるプラットフォーム開発基盤としての構成イメージがこちらになります。必要に応じて OU 及びそれに属する AWS アカウントを柔軟に追加することができ、アカウントレベルでも疎結合なアプローチとなります。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"640\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_4-1024x640.png\" alt=\"マルチアカウント構成を取り入れた開発基盤の構成イメージ\" class=\"wp-image-651\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_4-1024x640.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_4-300x188.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_4-768x480.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_4.png 1281w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eセキュリティにおける考慮事項\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E複数のアカウントを管理していくときの懸念点として、コンプライアンスやセキュリティ面におけるリスク対応のための共通設定を適用する必要があります。一方で、一部のアカウントには開発のための例外措置や、より厳しいルールを指定するといったカスタマイズが必要になるケースがあります。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eマルチアカウント構成において AWS Control Tower を利用することである程度基本的なところは整いますが、各組織の特性や制約などを踏まえると、AWS Config によるルールの整備と、ルールに違反した構成が組まれた際の監視を自動化する仕組みが必要になります。そのためのアプローチとしては、以下のようは方法があります。\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EAWS Security Hub \u002F AWS Config \u002F Amazon GuardDuty など、各種セキュリティ関連サービスの有効化と設定\u003C\u002Fli\u003E\n\n\n\n\u003Cli\u003E有事の際や検証にひかかったときに通知を行う仕組み\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-large is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.30.15-1024x639.png\" alt=\"セキュリティ標準項目を指定したSecurity Hubのレポート画面\" class=\"wp-image-652\" width=\"598\" height=\"373\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.30.15-1024x639.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.30.15-300x187.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.30.15-768x479.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.30.15.png 1228w\" sizes=\"(max-width: 598px) 100vw, 598px\" \u002F\u003E\u003Cfigcaption class=\"wp-element-caption\"\u003Eセキュリティ標準項目を指定したSecurity Hubのレポート画面\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\u003Cp\u003ESecurity Hub の設定では、標準としてAWSベストプラクティス・CIS AWS Foundations Benchmark (v1.2.0, v1,4,0)・NIST SP 800-53 などがサポートされています。\u003C\u002Fp\u003E\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-full is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.18.50.png\" alt=\"セキュリティ標準\" class=\"wp-image-654\" width=\"470\" height=\"151\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.18.50.png 826w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.18.50-300x96.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002FScreenshot-2023-08-20-at-2.18.50-768x245.png 768w\" sizes=\"(max-width: 470px) 100vw, 470px\" \u002F\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\u003Cp\u003Eまた、AWS Config を利用してカスタムルールを適用する機能も使えます。AWS Lambda と連動して、チェックする周期の指定やチェックのロジックを実行して監視することができます。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eセキュリティに関するルールセットや監視については、作成するアカウント全てに適用しておくことが望ましいです。しかし、個別のアカウントごとに同じ設定をマニュアル対応することはやや現実的ではありません。よって、次項で説明するアカウント作成の自動化（Account Factory）を検討してみることをおすすめします。\u003C\u002Fp\u003E\n\n\n\n\u003Ch2 class=\"wp-block-heading\"\u003Eアカウント作成の自動化\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EAWS Control Tower を利用すると、Account Factory という機能を使って新規アカウントを作成することができます。Service Catalog に新規アカウント Product が登録されており、連携してアカウント名やOUなど必要なパラメータ情報を入力すると新規アカウントが作成されます。完了後は AWS Control Tower 管理下のアカウントとして紐づく流れになります。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eこの一連の流れについて、公式でサポートされている「AFT（Account Factory for Terraform）」というソリューションがあります。アカウント新規作成、アカウント作成時のカスタマイズ、アカウント作成後の個別アカウントごとのカスタマイズ、アカウント作成後の全アカウント共通設定を適用するカスタマイズなど、様々な形でマルチアカウント構成を構築運用するための機能が含まれています。\u003C\u002Fp\u003E\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\n\u003Cfigure class=\"aligncenter size-large is-resized\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Faws_ct_diagram-1024x636.png\" alt=\"AFT（Account Factory for Terraform）\" class=\"wp-image-655\" width=\"699\" height=\"433\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Faws_ct_diagram-1024x636.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Faws_ct_diagram-300x186.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Faws_ct_diagram-768x477.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Faws_ct_diagram.png 1728w\" sizes=\"(max-width: 699px) 100vw, 699px\" \u002F\u003E\u003Cfigcaption class=\"wp-element-caption\"\u003ETerraform &gt; Control Tower より抜粋（2023.08.19）\u003Cbr\u003Ehttps:\u002F\u002Fdeveloper.hashicorp.com\u002Fterraform\u002Ftutorials\u002Faws\u002Faws-control-tower-aft\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\u003Cp\u003Eしかし、公式では、利用しない間にも発生する固定費用（NAT Gateway の料金など）を含めややコストが発生したり、高機能であるが故に、カジュアルに利用するという観点ではどうかなという疑問もあるかと思います。その場合、公式のAFTの構成を参考に、以下のようにカジュアルな形でアカウント作成とカスタマイズの設定を行う構成の仕組みを構築することができます。Terraform コードでアカウント作成情報を記載し、Terraform Cloud からデプロイする構成になります。フルサーバーレスで対応できる点もメリットになります。\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure class=\"wp-block-image size-large\"\u003E\u003Cimg decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"620\" src=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_5-1024x620.png\" alt=\"Terraform Cloud からデプロイする構成\" class=\"wp-image-656\" srcset=\"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_5-1024x620.png 1024w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_5-300x182.png 300w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_5-768x465.png 768w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_5-1536x930.png 1536w, https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fimage_5.png 1621w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003Eアカウント作成リクエストに関しては、以下のような Terraform コードを書いて IaC 化することが可能です。\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003Eenviroment\u002F\u003Ccode\u003Emain.tf\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-terraform\"\u003E\u003Ccode\u003Eprovider \"aws\" {\n  region = \"ap-northeast-1\"\n}\n\nmodule \"sandbox_account_01\" {\n  source = \"..\u002Fmodules\u002Fsandbox_account\u002F\"\n  account_name             = \"sandbox01\"\n  product_id               = \"prod-xxxxxxxxxx\"\n  provisioning_artifact_id = \"pa-xxxxxxxxxxxx\"\n  new_account_params = {\n    account_email       = \"sandbox01@example.com\"\n    account_name        = \"sandbox01\"\n    ou                  = \"Sandbox (ou-xxxx)\"\n    sso_user_email      = \"sandbox01@example.com\"\n    sso_user_first_name = \"Katsuo\"\n    sso_user_last_name  = \"Isono\"\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Emodules\u002Fsandbox_account\u002Fmain.tf\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-code language-terraform\"\u003E\u003Ccode\u003Eresource \"aws_servicecatalog_provisioned_product\" \"new_controll_tower_managed_account\" {\n  name                     = var.account_name\n  product_id               = var.product_id\n  provisioning_artifact_id = var.provisioning_artifact_id\n\n  provisioning_parameters {\n    key   = \"AccountEmail\"\n    value = var.new_account_params.account_email\n  }\n  provisioning_parameters {\n    key   = \"AccountName\"\n    value = var.new_account_params.account_name\n  }\n  # ...\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eアカウント作成が完了すれば、EventBridge から以下のようなイベントを取得することが可能です。このイベントを拾って別途 Terraform Cloud 上で workspace を作成し、後続処理として AWS Config のカスタムルールの設定やアカウントごとのカスタマイズなどを適用することが可能になります。\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted language-json\"\u003E{\u003Cbr\u003E  \"detail-type\": \"AWS Service Event via CloudTrail\",\u003Cbr\u003E  \"source\": \"aws.controltower\",\u003Cbr\u003E  \"detail\": {\u003Cbr\u003E    \"eventSource\": \"controltower.amazonaws.com\",\u003Cbr\u003E    \"eventName\": \"CreateManagedAccount\",\u003Cbr\u003E    \"awsRegion\": \"ap-northeast-1\",\u003Cbr\u003E    \"serviceEventDetails\": {\u003Cbr\u003E      \"createManagedAccountStatus\": {\u003Cbr\u003E        \"organizationalUnit\": {\u003Cbr\u003E          \"organizationalUnitName\": \"Sandbox\",\u003Cbr\u003E          \"organizationalUnitId\": \"ou-xxxx-xxxxx\"\u003Cbr\u003E        },\u003Cbr\u003E        \"account\": {\u003Cbr\u003E          \"accountName\": \"sandbox05\",\u003Cbr\u003E          \"accountId\": \"111122223333\"\u003Cbr\u003E        },\u003Cbr\u003E        \"state\": \"SUCCEEDED\",\u003Cbr\u003E        \"message\": \"AWS Control Tower successfully created an enrolled account.\",\u003Cbr\u003E      }\u003Cbr\u003E    }\u003Cbr\u003E    \u002F\u002F ...\u003Cbr\u003E  }\u003Cbr\u003E}\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eいかがだったでしょうか。結論としては、各組織・プロジェクトの特性と制約を鑑みながら、可能な限りセキュリティと運用効率の両方を向上できる形で開発基盤を構築することを目指す形になります。AWSのベストプラクティスを積極的に理解して活用することも大事ですので、そういった情報を探していた方々の参考になると幸いです。不明点などあれば、お気軽にお問い合わせください。\u003C\u002Fp\u003E\n","author":{"name":"Sonu Kim","description":"","avatars":{"avatar96":"https:\u002F\u002Fsecure.gravatar.com\u002Favatar\u002F5b527696e38c84c34048954d767b1537?s=96&d=mm&r=g"},"acf":{"userJpName":"金 仙優","userRole":"COO","facebook":"","twitter":"","github":""}},"date":"2023.08.20","path":"\u002Fblog\u002F640\u002F","featuredMedia":{"sourceUrl":"https:\u002F\u002Fcdn.getshifter.co\u002Ff6642def64a63651c07142605e040674c5441f6d\u002Fuploads\u002F2023\u002F08\u002Fso-release.png","altText":"so-release-image","mediaDetails":{"width":1200}},"categories":[{"id":"7","title":"Blog","path":"\u002Fcategory\u002Fblog\u002F"}],"tags":[{"id":"76","title":"AFT","path":"\u002Ftag\u002Faft\u002F"},{"id":"8","title":"AWS","path":"\u002Ftag\u002Faws\u002F"},{"id":"81","title":"AWS Organizations","path":"\u002Ftag\u002Faws-organizations\u002F"},{"id":"77","title":"Control Tower","path":"\u002Ftag\u002Fcontrol-tower\u002F"},{"id":"80","title":"EventBridge","path":"\u002Ftag\u002Feventbridge\u002F"},{"id":"2","title":"Serverless","path":"\u002Ftag\u002Fserverless\u002F"},{"id":"82","title":"Service Catalog","path":"\u002Ftag\u002Fservice-catalog\u002F"},{"id":"78","title":"Terraform","path":"\u002Ftag\u002Fterraform\u002F"},{"id":"79","title":"Terraform Cloud","path":"\u002Ftag\u002Fterraform-cloud\u002F"}]},"metadata":{"siteName":"Serverless Operations","siteDescription":"Serverless Operationsは、これまでグローバルの第一線で培ってきたクラウド技術（AWS − アマゾンウェブサービス）の豊富な実績と知見を活かし、お客さまのサーバーレスによる開発や運用の支援、コンサルティングまで一貫してサポート。サーバーレスに関するさまざまな課題を解決いたします。","siteUrl":"https:\u002F\u002Fserverless.co.jp","siteOgImage":"https:\u002F\u002Fserverless.co.jp\u002Fogp.png"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.748a8736.js" defer></script><script src="/assets/js/page--src--templates--word-press-blog-vue.3139ba43.js" defer></script><script data-vue-tag="ssr" src="https://webfont.fontplus.jp/accessor/script/fontplus.js?LuMx0zy9taw%3D&box=ME4Rs88c3-0%3D&aa=1&ab=2" data-body="true"></script>
  </body>
</html>
